NateWisemocha/
â”œâ”€ .wrangler/
â”‚  â””â”€ state/
â”‚     â””â”€ v3/
â”‚        â”œâ”€ cache/
â”‚        â”‚  â””â”€ miniflare-CacheObject/
â”‚        â”œâ”€ d1/
â”‚        â”‚  â””â”€ miniflare-D1DatabaseObject/
â”‚        â”‚     â”œâ”€ 351f41b0972bbe12275e1776734dfa13f18982f9dd16b7a987b66d59fbf2dbf4.sqlite
â”‚        â”‚     â””â”€ seed.sql
â”‚        â”œâ”€ do/
â”‚        â”œâ”€ r2/
â”‚        â”‚  â””â”€ miniflare-R2BucketObject/
â”‚        â””â”€ workflows/
â”œâ”€ database_backups/
â”‚  â””â”€ backup_before_injection.sqlite
â”œâ”€ generated_content/
â”‚  â”œâ”€ mathematics_n4 copy.sql
â”‚  â””â”€ mathematics_n4.sql
â”œâ”€ migrations/
â”‚  â”œâ”€ 1/
â”‚  â”‚  â””â”€ down.sql
â”‚  â”œâ”€ 2/
â”‚  â”‚  â””â”€ down.sql
â”‚  â”œâ”€ 1.sql
â”‚  â””â”€ 2.sql
â”œâ”€ scripts/
â”‚  â””â”€ content_injector.py
â”œâ”€ src/
â”‚  â”œâ”€ react-app/
â”‚  â”‚  â”œâ”€ components/
â”‚  â”‚  â”‚  â”œâ”€ Navigation.tsx
â”‚  â”‚  â”‚  â”œâ”€ ProgressRing.tsx
â”‚  â”‚  â”‚  â”œâ”€ QuestionRenderer.tsx
â”‚  â”‚  â”‚  â”œâ”€ QuestionVisualizer.tsx
â”‚  â”‚  â”‚  â””â”€ StreakTracker.tsx
â”‚  â”‚  â”œâ”€ pages/
â”‚  â”‚  â”‚  â”œâ”€ Achievements.tsx
â”‚  â”‚  â”‚  â”œâ”€ AdminContentManager.tsx
â”‚  â”‚  â”‚  â”œâ”€ Analytics.tsx
â”‚  â”‚  â”‚  â”œâ”€ AuthCallback.tsx
â”‚  â”‚  â”‚  â”œâ”€ DailyChallenges.tsx
â”‚  â”‚  â”‚  â”œâ”€ Dashboard.tsx
â”‚  â”‚  â”‚  â”œâ”€ Home.tsx
â”‚  â”‚  â”‚  â”œâ”€ JsonBulkImporter.tsx
â”‚  â”‚  â”‚  â”œâ”€ Leaderboard.tsx
â”‚  â”‚  â”‚  â”œâ”€ ModuleDetail.tsx
â”‚  â”‚  â”‚  â”œâ”€ SkillPractice.tsx
â”‚  â”‚  â”‚  â”œâ”€ SubjectDetail.tsx
â”‚  â”‚  â”‚  â””â”€ Subjects.tsx
â”‚  â”‚  â”œâ”€ App.tsx
â”‚  â”‚  â”œâ”€ index.css
â”‚  â”‚  â”œâ”€ main.tsx
â”‚  â”‚  â”œâ”€ router.tsx
â”‚  â”‚  â””â”€ vite-env.d.ts
â”‚  â”œâ”€ shared/
â”‚  â”‚  â””â”€ types.ts
â”‚  â””â”€ worker/
â”‚     â”œâ”€ env.d.ts
â”‚     â”œâ”€ index.ts
â”‚     â””â”€ worker-configuration.d.ts
â”œâ”€ .env
â”œâ”€ .gitignore
â”œâ”€ add_questions.sql
â”œâ”€ combined_tool.py
â”œâ”€ eslint.config.js
â”œâ”€ index.html
â”œâ”€ natewise-website-snapshot.txt
â”œâ”€ package-lock.json
â”œâ”€ package.json
â”œâ”€ postcss.config.js
â”œâ”€ README.md
â”œâ”€ tailwind.config.js
â”œâ”€ tsconfig.app.json
â”œâ”€ tsconfig.json
â”œâ”€ tsconfig.node.json
â”œâ”€ tsconfig.worker.json
â”œâ”€ vite.config.ts
â””â”€ wrangler.json

================================================================================
PROJECT SNAPSHOT
================================================================================
Generated from: C:\merged_partition_content\KingJ\NateWisemocha
Total files included: 50
================================================================================


============================================================
DIRECTORY: ROOT
============================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: .env
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

VITE_DEV_MODE=true
MOCHA_USERS_SERVICE_API_URL=http://localhost:5173
MOCHA_USERS_SERVICE_API_KEY=dev_mode

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: README.md
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

## NateWise

This app was created using https://getmocha.com.
Need help or want to join the community? Join our [Discord](https://discord.gg/shDEGBSe2d).

To run the devserver:
```
npm install
npm run dev
```


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: add_questions.sql
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

-- Add questions for skill 13 (Solve Basic Linear Equations)
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) VALUES 
(13, 'multiple_choice', 'Solve for x: 2x + 5 = 13', '{"options": ["x = 4", "x = 5", "x = 6", "x = 7"]}', 'x = 4', 'Subtract 5 from both sides: 2x = 8, then divide by 2: x = 4', 1, 10),
(13, 'multiple_choice', 'Solve for y: 3y - 7 = 14', '{"options": ["y = 5", "y = 6", "y = 7", "y = 8"]}', 'y = 7', 'Add 7 to both sides: 3y = 21, then divide by 3: y = 7', 1, 10),
(13, 'multiple_choice', 'Solve for x: 4(x - 3) = 20', '{"options": ["x = 5", "x = 6", "x = 7", "x = 8"]}', 'x = 8', 'Divide both sides by 4: x - 3 = 5, then add 3: x = 8', 2, 15);

-- Add questions for skill 30 (Ohm's Law)
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) VALUES 
(30, 'multiple_choice', 'If voltage is 12V and resistance is 4Î©, what is the current?', '{"options": ["3A", "4A", "2A", "6A"]}', '3A', 'Using Ohm''s Law: I = V/R = 12/4 = 3A', 1, 10),
(30, 'multiple_choice', 'A current of 2A flows through a 10Î© resistor. What is the voltage?', '{"options": ["20V", "10V", "5V", "2V"]}', '20V', 'Using Ohm''s Law: V = I*R = 2*10 = 20V', 1, 10),
(30, 'multiple_choice', 'If voltage is 24V and current is 3A, what is the resistance?', '{"options": ["8Î©", "6Î©", "12Î©", "4Î©"]}', '8Î©', 'Using Ohm''s Law: R = V/I = 24/3 = 8Î©', 2, 15);

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: combined_tool.py
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import os
import sys
import argparse
import glob

#python combined_tool.py "C:\merged_partition_content\KingJ\NateWisemocha" --mode snapshot --output natewise-website-snapshot.txt
#python combined_tool.py "C:\merged_partition_content\KingJ\NateWisemocha" --output natedwise-website-tree.txt
# Default ignore lists
DEFAULT_IGNORE_DIRS = {
    "node_modules", ".git", ".cache", "dist", "build",
    ".next", ".nuxt", ".venv", "venv", "__pycache__"
}
DEFAULT_IGNORE_FILES = {".log", ".tmp", ".DS_Store", "Thumbs.db"}

# ---------- Tree Generation Functions ----------

def normalize_path(path: str) -> str:
    """Normalize Windows paths safely."""
    return os.path.normpath(os.path.expanduser(path.strip('"')))

def should_ignore_tree(name: str, ignore_dirs, ignore_exts) -> bool:
    """Return True if a file/folder should be ignored for tree generation."""
    if name in ignore_dirs:
        return True
    _, ext = os.path.splitext(name)
    return ext.lower() in ignore_exts

def filter_entries(entries, ignore_dirs, ignore_exts, include_files, include_exts):
    """Filter and sort directory entries: folders first, then files."""
    dirs, files = [], []
    for e in entries:
        if os.path.isdir(e):
            if not should_ignore_tree(os.path.basename(e), ignore_dirs, ignore_exts):
                dirs.append(e)
        else:
            if include_files:
                fname = os.path.basename(e)
                _, ext = os.path.splitext(fname)
                if fname not in DEFAULT_IGNORE_FILES and not should_ignore_tree(fname, ignore_dirs, ignore_exts):
                    if not include_exts or ext.lower() in include_exts:
                        files.append(e)
    return sorted(dirs, key=str.lower), sorted(files, key=str.lower)

def build_tree(root, prefix="", depth=0, max_depth=None,
               include_files=True, include_exts=None,
               ignore_dirs=None, ignore_exts=None):
    """
    Recursively build a folder tree string list.
    """
    lines = []
    try:
        entries = [os.path.join(root, e) for e in os.listdir(root)]
    except PermissionError:
        return [prefix + "[Permission Denied]"]
    except FileNotFoundError:
        return [prefix + "[Not Found]"]

    dirs, files = filter_entries(entries, ignore_dirs, ignore_exts, include_files, include_exts)
    children = dirs + files

    for idx, path in enumerate(children):
        connector = "â””â”€ " if idx == len(children) - 1 else "â”œâ”€ "
        name = os.path.basename(path)
        if os.path.isdir(path):
            lines.append(prefix + connector + name + "/")
            if max_depth is None or depth + 1 < max_depth:
                extension = "   " if idx == len(children) - 1 else "â”‚  "
                lines.extend(build_tree(
                    path,
                    prefix + extension,
                    depth + 1,
                    max_depth,
                    include_files,
                    include_exts,
                    ignore_dirs,
                    ignore_exts
                ))
        else:
            lines.append(prefix + connector + name)
    return lines

def generate_tree(root, **kwargs):
    """Generate tree for a single root directory."""
    root_name = os.path.basename(normalize_path(root))
    lines = [root_name + "/"]
    lines.extend(build_tree(normalize_path(root), **kwargs))
    return "\n".join(lines)

# ---------- Snapshot Generation Functions ----------

def is_noisy_folder(folder_path):
    """Check if folder should be excluded from snapshot"""
    noisy_folders = {
        'node_modules', '.next', '.git', 'dist', 'build', 
        'coverage', '.nyc_output', '.cache', '.vscode',
        '__pycache__', '.pytest_cache', '.idea', '.DS_Store'
    }
    return any(noisy_part in folder_path for noisy_part in noisy_folders)

def is_relevant_file(file_path):
    """Check if file is relevant source code for snapshot"""
    relevant_extensions = {
        '.ts', '.tsx', '.js', '.jsx', '.py', '.json', 
        '.prisma', '.sql', '.md', '.txt', '.yml', '.yaml',
        '.css', '.scss', '.html', '.env', '.example'
    }
    return any(file_path.endswith(ext) for ext in relevant_extensions)

def should_include_file(file_path):
    """Determine if file should be included in snapshot output"""
    # Skip if in noisy folder
    if is_noisy_folder(file_path):
        return False
    
    # Skip large binary files and dependencies
    skip_files = {
        'package-lock.json', 'yarn.lock', '.DS_Store',
        '*.log', '*.min.js', '*.min.css'
    }
    
    filename = os.path.basename(file_path)
    if any(filename == pattern or filename.endswith(pattern.replace('*', '')) for pattern in skip_files):
        return False
    
    return is_relevant_file(file_path)

def get_file_content(file_path):
    """Read file content with proper encoding handling"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            return f.read()
    except UnicodeDecodeError:
        try:
            with open(file_path, 'r', encoding='latin-1') as f:
                return f.read()
        except:
            return f"# ERROR: Could not read {file_path} (binary or unsupported encoding)\n\n"
    except Exception as e:
        return f"# ERROR: Could not read {file_path} - {str(e)}\n\n"

def create_project_snapshot(root_dir, output_file='project_snapshot.txt'):
    """Create a comprehensive snapshot of the project code"""
    
    print(f"ğŸ“ Creating project snapshot from: {root_dir}")
    print("â³ Scanning for relevant files...")
    
    # Get all files recursively
    all_files = []
    for root, dirs, files in os.walk(root_dir):
        # Skip noisy directories
        dirs[:] = [d for d in dirs if not is_noisy_folder(os.path.join(root, d))]
        
        for file in files:
            file_path = os.path.join(root, file)
            if should_include_file(file_path):
                all_files.append(file_path)
    
    print(f"ğŸ“„ Found {len(all_files)} relevant files")
    
    # Sort files for better organization
    all_files.sort()
    
    # Create output file
    with open(output_file, 'w', encoding='utf-8') as outfile:
        # Write header
        outfile.write("=" * 80 + "\n")
        outfile.write("PROJECT SNAPSHOT\n")
        outfile.write("=" * 80 + "\n")
        outfile.write(f"Generated from: {os.path.abspath(root_dir)}\n")
        outfile.write(f"Total files included: {len(all_files)}\n")
        outfile.write("=" * 80 + "\n\n")
        
        # Group files by directory for better organization
        files_by_dir = {}
        for file_path in all_files:
            rel_path = os.path.relpath(file_path, root_dir)
            dir_name = os.path.dirname(rel_path)
            if dir_name not in files_by_dir:
                files_by_dir[dir_name] = []
            files_by_dir[dir_name].append(rel_path)
        
        # Write files organized by directory
        for dir_name in sorted(files_by_dir.keys()):
            outfile.write(f"\n{'=' * 60}\n")
            outfile.write(f"DIRECTORY: {dir_name if dir_name else 'ROOT'}\n")
            outfile.write(f"{'=' * 60}\n\n")
            
            for file_path in sorted(files_by_dir[dir_name]):
                full_path = os.path.join(root_dir, file_path)
                outfile.write(f"{'â”€' * 40}\n")
                outfile.write(f"FILE: {file_path}\n")
                outfile.write(f"{'â”€' * 40}\n\n")
                
                content = get_file_content(full_path)
                outfile.write(content)
                outfile.write("\n\n")  # Add spacing between files
    
    print(f"âœ… Project snapshot created: {output_file}")
    print(f"ğŸ“Š Total size: {os.path.getsize(output_file)} bytes")
    
    # Show summary
    print("\nğŸ“‹ SUMMARY:")
    extensions_count = {}
    for file_path in all_files:
        ext = os.path.splitext(file_path)[1]
        extensions_count[ext] = extensions_count.get(ext, 0) + 1
    
    for ext, count in sorted(extensions_count.items()):
        print(f"  {ext or 'no ext'}: {count} files")
    
    return len(all_files)

# ---------- Combined CLI ----------

def main():
    parser = argparse.ArgumentParser(description="Generate folder trees and project snapshots.")
    parser.add_argument("paths", nargs="+", help="Root directory paths")
    parser.add_argument("--mode", choices=["tree", "snapshot"], default="tree", 
                       help="Operation mode: tree (folder structure) or snapshot (file contents)")
    parser.add_argument("--max-depth", type=int, default=None, help="Limit recursion depth (tree mode only)")
    parser.add_argument("--include-files", action="store_true", default=True, help="Include files (tree mode only)")
    parser.add_argument("--include-exts", type=str, default="", help="Comma-separated list of file extensions to include")
    parser.add_argument("--output", type=str, default=None, help="Output file")
    parser.add_argument("--ignore", type=str, default="", help="Comma-separated list of extra dirs to ignore")

    args = parser.parse_args()

    include_exts = {e.strip().lower() for e in args.include_exts.split(",") if e.strip()} if args.include_exts else set()
    ignore_dirs = DEFAULT_IGNORE_DIRS.union({d.strip() for d in args.ignore.split(",") if d.strip()})
    ignore_exts = DEFAULT_IGNORE_FILES

    for path in args.paths:
        norm_path = normalize_path(path)
        if not os.path.exists(norm_path):
            print(f"Error: Path not found -> {norm_path}", file=sys.stderr)
            continue

        if args.mode == "tree":
            # Tree generation mode
            tree_str = generate_tree(
                norm_path,
                max_depth=args.max_depth,
                include_files=args.include_files,
                include_exts=include_exts,
                ignore_dirs=ignore_dirs,
                ignore_exts=ignore_exts
            )

            print(tree_str)

            out_file = args.output or f"{os.path.basename(norm_path)}-tree.txt"
            try:
                with open(out_file, "w", encoding="utf-8") as f:
                    f.write(tree_str)
                print(f"\n[Saved to {out_file}]\n")
            except OSError as e:
                print(f"Error writing to {out_file}: {e}", file=sys.stderr)

        elif args.mode == "snapshot":
            # Snapshot generation mode
            print("ğŸš€ Project Snapshot Generator")
            print(f"ğŸ“ Project root: {norm_path}")
            
            out_file = args.output or f"{os.path.basename(norm_path)}_snapshot.txt"
            
            try:
                file_count = create_project_snapshot(norm_path, out_file)
                
                # Show some stats about the output
                with open(out_file, 'r', encoding='utf-8') as f:
                    lines = f.readlines()
                    print(f"ğŸ“„ Output file: {len(lines)} lines")
                    
            except Exception as e:
                print(f"âŒ Error: {e}")
                print("ğŸ’¡ Make sure you have read permissions for all files")

if __name__ == "__main__":
    main()



â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: eslint.config.js
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import js from "@eslint/js";
import globals from "globals";
import reactHooks from "eslint-plugin-react-hooks";
import reactRefresh from "eslint-plugin-react-refresh";
import tseslint from "typescript-eslint";

export default tseslint.config(
  { ignores: [".bun", "node_modules", "dist", "./worker-configuration.d.ts"] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ["**/*.{ts,tsx}"],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      "react-hooks": reactHooks,
      "react-refresh": reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      "react-refresh/only-export-components": [
        "warn",
        { allowConstantExport: true },
      ],
    },
  }
);


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: index.html
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:title" content="NateWise" />
    <meta property="og:description" content="Master NATED courses with adaptive learning for N4-N6 students" />
    <meta
      property="og:image"
      content="https://static.getmocha.com/og.png"
      type="image/png"
    />
    <meta
      property="og:url"
      content="https://getmocha.com"
    />
    <meta property="og:type" content="website" />
    <meta property="og:author" content="Mocha" />
    <meta property="og:site_name" content="NateWise" />
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:site" content="@natewise" />
    <meta property="twitter:title" content="NateWise" />
    <meta property="twitter:description" content="Master NATED courses with adaptive learning for N4-N6 students" />
    <meta
      property="twitter:image"
      content="https://static.getmocha.com/og.png"
      type="image/png"
    />
    <link
      rel="shortcut icon"
      href="https://static.getmocha.com/favicon.ico"
      type="image/x-icon"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="https://static.getmocha.com/apple-touch-icon.png"
      type="image/png"
    />
    <title>NateWise - Master NATED Courses</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/react-app/main.tsx"></script>
  </body>
</html>


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: package.json
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

{
  "name": "natewisemocha",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "publish": "npm run build && wrangler deploy",
    "typecheck": "tsc --noEmit"
  },
  "dependencies": {
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router": "^7.1.5",
    "@getmocha/users-service": "^0.0.4",
    "react-mathjax": "^1.0.1",      
    "mermaid": "^10.0.2"    
  },
  "devDependencies": {
    "@cloudflare/vite-plugin": "^1.12.0",
    "@cloudflare/workers-types": "^4.20251121.0",
    "@eslint/js": "9.25.1",
    "@getmocha/vite-plugins": "latest",
    "@types/node": "22.14.1",
    "@types/react": "19.0.10",
    "@types/react-dom": "19.0.4",
    "@vitejs/plugin-react": "4.4.1",
    "autoprefixer": "^10.4.21",
    "eslint": "9.25.1",
    "eslint-plugin-react-hooks": "5.2.0",
    "eslint-plugin-react-refresh": "0.4.19",
    "globals": "15.15.0",
    "postcss": "^8.5.3",
    "tailwindcss": "^3.4.17",
    "typescript": "5.8.3",
    "typescript-eslint": "8.31.0",
    "vite": "^6.0.0",
    "wrangler": "^4.33.0"
  }
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: postcss.config.js
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: tailwind.config.js
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/react-app/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
};


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: tsconfig.app.json
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["src/react-app"]
}


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: tsconfig.json
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" },
    { "path": "./tsconfig.worker.json" }
  ]
}


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: tsconfig.node.json
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: tsconfig.worker.json
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "lib": ["ES2020"],
    "types": ["@cloudflare/workers-types"],
    "moduleResolution": "node",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true
  },
  "include": [
    "src/worker/**/*"
  ],
  "exclude": [
    "node_modules",
    "dist"
  ]
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: vite.config.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import path from "path";
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import { cloudflare } from "@cloudflare/vite-plugin";
import { mochaPlugins } from "@getmocha/vite-plugins";

export default defineConfig({
  // eslint-disable-next-line @typescript-eslint/no-explicit-any
  plugins: [...mochaPlugins(process.env as any), react(), cloudflare()],
  server: {
    allowedHosts: true,
  },
  build: {
    chunkSizeWarningLimit: 5000,
  },
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
});


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: wrangler.json
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "019aa607-60dc-7248-b17b-e3adda863ed3",
  "main": "./src/worker/index.ts",
  "compatibility_date": "2025-06-17",
  "compatibility_flags": ["nodejs_compat"],
  "observability": {
    "enabled": true
  },
  "upload_source_maps": true,
  "assets": {
    "directory": "./dist",
    "not_found_handling": "single-page-application"
  },
  "d1_databases": [
    {
      "binding": "DB",
      "database_name": "019aa607-60dc-7248-b17b-e3adda863ed3",
      "database_id": "019aa607-60dc-7248-b17b-e3adda863ed3"
    }
  ],
  "r2_buckets": [
    {
      "binding": "R2_BUCKET",
      "bucket_name": "019aa607-60dc-7248-b17b-e3adda863ed3"
    }
  ]
}


============================================================
DIRECTORY: .wrangler\state\v3\d1\miniflare-D1DatabaseObject
============================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: .wrangler\state\v3\d1\miniflare-D1DatabaseObject\seed.sql
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

-- ============================================================
-- SEED DATA FOR NATEWISE MOCHA APPLICATION
-- ============================================================

-- Clear existing data (optional - for clean reset)
DELETE FROM user_daily_challenges;
DELETE FROM daily_challenges;
DELETE FROM question_attempts;
DELETE FROM practice_sessions;
DELETE FROM skill_progress;
DELETE FROM user_achievements;
DELETE FROM achievements;
DELETE FROM class_enrollments;
DELETE FROM classes;
DELETE FROM skill_assignments;
DELETE FROM questions;
DELETE FROM skills;
DELETE FROM topics;
DELETE FROM modules;
DELETE FROM subjects;
DELETE FROM institutions;
DELETE FROM user_profiles;
DELETE FROM user_stats;

-- ============================================================
-- INSTITUTIONS
-- ============================================================
INSERT INTO institutions (name, institution_type, contact_email, contact_phone, address) VALUES
('Tech College Johannesburg', 'college', 'admin@techcollege.jhb.za', '+27-11-555-1000', '123 Education Street, Johannesburg'),
('Engineering Training Center', 'training_center', 'info@engineeringtraining.za', '+27-11-555-2000', '456 Innovation Ave, Sandton');

-- ============================================================
-- USER PROFILES & STATS
-- ============================================================
INSERT INTO user_profiles (user_id, role, institution_id, grade_level) VALUES
('dev-user', 'student', 1, 'N4'),
('teacher-1', 'teacher', 1, NULL);

INSERT INTO user_stats (user_id, total_xp, level, total_questions_answered, total_correct_answers, longest_streak, current_weekly_streak) VALUES
('dev-user', 1250, 3, 85, 67, 7, 3);

-- ============================================================
-- SUBJECTS (Two Complete Subjects)
-- ============================================================

-- Subject 1: Mathematics N4
INSERT INTO subjects (name, code, nated_level, description, icon_url, color_hex, display_order) VALUES
('Mathematics N4', 'MATH-N4', 'N4', 'Engineering Mathematics for N4 level covering algebra, calculus, and trigonometry', '/icons/math.svg', '#3B82F6', 1),
('Engineering Science N4', 'ENG-SCI-N4', 'N4', 'Fundamental principles of engineering science including mechanics and thermodynamics', '/icons/science.svg', '#EF4444', 2);

-- ============================================================
-- MODULES for Mathematics N4
-- ============================================================
INSERT INTO modules (subject_id, name, description, display_order) VALUES
-- Math N4 Modules
(1, 'Algebra and Equations', 'Solving linear, quadratic and simultaneous equations', 1),
(1, 'Calculus and Differentiation', 'Introduction to differential calculus and applications', 2),
(1, 'Trigonometry', 'Trigonometric functions, identities and equations', 3),
(1, 'Complex Numbers', 'Operations with complex numbers and Argand diagrams', 4),

-- Engineering Science N4 Modules
(2, 'Mechanics', 'Forces, motion, and mechanical principles', 1),
(2, 'Thermodynamics', 'Heat, energy, and thermodynamic systems', 2),
(2, 'Materials Science', 'Properties and behavior of engineering materials', 3),
(2, 'Electrical Principles', 'Basic electrical circuits and principles', 4);

-- ============================================================
-- TOPICS for each Module
-- ============================================================

-- Algebra and Equations (Module 1)
INSERT INTO topics (module_id, name, description, display_order) VALUES
(1, 'Linear Equations', 'Solving equations of first degree', 1),
(1, 'Quadratic Equations', 'Solving equations of second degree', 2),
(1, 'Simultaneous Equations', 'Solving systems of equations', 3),

-- Calculus and Differentiation (Module 2)
(2, 'Limits and Continuity', 'Understanding limits and function continuity', 1),
(2, 'Basic Differentiation', 'Rules of differentiation', 2),
(2, 'Applications of Derivatives', 'Using derivatives in practical problems', 3),

-- Trigonometry (Module 3)
(3, 'Trigonometric Functions', 'Sine, cosine, tangent and their graphs', 1),
(3, 'Trigonometric Identities', 'Fundamental trigonometric identities', 2),
(3, 'Solving Trigonometric Equations', 'Finding solutions to trig equations', 3),

-- Complex Numbers (Module 4)
(4, 'Complex Number Operations', 'Addition, subtraction, multiplication', 1),
(4, 'Argand Diagrams', 'Graphical representation of complex numbers', 2),

-- Mechanics (Module 5)
(5, 'Forces and Equilibrium', 'Static forces and equilibrium conditions', 1),
(5, 'Kinematics', 'Motion without considering forces', 2),
(5, 'Dynamics', 'Motion considering forces', 3),

-- Thermodynamics (Module 6)
(6, 'Heat Transfer', 'Conduction, convection and radiation', 1),
(6, 'Laws of Thermodynamics', 'Fundamental thermodynamic principles', 2),

-- Materials Science (Module 7)
(7, 'Material Properties', 'Strength, elasticity, hardness', 1),
(7, 'Material Testing', 'Methods for testing material properties', 2),

-- Electrical Principles (Module 8)
(8, 'DC Circuits', 'Direct current circuit analysis', 1),
(8, 'AC Circuits', 'Alternating current principles', 2);

-- ============================================================
-- SKILLS for each Topic
-- ============================================================

-- Linear Equations Skills (Topic 1)
INSERT INTO skills (topic_id, name, description, difficulty_level, display_order, mastery_threshold) VALUES
(1, 'Solve Basic Linear Equations', 'Solve equations like 2x + 3 = 11', 1, 1, 85),
(1, 'Solve Equations with Fractions', 'Solve equations containing fractional coefficients', 2, 2, 80),
(1, 'Word Problems with Linear Equations', 'Form and solve equations from word problems', 3, 3, 75),

-- Quadratic Equations Skills (Topic 2)
(2, 'Solve by Factoring', 'Solve quadratic equations by factoring method', 2, 1, 85),
(2, 'Quadratic Formula', 'Use quadratic formula to solve equations', 2, 2, 80),
(2, 'Completing the Square', 'Solve by completing the square method', 3, 3, 75),

-- Limits and Continuity Skills (Topic 4)
(4, 'Evaluate Simple Limits', 'Find limits of basic functions', 1, 1, 85),
(4, 'Continuity Assessment', 'Determine if a function is continuous', 2, 2, 80),

-- Basic Differentiation Skills (Topic 5)
(5, 'Power Rule', 'Differentiate functions using power rule', 1, 1, 90),
(5, 'Product Rule', 'Differentiate products of functions', 2, 2, 80),
(5, 'Chain Rule', 'Differentiate composite functions', 3, 3, 75),

-- Trigonometric Functions Skills (Topic 7)
(7, 'Unit Circle Values', 'Recall trigonometric values for common angles', 1, 1, 95),
(7, 'Graph Trigonometric Functions', 'Sketch sine, cosine and tangent graphs', 2, 2, 80),

-- Forces and Equilibrium Skills (Topic 13)
(13, 'Resolve Forces', 'Break forces into components', 2, 1, 85),
(13, 'Equilibrium Conditions', 'Apply equilibrium conditions to solve problems', 2, 2, 80),

-- Heat Transfer Skills (Topic 15)
(15, 'Conduction Calculations', 'Solve conduction heat transfer problems', 2, 1, 80),
(15, 'Convection Principles', 'Understand convective heat transfer', 2, 2, 75),

-- DC Circuits Skills (Topic 17)
(17, 'Ohm''s Law', 'Apply Ohm''s law to solve circuit problems', 1, 1, 90),
(17, 'Series Circuits', 'Analyze series electrical circuits', 2, 2, 85),
(17, 'Parallel Circuits', 'Analyze parallel electrical circuits', 2, 3, 85);

-- ============================================================
-- QUESTIONS for each Skill
-- ============================================================

-- Questions for Skill 1: Solve Basic Linear Equations
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) VALUES
(1, 'multiple_choice', 'Solve for x: 2x + 5 = 13', '{"options": ["x = 4", "x = 5", "x = 6", "x = 7"]}', 'x = 4', 'Subtract 5 from both sides: 2x = 8, then divide by 2: x = 4', 1, 10),
(1, 'multiple_choice', 'Solve for y: 3y - 7 = 14', '{"options": ["y = 5", "y = 6", "y = 7", "y = 8"]}', 'y = 7', 'Add 7 to both sides: 3y = 21, then divide by 3: y = 7', 1, 10),
(1, 'multiple_choice', 'Solve for x: 4(x - 3) = 20', '{"options": ["x = 5", "x = 6", "x = 7", "x = 8"]}', 'x = 8', 'Divide both sides by 4: x - 3 = 5, then add 3: x = 8', 2, 15),

-- Questions for Skill 2: Solve Equations with Fractions
(2, 'multiple_choice', 'Solve for x: (1/2)x + 3 = 7', '{"options": ["x = 4", "x = 6", "x = 8", "x = 10"]}', 'x = 8', 'Subtract 3: (1/2)x = 4, then multiply by 2: x = 8', 2, 15),
(2, 'multiple_choice', 'Solve for x: (2/3)x - 1 = 5', '{"options": ["x = 6", "x = 7", "x = 8", "x = 9"]}', 'x = 9', 'Add 1: (2/3)x = 6, then multiply by 3/2: x = 9', 2, 15),

-- Questions for Skill 4: Solve by Factoring
(4, 'multiple_choice', 'Solve by factoring: xÂ² + 5x + 6 = 0', '{"options": ["x = -2, -3", "x = 2, 3", "x = -1, -6", "x = 1, 6"]}', 'x = -2, -3', 'Factors: (x + 2)(x + 3) = 0, so x = -2 or x = -3', 2, 15),
(4, 'multiple_choice', 'Solve by factoring: xÂ² - 9 = 0', '{"options": ["x = Â±3", "x = Â±9", "x = 3 only", "x = 9 only"]}', 'x = Â±3', 'Difference of squares: (x - 3)(x + 3) = 0, so x = 3 or x = -3', 2, 15),

-- Questions for Skill 8: Power Rule
(8, 'multiple_choice', 'Find the derivative of f(x) = xâ´', '{"options": ["4xÂ³", "3xâ´", "4xâ´", "xÂ³"]}', '4xÂ³', 'Using power rule: multiply by exponent and reduce exponent by 1', 1, 10),
(8, 'multiple_choice', 'Find the derivative of f(x) = 3xÂ²', '{"options": ["6x", "3x", "6xÂ²", "2x"]}', '6x', 'Derivative of 3xÂ² is 2*3xÂ¹ = 6x', 1, 10),

-- Questions for Skill 13: Resolve Forces
(13, 'multiple_choice', 'A force of 10N acts at 30Â° to the horizontal. What is its horizontal component?', '{"options": ["8.66N", "5N", "10N", "7.07N"]}', '8.66N', 'Horizontal component = 10 * cos(30Â°) = 10 * 0.866 = 8.66N', 2, 15),
(13, 'multiple_choice', 'A force of 20N has a vertical component of 10N. What is the angle with the horizontal?', '{"options": ["30Â°", "45Â°", "60Â°", "90Â°"]}', '30Â°', 'sin(Î¸) = 10/20 = 0.5, so Î¸ = 30Â°', 2, 15),

-- Questions for Skill 17: Ohm's Law
(17, 'multiple_choice', 'If voltage is 12V and resistance is 4Î©, what is the current?', '{"options": ["3A", "4A", "2A", "6A"]}', '3A', 'Using Ohm''s Law: I = V/R = 12/4 = 3A', 1, 10),
(17, 'multiple_choice', 'A current of 2A flows through a 10Î© resistor. What is the voltage?', '{"options": ["20V", "10V", "5V", "2V"]}', '20V', 'Using Ohm''s Law: V = I*R = 2*10 = 20V', 1, 10);

-- ============================================================
-- SKILL PROGRESS (Sample progress for dev-user)
-- ============================================================
INSERT INTO skill_progress (user_id, skill_id, smart_score, questions_attempted, questions_correct, current_streak, best_streak, time_spent_seconds, is_mastered) VALUES
('dev-user', 1, 85, 20, 17, 3, 5, 1200, 1),
('dev-user', 2, 65, 15, 10, 1, 3, 900, 0),
('dev-user', 4, 90, 25, 23, 7, 7, 1500, 1),
('dev-user', 8, 75, 18, 14, 2, 4, 1100, 0),
('dev-user', 13, 55, 12, 7, 0, 2, 800, 0),
('dev-user', 17, 80, 22, 18, 4, 6, 1300, 0);

-- ============================================================
-- ACHIEVEMENTS
-- ============================================================
INSERT INTO achievements (name, description, badge_icon_url, achievement_type, criteria_json, points_value) VALUES
('First Steps', 'Complete your first skill practice', '/badges/first-steps.svg', 'milestone', '{"type": "first_practice"}', 50),
('Quick Learner', 'Master a skill in under 24 hours', '/badges/quick-learner.svg', 'speed', '{"type": "fast_mastery", "time_limit_hours": 24}', 100),
('Math Whiz', 'Master 5 mathematics skills', '/badges/math-whiz.svg', 'subject_mastery', '{"type": "subject_mastery", "subject": "math", "count": 5}', 200),
('Perfect Score', 'Get 100% on a practice session', '/badges/perfect-score.svg', 'performance', '{"type": "perfect_session"}', 75),
('Week Warrior', 'Practice for 7 consecutive days', '/badges/week-warrior.svg', 'consistency', '{"type": "streak", "days": 7}', 150);

-- User achievements for dev-user
INSERT INTO user_achievements (user_id, achievement_id) VALUES
('dev-user', 1),
('dev-user', 4);

-- ============================================================
-- DAILY CHALLENGES
-- ============================================================
INSERT INTO daily_challenges (challenge_date, skill_id, target_questions, target_accuracy, xp_reward) VALUES
(date('now'), 2, 5, 70, 100),
(date('now', '+1 day'), 8, 8, 75, 120),
(date('now', '+2 days'), 13, 6, 65, 90);

-- User progress on today's challenge
INSERT INTO user_daily_challenges (user_id, challenge_id, questions_completed, questions_correct, is_completed) VALUES
('dev-user', 1, 3, 2, 0);

-- ============================================================
-- CLASSES AND ENROLLMENTS
-- ============================================================
INSERT INTO classes (teacher_id, institution_id, name, subject_id, class_code) VALUES
('teacher-1', 1, 'Math N4 Group A', 1, 'MATHN4-A2024'),
('teacher-1', 1, 'Engineering Science N4', 2, 'ENGSCI-N4-2024');

INSERT INTO class_enrollments (class_id, student_id) VALUES
(1, 'dev-user'),
(2, 'dev-user');

-- ============================================================
-- SKILL ASSIGNMENTS
-- ============================================================
INSERT INTO skill_assignments (teacher_id, student_id, skill_id, due_date) VALUES
('teacher-1', 'dev-user', 2, date('now', '+7 days')),
('teacher-1', 'dev-user', 8, date('now', '+14 days'));

-- ============================================================
-- PRACTICE SESSIONS (Sample history)
-- ============================================================
INSERT INTO practice_sessions (user_id, skill_id, session_type, start_time, end_time, questions_attempted, questions_correct, final_score, is_completed) VALUES
('dev-user', 1, 'practice', datetime('now', '-2 hours'), datetime('now', '-1 hour'), 10, 8, 80, 1),
('dev-user', 4, 'practice', datetime('now', '-1 day'), datetime('now', '-1 day', '+30 minutes'), 15, 14, 93, 1),
('dev-user', 17, 'practice', datetime('now', '-3 days'), datetime('now', '-3 days', '+45 minutes'), 12, 9, 75, 1);

-- ============================================================
-- QUESTION ATTEMPTS (Sample data)
-- ============================================================
INSERT INTO question_attempts (session_id, question_id, user_id, user_answer, is_correct, time_spent_seconds) VALUES
(1, 1, 'dev-user', 'x = 4', 1, 30),
(1, 2, 'dev-user', 'y = 7', 1, 25),
(1, 3, 'dev-user', 'x = 7', 0, 40),
(2, 7, 'dev-user', 'x = Â±3', 1, 35),
(3, 15, 'dev-user', '3A', 1, 20);

-- ============================================================
-- LEADERBOARD ENTRIES
-- ============================================================
INSERT INTO leaderboard_entries (user_id, category, score, rank, period_start, period_end) VALUES
('dev-user', 'weekly_xp', 450, 3, date('now', 'weekday 0', '-7 days'), date('now', 'weekday 0')),
('dev-user', 'mastery_count', 2, 5, date('now', 'start of month'), date('now', 'start of month', '+1 month', '-1 day'));

-- ============================================================
-- VERIFICATION QUERY (Optional - to verify seed data)
-- ============================================================
SELECT 'Seed data completed successfully!' as status;


============================================================
DIRECTORY: generated_content
============================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: generated_content\mathematics_n4 copy.sql
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

-- =============================================
-- SUBJECT: Engineering Science N3 - TEST CONTENT
-- =============================================

-- Subject creation
INSERT INTO subjects (name, code, nated_level, description, color_hex, display_order) 
VALUES ('Engineering Science N3', 'ENG-SCI-N3', 'N3', 'Comprehensive engineering science principles including mechanics, thermodynamics, and materials science', '#DC2626', 5);

-- Modules for Engineering Science N3
INSERT INTO modules (subject_id, name, description, display_order) 
SELECT id, 'Statics and Dynamics', 'Analysis of forces, equilibrium, and motion in engineering systems', 1 
FROM subjects WHERE code = 'ENG-SCI-N3';

INSERT INTO modules (subject_id, name, description, display_order) 
SELECT id, 'Strength of Materials', 'Stress, strain, and material behavior under load', 2 
FROM subjects WHERE code = 'ENG-SCI-N3';

INSERT INTO modules (subject_id, name, description, display_order) 
SELECT id, 'Thermodynamics', 'Heat, work, energy transfer and thermodynamic cycles', 3 
FROM subjects WHERE code = 'ENG-SCI-N3';

-- Topics for Statics and Dynamics
INSERT INTO topics (module_id, name, description, display_order) 
SELECT id, 'Force Systems and Equilibrium', 'Analysis of concurrent and non-concurrent force systems', 1 
FROM modules WHERE name = 'Statics and Dynamics' AND subject_id IN (SELECT id FROM subjects WHERE code = 'ENG-SCI-N3');

INSERT INTO topics (module_id, name, description, display_order) 
SELECT id, 'Friction Applications', 'Static and kinetic friction in engineering systems', 2 
FROM modules WHERE name = 'Statics and Dynamics' AND subject_id IN (SELECT id FROM subjects WHERE code = 'ENG-SCI-N3');

-- Skills for Force Systems and Equilibrium
INSERT INTO skills (topic_id, name, description, difficulty_level, mastery_threshold, display_order) 
SELECT id, 'Resolve Forces into Components', 'Break down forces into rectangular components', 2, 85, 1 
FROM topics WHERE name = 'Force Systems and Equilibrium' AND module_id IN (
  SELECT id FROM modules WHERE name = 'Statics and Dynamics' AND subject_id IN (
    SELECT id FROM subjects WHERE code = 'ENG-SCI-N3'
  )
);

INSERT INTO skills (topic_id, name, description, difficulty_level, mastery_threshold, display_order) 
SELECT id, 'Calculate Resultant Forces', 'Determine resultant of multiple force systems', 3, 80, 2 
FROM topics WHERE name = 'Force Systems and Equilibrium' AND module_id IN (
  SELECT id FROM modules WHERE name = 'Statics and Dynamics' AND subject_id IN (
    SELECT id FROM subjects WHERE code = 'ENG-SCI-N3'
  )
);

-- Questions for Resolve Forces into Components
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'A force of 100 N acts at an angle of 30Â° to the horizontal. Calculate the horizontal component of this force.',
'{
  "options": [
    "86.6 N", 
    "50.0 N", 
    "100 N", 
    "70.7 N"
  ],
  "diagram": "Force diagram: 100N at 30Â° â†’ Fx = FcosÎ¸, Fy = FsinÎ¸"
}', 
'86.6 N',
'The horizontal component is calculated using Fâ‚“ = F Ã— cos(30Â°) = 100 Ã— 0.866 = 86.6 N',
2, 15
FROM skills WHERE name = 'Resolve Forces into Components' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Force Systems and Equilibrium' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Statics and Dynamics' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'ENG-SCI-N3'
    )
  )
);

INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'A force of 50 N acts at 60Â° to the vertical. What is the vertical component?',
'{
  "options": [
    "25.0 N", 
    "43.3 N", 
    "50.0 N", 
    "28.9 N"
  ],
  "diagram": "Force diagram: 50N at 60Â° from vertical"
}', 
'25.0 N',
'Vertical component = F Ã— cos(60Â°) = 50 Ã— 0.5 = 25.0 N',
2, 15
FROM skills WHERE name = 'Resolve Forces into Components' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Force Systems and Equilibrium' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Statics and Dynamics' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'ENG-SCI-N3'
    )
  )
);

-- Questions for Calculate Resultant Forces
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Two forces act on a point: 40 N east and 30 N north. What is the magnitude of the resultant force?',
'{
  "options": [
    "50 N", 
    "70 N", 
    "10 N", 
    "35 N"
  ],
  "diagram": "Vector addition: 40N â†’ + 30N â†‘ = Resultant"
}', 
'50 N',
'Resultant R = âˆš(40Â² + 30Â²) = âˆš(1600 + 900) = âˆš2500 = 50 N',
3, 20
FROM skills WHERE name = 'Calculate Resultant Forces' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Force Systems and Equilibrium' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Statics and Dynamics' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'ENG-SCI-N3'
    )
  )
);

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: generated_content\mathematics_n4.sql
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

-- =============================================
-- SUBJECT: Mathematics N4 - TEST CONTENT
-- =============================================

-- Subject creation
INSERT INTO subjects (name, code, nated_level, description, color_hex, display_order) 
VALUES ('Mathematics N4', 'MATH-N4', 'N4', 'Advanced mathematical concepts including calculus, algebra, and analytical geometry for engineering applications', '#2563EB', 6);

-- Modules for Mathematics N4
INSERT INTO modules (subject_id, name, description, display_order) 
SELECT id, 'Differential Calculus', 'Limits, derivatives and applications of differentiation', 1 
FROM subjects WHERE code = 'MATH-N4';

INSERT INTO modules (subject_id, name, description, display_order) 
SELECT id, 'Integral Calculus', 'Integration techniques and applications of definite integrals', 2 
FROM subjects WHERE code = 'MATH-N4';

INSERT INTO modules (subject_id, name, description, display_order) 
SELECT id, 'Algebra and Analytical Geometry', 'Complex numbers, matrices and coordinate geometry', 3 
FROM subjects WHERE code = 'MATH-N4';

-- Topics for Differential Calculus
INSERT INTO topics (module_id, name, description, display_order) 
SELECT id, 'Limits and Continuity', 'Evaluating limits and understanding function continuity', 1 
FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (SELECT id FROM subjects WHERE code = 'MATH-N4');

INSERT INTO topics (module_id, name, description, display_order) 
SELECT id, 'Differentiation Rules', 'Power rule, product rule, quotient rule and chain rule', 2 
FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (SELECT id FROM subjects WHERE code = 'MATH-N4');

INSERT INTO topics (module_id, name, description, display_order) 
SELECT id, 'Applications of Derivatives', 'Tangents, normals, rates of change and optimization', 3 
FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (SELECT id FROM subjects WHERE code = 'MATH-N4');

-- Topics for Integral Calculus
INSERT INTO topics (module_id, name, description, display_order) 
SELECT id, 'Integration Techniques', 'Substitution, integration by parts and partial fractions', 1 
FROM modules WHERE name = 'Integral Calculus' AND subject_id IN (SELECT id FROM subjects WHERE code = 'MATH-N4');

INSERT INTO topics (module_id, name, description, display_order) 
SELECT id, 'Definite Integrals', 'Area under curves and applications of definite integrals', 2 
FROM modules WHERE name = 'Integral Calculus' AND subject_id IN (SELECT id FROM subjects WHERE code = 'MATH-N4');

-- Topics for Algebra and Analytical Geometry
INSERT INTO topics (module_id, name, description, display_order) 
SELECT id, 'Complex Numbers', 'Operations with complex numbers and Argand diagrams', 1 
FROM modules WHERE name = 'Algebra and Analytical Geometry' AND subject_id IN (SELECT id FROM subjects WHERE code = 'MATH-N4');

INSERT INTO topics (module_id, name, description, display_order) 
SELECT id, 'Matrices and Determinants', 'Matrix operations and solving systems of equations', 2 
FROM modules WHERE name = 'Algebra and Analytical Geometry' AND subject_id IN (SELECT id FROM subjects WHERE code = 'MATH-N4');

-- Skills for Limits and Continuity
INSERT INTO skills (topic_id, name, description, difficulty_level, mastery_threshold, display_order) 
SELECT id, 'Evaluate Limits', 'Calculate limits using algebraic techniques and L''HÃ´pital''s rule', 2, 85, 1 
FROM topics WHERE name = 'Limits and Continuity' AND module_id IN (
  SELECT id FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (
    SELECT id FROM subjects WHERE code = 'MATH-N4'
  )
);

INSERT INTO skills (topic_id, name, description, difficulty_level, mastery_threshold, display_order) 
SELECT id, 'Determine Continuity', 'Analyze function continuity at given points', 3, 80, 2 
FROM topics WHERE name = 'Limits and Continuity' AND module_id IN (
  SELECT id FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (
    SELECT id FROM subjects WHERE code = 'MATH-N4'
  )
);

-- Skills for Differentiation Rules
INSERT INTO skills (topic_id, name, description, difficulty_level, mastery_threshold, display_order) 
SELECT id, 'Apply Power Rule', 'Differentiate polynomial functions using power rule', 1, 90, 1 
FROM topics WHERE name = 'Differentiation Rules' AND module_id IN (
  SELECT id FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (
    SELECT id FROM subjects WHERE code = 'MATH-N4'
  )
);

INSERT INTO skills (topic_id, name, description, difficulty_level, mastery_threshold, display_order) 
SELECT id, 'Apply Product and Quotient Rules', 'Differentiate products and quotients of functions', 3, 80, 2 
FROM topics WHERE name = 'Differentiation Rules' AND module_id IN (
  SELECT id FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (
    SELECT id FROM subjects WHERE code = 'MATH-N4'
  )
);

INSERT INTO skills (topic_id, name, description, difficulty_level, mastery_threshold, display_order) 
SELECT id, 'Apply Chain Rule', 'Differentiate composite functions using chain rule', 3, 75, 3 
FROM topics WHERE name = 'Differentiation Rules' AND module_id IN (
  SELECT id FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (
    SELECT id FROM subjects WHERE code = 'MATH-N4'
  )
);

-- Questions for Evaluate Limits
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Evaluate the limit: $$\\lim_{x \\to 2} \\frac{x^2 - 4}{x - 2}$$',
'{
  "options": [
    "4", 
    "0", 
    "2", 
    "Undefined"
  ],
  "latex": "$$\\lim_{x \\to 2} \\frac{x^2 - 4}{x - 2} = \\lim_{x \\to 2} \\frac{(x-2)(x+2)}{x-2} = \\lim_{x \\to 2} (x+2)$$"
}', 
'4',
'Factor and simplify: $$\\frac{x^2-4}{x-2} = \\frac{(x-2)(x+2)}{x-2} = x+2$$, then substitute x=2: 2+2=4',
2, 15
FROM skills WHERE name = 'Evaluate Limits' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Limits and Continuity' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Evaluate the limit: $$\\lim_{x \\to 0} \\frac{\\sin(3x)}{x}$$',
'{
  "options": [
    "3", 
    "0", 
    "1", 
    "Undefined"
  ],
  "latex": "Using standard limit: $$\\lim_{x \\to 0} \\frac{\\sin(kx)}{x} = k$$"
}', 
'3',
'Using the standard limit $$\\lim_{x \\to 0} \\frac{\\sin(kx)}{x} = k$$, with k=3 gives the answer 3',
2, 15
FROM skills WHERE name = 'Evaluate Limits' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Limits and Continuity' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

-- Questions for Apply Power Rule
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Find the derivative of $$f(x) = 4x^3 - 2x^2 + 5x - 7$$',
'{
  "options": [
    "$$12x^2 - 4x + 5$$", 
    "$$12x^2 - 4x + 12$$", 
    "$$4x^2 - 2x + 5$$", 
    "$$12x^3 - 4x^2 + 5x$$"
  ],
  "latex": "Apply power rule to each term: $$\\frac{d}{dx}(4x^3) = 12x^2$$, $$\\frac{d}{dx}(-2x^2) = -4x$$, $$\\frac{d}{dx}(5x) = 5$$, $$\\frac{d}{dx}(-7) = 0$$"
}', 
'$$12x^2 - 4x + 5$$',
'Apply power rule term by term: $$\\frac{d}{dx}(4x^3) = 12x^2$$, $$\\frac{d}{dx}(-2x^2) = -4x$$, $$\\frac{d}{dx}(5x) = 5$$, constant derivative is 0',
1, 10
FROM skills WHERE name = 'Apply Power Rule' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Differentiation Rules' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Differentiate $$y = \\frac{1}{x^2}$$',
'{
  "options": [
    "$$-\\frac{2}{x^3}$$", 
    "$$\\frac{2}{x^3}$$", 
    "$$-\\frac{1}{2x}$$", 
    "$$\\frac{1}{2x^3}$$"
  ],
  "latex": "Rewrite as $$y = x^{-2}$$ then apply power rule: $$\\frac{dy}{dx} = -2x^{-3} = -\\frac{2}{x^3}$$"
}', 
'$$-\\frac{2}{x^3}$$',
'Rewrite as $$y = x^{-2}$$, then apply power rule: $$\\frac{dy}{dx} = -2x^{-3} = -\\frac{2}{x^3}$$',
2, 15
FROM skills WHERE name = 'Apply Power Rule' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Differentiation Rules' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

-- Questions for Apply Product and Quotient Rules
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Find the derivative of $$f(x) = (x^2 + 1)(3x - 2)$$ using the product rule',
'{
  "options": [
    "$$9x^2 - 4x + 3$$", 
    "$$6x^2 - 4x + 3$$", 
    "$$3x^2 + 2x - 1$$", 
    "$$9x^2 + 4x - 3$$"
  ],
  "latex": "Product rule: $$f''(x) = (2x)(3x-2) + (x^2+1)(3)$$"
}', 
'$$9x^2 - 4x + 3$$',
'Product rule: $$f''(x) = (2x)(3x-2) + (x^2+1)(3) = 6x^2 - 4x + 3x^2 + 3 = 9x^2 - 4x + 3$$',
3, 20
FROM skills WHERE name = 'Apply Product and Quotient Rules' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Differentiation Rules' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Differentiate $$y = \\frac{x}{x^2 + 1}$$ using the quotient rule',
'{
  "options": [
    "$$\\frac{1 - x^2}{(x^2 + 1)^2}$$", 
    "$$\\frac{1 + x^2}{(x^2 + 1)^2}$$", 
    "$$\\frac{x^2 - 1}{(x^2 + 1)^2}$$", 
    "$$\\frac{2x}{(x^2 + 1)^2}$$"
  ],
  "latex": "Quotient rule: $$\\frac{dy}{dx} = \\frac{(1)(x^2+1) - (x)(2x)}{(x^2+1)^2}$$"
}', 
'$$\\frac{1 - x^2}{(x^2 + 1)^2}$$',
'Quotient rule: $$\\frac{dy}{dx} = \\frac{(1)(x^2+1) - (x)(2x)}{(x^2+1)^2} = \\frac{x^2+1-2x^2}{(x^2+1)^2} = \\frac{1-x^2}{(x^2+1)^2}$$',
3, 20
FROM skills WHERE name = 'Apply Product and Quotient Rules' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Differentiation Rules' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

-- Questions for Apply Chain Rule
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Find the derivative of $$y = (3x^2 + 2x)^4$$',
'{
  "options": [
    "$$4(3x^2 + 2x)^3(6x + 2)$$", 
    "$$4(3x^2 + 2x)^3$$", 
    "$$(3x^2 + 2x)^3(6x + 2)$$", 
    "$$12x(3x^2 + 2x)^3$$"
  ],
  "latex": "Chain rule: $$\\frac{dy}{dx} = 4(3x^2+2x)^3 \\cdot (6x+2)$$"
}', 
'$$4(3x^2 + 2x)^3(6x + 2)$$',
'Chain rule: outer function derivative is $$4(3x^2+2x)^3$$ times inner function derivative $$6x+2$$',
3, 20
FROM skills WHERE name = 'Apply Chain Rule' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Differentiation Rules' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Differentiate $$y = \\sin(2x^3)$$',
'{
  "options": [
    "$$6x^2 \\cos(2x^3)$$", 
    "$$\\cos(2x^3)$$", 
    "$$2x^2 \\cos(2x^3)$$", 
    "$$6x^2 \\sin(2x^3)$$"
  ],
  "latex": "Chain rule: $$\\frac{dy}{dx} = \\cos(2x^3) \\cdot 6x^2$$"
}', 
'$$6x^2 \\cos(2x^3)$$',
'Chain rule: derivative of outer function $$\\cos(2x^3)$$ times derivative of inner function $$6x^2$$',
3, 20
FROM skills WHERE name = 'Apply Chain Rule' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Differentiation Rules' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Differential Calculus' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

-- Skills for Integration Techniques
INSERT INTO skills (topic_id, name, description, difficulty_level, mastery_threshold, display_order) 
SELECT id, 'Basic Integration', 'Integrate polynomial functions and basic trigonometric functions', 2, 85, 1 
FROM topics WHERE name = 'Integration Techniques' AND module_id IN (
  SELECT id FROM modules WHERE name = 'Integral Calculus' AND subject_id IN (
    SELECT id FROM subjects WHERE code = 'MATH-N4'
  )
);

INSERT INTO skills (topic_id, name, description, difficulty_level, mastery_threshold, display_order) 
SELECT id, 'Integration by Substitution', 'Use substitution method to solve integrals', 3, 75, 2 
FROM topics WHERE name = 'Integration Techniques' AND module_id IN (
  SELECT id FROM modules WHERE name = 'Integral Calculus' AND subject_id IN (
    SELECT id FROM subjects WHERE code = 'MATH-N4'
  )
);

-- Questions for Basic Integration
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Evaluate $$\\int (3x^2 - 2x + 1) dx$$',
'{
  "options": [
    "$$x^3 - x^2 + x + C$$", 
    "$$3x^3 - 2x^2 + x + C$$", 
    "$$x^3 - 2x^2 + x + C$$", 
    "$$6x - 2 + C$$"
  ],
  "latex": "Integrate term by term: $$\\int 3x^2 dx = x^3$$, $$\\int -2x dx = -x^2$$, $$\\int 1 dx = x$$"
}', 
'$$x^3 - x^2 + x + C$$',
'Integrate term by term: $$\\int 3x^2 dx = x^3$$, $$\\int -2x dx = -x^2$$, $$\\int 1 dx = x$$, plus constant C',
2, 15
FROM skills WHERE name = 'Basic Integration' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Integration Techniques' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Integral Calculus' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Evaluate $$\\int \\cos(x) dx$$',
'{
  "options": [
    "$$\\sin(x) + C$$", 
    "$$-\\sin(x) + C$$", 
    "$$\\cos(x) + C$$", 
    "$$-\\cos(x) + C$$"
  ],
  "latex": "Standard integral: $$\\int \\cos(x) dx = \\sin(x) + C$$"
}', 
'$$\\sin(x) + C$$',
'Standard integral result: $$\\int \\cos(x) dx = \\sin(x) + C$$',
1, 10
FROM skills WHERE name = 'Basic Integration' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Integration Techniques' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Integral Calculus' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

-- Questions for Integration by Substitution
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Evaluate $$\\int 2x \\cdot e^{x^2} dx$$ using substitution',
'{
  "options": [
    "$$e^{x^2} + C$$", 
    "$$2e^{x^2} + C$$", 
    "$$x^2 e^{x^2} + C$$", 
    "$$\\frac{1}{2}e^{x^2} + C$$"
  ],
  "latex": "Let u = xÂ², then du = 2x dx, so $$\\int e^u du = e^u + C = e^{x^2} + C$$"
}', 
'$$e^{x^2} + C$$',
'Let u = xÂ², then du = 2x dx. The integral becomes $$\\int e^u du = e^u + C = e^{x^2} + C$$',
3, 20
FROM skills WHERE name = 'Integration by Substitution' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Integration Techniques' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Integral Calculus' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

-- Skills for Complex Numbers
INSERT INTO skills (topic_id, name, description, difficulty_level, mastery_threshold, display_order) 
SELECT id, 'Complex Number Operations', 'Add, subtract, multiply and divide complex numbers', 2, 85, 1 
FROM topics WHERE name = 'Complex Numbers' AND module_id IN (
  SELECT id FROM modules WHERE name = 'Algebra and Analytical Geometry' AND subject_id IN (
    SELECT id FROM subjects WHERE code = 'MATH-N4'
  )
);

INSERT INTO skills (topic_id, name, description, difficulty_level, mastery_threshold, display_order) 
SELECT id, 'Polar Form Conversion', 'Convert between rectangular and polar forms of complex numbers', 3, 80, 2 
FROM topics WHERE name = 'Complex Numbers' AND module_id IN (
  SELECT id FROM modules WHERE name = 'Algebra and Analytical Geometry' AND subject_id IN (
    SELECT id FROM subjects WHERE code = 'MATH-N4'
  )
);

-- Questions for Complex Number Operations
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Simplify: (3 + 2i) + (1 - 4i)',
'{
  "options": [
    "4 - 2i", 
    "2 + 6i", 
    "4 + 6i", 
    "2 - 2i"
  ],
  "diagram": "Add real parts: 3+1=4, Add imaginary parts: 2i-4i=-2i"
}', 
'4 - 2i',
'Add real parts: 3 + 1 = 4, Add imaginary parts: 2i - 4i = -2i',
1, 10
FROM skills WHERE name = 'Complex Number Operations' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Complex Numbers' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Algebra and Analytical Geometry' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Multiply: (2 + i)(3 - 2i)',
'{
  "options": [
    "8 - i", 
    "4 + 7i", 
    "8 + 7i", 
    "4 - i"
  ],
  "latex": "FOIL method: (2)(3) + (2)(-2i) + (i)(3) + (i)(-2i) = 6 - 4i + 3i - 2iÂ²"
}', 
'8 - i',
'FOIL: 6 - 4i + 3i - 2iÂ² = 6 - i - 2(-1) = 6 - i + 2 = 8 - i',
2, 15
FROM skills WHERE name = 'Complex Number Operations' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Complex Numbers' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Algebra and Analytical Geometry' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

-- Questions for Polar Form Conversion
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Convert the complex number 1 + i to polar form',
'{
  "options": [
    "$$\\sqrt{2}(\\cos\\frac{\\pi}{4} + i\\sin\\frac{\\pi}{4})$$", 
    "$$2(\\cos\\frac{\\pi}{4} + i\\sin\\frac{\\pi}{4})$$", 
    "$$\\sqrt{2}(\\cos\\frac{\\pi}{2} + i\\sin\\frac{\\pi}{2})$$", 
    "$$2(\\cos\\frac{\\pi}{2} + i\\sin\\frac{\\pi}{2})$$"
  ],
  "latex": "r = âˆš(1Â²+1Â²)=âˆš2, Î¸ = tanâ»Â¹(1/1)=Ï€/4"
}', 
'$$\\sqrt{2}(\\cos\\frac{\\pi}{4} + i\\sin\\frac{\\pi}{4})$$',
'Magnitude r = âˆš(1Â²+1Â²)=âˆš2, Argument Î¸ = tanâ»Â¹(1/1)=Ï€/4',
3, 20
FROM skills WHERE name = 'Polar Form Conversion' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Complex Numbers' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Algebra and Analytical Geometry' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

-- Skills for Matrices and Determinants
INSERT INTO skills (topic_id, name, description, difficulty_level, mastery_threshold, display_order) 
SELECT id, 'Matrix Operations', 'Perform matrix addition, subtraction and multiplication', 2, 85, 1 
FROM topics WHERE name = 'Matrices and Determinants' AND module_id IN (
  SELECT id FROM modules WHERE name = 'Algebra and Analytical Geometry' AND subject_id IN (
    SELECT id FROM subjects WHERE code = 'MATH-N4'
  )
);

INSERT INTO skills (topic_id, name, description, difficulty_level, mastery_threshold, display_order) 
SELECT id, 'Calculate Determinants', 'Find determinants of 2x2 and 3x3 matrices', 3, 80, 2 
FROM topics WHERE name = 'Matrices and Determinants' AND module_id IN (
  SELECT id FROM modules WHERE name = 'Algebra and Analytical Geometry' AND subject_id IN (
    SELECT id FROM subjects WHERE code = 'MATH-N4'
  )
);

-- Questions for Matrix Operations
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Multiply: $$\\begin{bmatrix} 2 & 1 \\\\ 3 & 4 \\end{bmatrix} \\begin{bmatrix} 1 & 0 \\\\ 2 & 3 \\end{bmatrix}$$',
'{
  "options": [
    "$$\\begin{bmatrix} 4 & 3 \\\\ 11 & 12 \\end{bmatrix}$$", 
    "$$\\begin{bmatrix} 2 & 0 \\\\ 6 & 12 \\end{bmatrix}$$", 
    "$$\\begin{bmatrix} 3 & 3 \\\\ 10 & 12 \\end{bmatrix}$$", 
    "$$\\begin{bmatrix} 4 & 3 \\\\ 10 & 12 \\end{bmatrix}$$"
  ],
  "latex": "Matrix multiplication: row1: 2Ã—1+1Ã—2=4, 2Ã—0+1Ã—3=3; row2: 3Ã—1+4Ã—2=11, 3Ã—0+4Ã—3=12"
}', 
'$$\\begin{bmatrix} 4 & 3 \\\\ 11 & 12 \\end{bmatrix}$$',
'Row1: 2Ã—1+1Ã—2=4, 2Ã—0+1Ã—3=3; Row2: 3Ã—1+4Ã—2=11, 3Ã—0+4Ã—3=12',
3, 20
FROM skills WHERE name = 'Matrix Operations' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Matrices and Determinants' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Algebra and Analytical Geometry' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);

-- Questions for Calculate Determinants
INSERT INTO questions (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
SELECT id, 'multiple_choice', 
'Find the determinant of $$\\begin{bmatrix} 3 & 2 \\\\ 1 & 4 \\end{bmatrix}$$',
'{
  "options": [
    "10", 
    "14", 
    "12", 
    "8"
  ],
  "latex": "det = (3)(4) - (2)(1) = 12 - 2 = 10"
}', 
'10',
'For 2x2 matrix, determinant = ad - bc = (3)(4) - (2)(1) = 12 - 2 = 10',
2, 15
FROM skills WHERE name = 'Calculate Determinants' AND topic_id IN (
  SELECT id FROM topics WHERE name = 'Matrices and Determinants' AND module_id IN (
    SELECT id FROM modules WHERE name = 'Algebra and Analytical Geometry' AND subject_id IN (
      SELECT id FROM subjects WHERE code = 'MATH-N4'
    )
  )
);


============================================================
DIRECTORY: migrations
============================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: migrations\1.sql
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


-- Core user profile extension
CREATE TABLE user_profiles (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id TEXT NOT NULL UNIQUE,
  role TEXT NOT NULL DEFAULT 'student',
  institution_id INTEGER,
  grade_level TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_user_profiles_user_id ON user_profiles(user_id);
CREATE INDEX idx_user_profiles_institution_id ON user_profiles(institution_id);

-- Institutions (schools, colleges, training centers)
CREATE TABLE institutions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  institution_type TEXT,
  contact_email TEXT,
  contact_phone TEXT,
  address TEXT,
  is_active BOOLEAN DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Subjects (e.g., Mathematics N4, Engineering Science N5)
CREATE TABLE subjects (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  code TEXT NOT NULL UNIQUE,
  nated_level TEXT NOT NULL,
  description TEXT,
  icon_url TEXT,
  color_hex TEXT,
  display_order INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_subjects_code ON subjects(code);
CREATE INDEX idx_subjects_nated_level ON subjects(nated_level);

-- Modules (chapters within a subject)
CREATE TABLE modules (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  subject_id INTEGER NOT NULL,
  name TEXT NOT NULL,
  description TEXT,
  display_order INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_modules_subject_id ON modules(subject_id);

-- Topics (sections within a module)
CREATE TABLE topics (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  module_id INTEGER NOT NULL,
  name TEXT NOT NULL,
  description TEXT,
  display_order INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_topics_module_id ON topics(module_id);

-- Skills (individual practice skills - the core learning unit)
CREATE TABLE skills (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  topic_id INTEGER NOT NULL,
  name TEXT NOT NULL,
  description TEXT,
  difficulty_level INTEGER DEFAULT 1,
  display_order INTEGER DEFAULT 0,
  mastery_threshold INTEGER DEFAULT 90,
  is_active BOOLEAN DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_skills_topic_id ON skills(topic_id);

-- Questions (question bank)
CREATE TABLE questions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  skill_id INTEGER NOT NULL,
  question_type TEXT NOT NULL,
  question_text TEXT NOT NULL,
  question_data TEXT,
  correct_answer TEXT NOT NULL,
  explanation TEXT,
  difficulty_rating INTEGER DEFAULT 1,
  blooms_level TEXT,
  points_value INTEGER DEFAULT 10,
  is_active BOOLEAN DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_questions_skill_id ON questions(skill_id);
CREATE INDEX idx_questions_difficulty_rating ON questions(difficulty_rating);

-- Student skill progress (tracks mastery per skill)
CREATE TABLE skill_progress (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id TEXT NOT NULL,
  skill_id INTEGER NOT NULL,
  smart_score INTEGER DEFAULT 0,
  questions_attempted INTEGER DEFAULT 0,
  questions_correct INTEGER DEFAULT 0,
  current_streak INTEGER DEFAULT 0,
  best_streak INTEGER DEFAULT 0,
  time_spent_seconds INTEGER DEFAULT 0,
  is_mastered BOOLEAN DEFAULT 0,
  mastered_at TIMESTAMP,
  last_practiced_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(user_id, skill_id)
);

CREATE INDEX idx_skill_progress_user_id ON skill_progress(user_id);
CREATE INDEX idx_skill_progress_skill_id ON skill_progress(skill_id);
CREATE INDEX idx_skill_progress_smart_score ON skill_progress(smart_score);

-- Practice sessions
CREATE TABLE practice_sessions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id TEXT NOT NULL,
  skill_id INTEGER NOT NULL,
  session_type TEXT DEFAULT 'practice',
  start_time TIMESTAMP NOT NULL,
  end_time TIMESTAMP,
  questions_attempted INTEGER DEFAULT 0,
  questions_correct INTEGER DEFAULT 0,
  final_score INTEGER DEFAULT 0,
  is_completed BOOLEAN DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_practice_sessions_user_id ON practice_sessions(user_id);
CREATE INDEX idx_practice_sessions_skill_id ON practice_sessions(skill_id);

-- Question attempts (tracks each question answered)
CREATE TABLE question_attempts (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  session_id INTEGER NOT NULL,
  question_id INTEGER NOT NULL,
  user_id TEXT NOT NULL,
  user_answer TEXT,
  is_correct BOOLEAN NOT NULL,
  time_spent_seconds INTEGER,
  attempted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_question_attempts_session_id ON question_attempts(session_id);
CREATE INDEX idx_question_attempts_user_id ON question_attempts(user_id);
CREATE INDEX idx_question_attempts_question_id ON question_attempts(question_id);

-- Achievements and badges
CREATE TABLE achievements (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  description TEXT,
  badge_icon_url TEXT,
  achievement_type TEXT NOT NULL,
  criteria_json TEXT,
  points_value INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- User achievements
CREATE TABLE user_achievements (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id TEXT NOT NULL,
  achievement_id INTEGER NOT NULL,
  earned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(user_id, achievement_id)
);

CREATE INDEX idx_user_achievements_user_id ON user_achievements(user_id);

-- Classes (for teacher grouping of students)
CREATE TABLE classes (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  teacher_id TEXT NOT NULL,
  institution_id INTEGER,
  name TEXT NOT NULL,
  subject_id INTEGER,
  class_code TEXT UNIQUE,
  is_active BOOLEAN DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_classes_teacher_id ON classes(teacher_id);
CREATE INDEX idx_classes_institution_id ON classes(institution_id);

-- Class enrollments
CREATE TABLE class_enrollments (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  class_id INTEGER NOT NULL,
  student_id TEXT NOT NULL,
  enrolled_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(class_id, student_id)
);

CREATE INDEX idx_class_enrollments_class_id ON class_enrollments(class_id);
CREATE INDEX idx_class_enrollments_student_id ON class_enrollments(student_id);

-- Skill assignments (teacher assigns skills to students)
CREATE TABLE skill_assignments (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  teacher_id TEXT NOT NULL,
  student_id TEXT NOT NULL,
  skill_id INTEGER NOT NULL,
  due_date DATE,
  is_completed BOOLEAN DEFAULT 0,
  completed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_skill_assignments_teacher_id ON skill_assignments(teacher_id);
CREATE INDEX idx_skill_assignments_student_id ON skill_assignments(student_id);
CREATE INDEX idx_skill_assignments_skill_id ON skill_assignments(skill_id);


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: migrations\2.sql
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


CREATE TABLE daily_challenges (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  challenge_date DATE NOT NULL UNIQUE,
  skill_id INTEGER NOT NULL,
  target_questions INTEGER DEFAULT 5,
  target_accuracy INTEGER DEFAULT 80,
  xp_reward INTEGER DEFAULT 100,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE user_daily_challenges (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id TEXT NOT NULL,
  challenge_id INTEGER NOT NULL,
  questions_completed INTEGER DEFAULT 0,
  questions_correct INTEGER DEFAULT 0,
  is_completed BOOLEAN DEFAULT 0,
  completed_at TIMESTAMP,
  xp_earned INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(user_id, challenge_id)
);

CREATE TABLE user_stats (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id TEXT NOT NULL UNIQUE,
  total_xp INTEGER DEFAULT 0,
  level INTEGER DEFAULT 1,
  total_questions_answered INTEGER DEFAULT 0,
  total_correct_answers INTEGER DEFAULT 0,
  longest_streak INTEGER DEFAULT 0,
  current_weekly_streak INTEGER DEFAULT 0,
  total_time_spent_seconds INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE leaderboard_entries (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id TEXT NOT NULL,
  category TEXT NOT NULL,
  score INTEGER DEFAULT 0,
  rank INTEGER,
  period_start DATE NOT NULL,
  period_end DATE NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(user_id, category, period_start)
);

CREATE INDEX idx_daily_challenges_date ON daily_challenges(challenge_date);
CREATE INDEX idx_user_daily_challenges_user ON user_daily_challenges(user_id);
CREATE INDEX idx_user_stats_user ON user_stats(user_id);
CREATE INDEX idx_leaderboard_category ON leaderboard_entries(category, period_start);



============================================================
DIRECTORY: migrations\1
============================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: migrations\1\down.sql
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


DROP INDEX IF EXISTS idx_skill_assignments_skill_id;
DROP INDEX IF EXISTS idx_skill_assignments_student_id;
DROP INDEX IF EXISTS idx_skill_assignments_teacher_id;
DROP TABLE IF EXISTS skill_assignments;

DROP INDEX IF EXISTS idx_class_enrollments_student_id;
DROP INDEX IF EXISTS idx_class_enrollments_class_id;
DROP TABLE IF EXISTS class_enrollments;

DROP INDEX IF EXISTS idx_classes_institution_id;
DROP INDEX IF EXISTS idx_classes_teacher_id;
DROP TABLE IF EXISTS classes;

DROP INDEX IF EXISTS idx_user_achievements_user_id;
DROP TABLE IF EXISTS user_achievements;
DROP TABLE IF EXISTS achievements;

DROP INDEX IF EXISTS idx_question_attempts_question_id;
DROP INDEX IF EXISTS idx_question_attempts_user_id;
DROP INDEX IF EXISTS idx_question_attempts_session_id;
DROP TABLE IF EXISTS question_attempts;

DROP INDEX IF EXISTS idx_practice_sessions_skill_id;
DROP INDEX IF EXISTS idx_practice_sessions_user_id;
DROP TABLE IF EXISTS practice_sessions;

DROP INDEX IF EXISTS idx_skill_progress_smart_score;
DROP INDEX IF EXISTS idx_skill_progress_skill_id;
DROP INDEX IF EXISTS idx_skill_progress_user_id;
DROP TABLE IF EXISTS skill_progress;

DROP INDEX IF EXISTS idx_questions_difficulty_rating;
DROP INDEX IF EXISTS idx_questions_skill_id;
DROP TABLE IF EXISTS questions;

DROP INDEX IF EXISTS idx_skills_topic_id;
DROP TABLE IF EXISTS skills;

DROP INDEX IF EXISTS idx_topics_module_id;
DROP TABLE IF EXISTS topics;

DROP INDEX IF EXISTS idx_modules_subject_id;
DROP TABLE IF EXISTS modules;

DROP INDEX IF EXISTS idx_subjects_nated_level;
DROP INDEX IF EXISTS idx_subjects_code;
DROP TABLE IF EXISTS subjects;

DROP TABLE IF EXISTS institutions;

DROP INDEX IF EXISTS idx_user_profiles_institution_id;
DROP INDEX IF EXISTS idx_user_profiles_user_id;
DROP TABLE IF EXISTS user_profiles;



============================================================
DIRECTORY: migrations\2
============================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: migrations\2\down.sql
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


DROP INDEX idx_leaderboard_category;
DROP INDEX idx_user_stats_user;
DROP INDEX idx_user_daily_challenges_user;
DROP INDEX idx_daily_challenges_date;
DROP TABLE leaderboard_entries;
DROP TABLE user_stats;
DROP TABLE user_daily_challenges;
DROP TABLE daily_challenges;



============================================================
DIRECTORY: scripts
============================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: scripts\content_injector.py
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

#!/usr/bin/env python3
"""
NATED Engineering Content Injector
Automatically processes LLM-generated SQL and injects into database
"""

import sqlite3
import re
import json
import os
from pathlib import Path
from typing import Dict, List, Tuple

class ContentInjector:
    def __init__(self, db_path: str):
        self.db_path = db_path
        self.conn = sqlite3.connect(db_path)
        self.conn.row_factory = sqlite3.Row
        
    def execute_sql_file(self, file_path: str) -> Dict:
        """Execute SQL file and return results with validation"""
        with open(file_path, 'r', encoding='utf-8') as f:
            sql_content = f.read()
        
        # Split into individual statements
        statements = self._split_sql_statements(sql_content)
        
        results = {
            'total_statements': len(statements),
            'successful': 0,
            'failed': 0,
            'errors': [],
            'inserted_ids': {}
        }
        
        for i, statement in enumerate(statements):
            if not statement.strip():
                continue
                
            try:
                cursor = self.conn.cursor()
                cursor.execute(statement)
                
                if statement.strip().upper().startswith('INSERT'):
                    results['successful'] += 1
                    last_id = cursor.lastrowid
                    # Extract table name for tracking
                    table_match = re.search(r'INSERT INTO (\w+)', statement, re.IGNORECASE)
                    if table_match:
                        table_name = table_match.group(1)
                        if table_name not in results['inserted_ids']:
                            results['inserted_ids'][table_name] = []
                        results['inserted_ids'][table_name].append(last_id)
                
            except Exception as e:
                results['failed'] += 1
                results['errors'].append({
                    'statement': i + 1,
                    'error': str(e),
                    'sql': statement[:100] + '...' if len(statement) > 100 else statement
                })
                print(f"âŒ Error in statement {i+1}: {e}")
        
        self.conn.commit()
        return results
    
    def _split_sql_statements(self, sql_content: str) -> List[str]:
        """Split SQL content into individual statements"""
        # Remove comments
        sql_content = re.sub(r'--.*$', '', sql_content, flags=re.MULTILINE)
        sql_content = re.sub(r'/\*.*?\*/', '', sql_content, flags=re.DOTALL)
        
        # Split on semicolons, but not within quotes or parentheses
        statements = []
        current = ""
        paren_depth = 0
        in_quote = False
        quote_char = None
        
        for char in sql_content:
            if char in ['"', "'"] and not in_quote:
                in_quote = True
                quote_char = char
            elif char == quote_char and in_quote:
                in_quote = False
                quote_char = None
            elif char == '(' and not in_quote:
                paren_depth += 1
            elif char == ')' and not in_quote:
                paren_depth -= 1
            elif char == ';' and not in_quote and paren_depth == 0:
                statements.append(current.strip())
                current = ""
                continue
            
            current += char
        
        if current.strip():
            statements.append(current.strip())
            
        return [s for s in statements if s and not s.isspace()]
    
    def get_content_stats(self) -> Dict:
        """Get current database content statistics"""
        cursor = self.conn.cursor()
        
        stats = {}
        tables = ['subjects', 'modules', 'topics', 'skills', 'questions']
        
        for table in tables:
            cursor.execute(f"SELECT COUNT(*) as count FROM {table} WHERE is_active = 1")
            stats[table] = cursor.fetchone()['count']
        
        return stats
    
    def backup_database(self, backup_path: str):
        """Create database backup before injection"""
        backup_conn = sqlite3.connect(backup_path)
        self.conn.backup(backup_conn)
        backup_conn.close()
        print(f"âœ… Database backed up to: {backup_path}")

def find_database_file():
    """Find the SQLite database file in common locations"""
    possible_paths = [
        ".wrangler/state/v3/d1/miniflare-D1DatabaseObject/",  # Local development
        ".wrangler/state/v3/d1/",  # Alternative location
        "./"  # Current directory
    ]
    
    for base_path in possible_paths:
        if os.path.exists(base_path):
            for file in os.listdir(base_path):
                if file.endswith('.sqlite'):
                    return os.path.join(base_path, file)
    
    return None

def main():
    print("ğŸš€ NATED Content Injector Starting...")
    
    # Find database file automatically
    db_path = find_database_file()
    
    if not db_path:
        print("âŒ Could not find database file automatically.")
        print("Please specify the path to your SQLite database file:")
        db_path = input("Database path: ").strip()
        
        if not os.path.exists(db_path):
            print(f"âŒ Database file not found: {db_path}")
            return
    
    print(f"ğŸ“ Using database: {db_path}")
    
    # Initialize injector
    injector = ContentInjector(db_path)
    
    # Create backup
    backup_dir = "database_backups"
    os.makedirs(backup_dir, exist_ok=True)
    backup_path = os.path.join(backup_dir, f"backup_before_injection.sqlite")
    injector.backup_database(backup_path)
    
    # Show current stats
    print("\nğŸ“Š Current Database Statistics:")
    current_stats = injector.get_content_stats()
    for table, count in current_stats.items():
        print(f"  {table}: {count}")
    
    # Process SQL files
    sql_content_dir = "generated_content"
    if not os.path.exists(sql_content_dir):
        print(f"\nğŸ“ Creating {sql_content_dir} directory...")
        os.makedirs(sql_content_dir)
        print(f"âœ… Please place your SQL files in the '{sql_content_dir}' folder")
        print(f"   Then run this script again.")
        injector.conn.close()
        return
    
    sql_files = list(Path(sql_content_dir).glob("*.sql"))
    
    if not sql_files:
        print(f"\nâŒ No SQL files found in {sql_content_dir}")
        print(f"Please add SQL files to the '{sql_content_dir}' folder.")
        injector.conn.close()
        return
    
    print(f"\nğŸ“ Found {len(sql_files)} SQL file(s) to process:")
    for sql_file in sql_files:
        print(f"  - {sql_file.name}")
    
    total_results = {
        'files_processed': 0,
        'total_statements': 0,
        'successful': 0,
        'failed': 0
    }
    
    # Process each SQL file
    for sql_file in sql_files:
        print(f"\nğŸ”„ Processing: {sql_file.name}")
        results = injector.execute_sql_file(str(sql_file))
        
        total_results['files_processed'] += 1
        total_results['total_statements'] += results['total_statements']
        total_results['successful'] += results['successful']
        total_results['failed'] += results['failed']
        
        print(f"  ğŸ“ Statements: {results['total_statements']}")
        print(f"  âœ… Successful: {results['successful']}")
        print(f"  âŒ Failed: {results['failed']}")
        
        if results['errors']:
            print("  âš ï¸  Errors (first 3):")
            for error in results['errors'][:3]:
                print(f"    - Statement {error['statement']}: {error['error']}")
    
    # Show final statistics
    print(f"\nğŸ‰ INJECTION COMPLETE")
    print("=" * 50)
    print(f"ğŸ“ Files processed: {total_results['files_processed']}")
    print(f"ğŸ“ Total statements: {total_results['total_statements']}")
    print(f"âœ… Successful: {total_results['successful']}")
    print(f"âŒ Failed: {total_results['failed']}")
    
    print("\nğŸ“Š Database Statistics Comparison:")
    new_stats = injector.get_content_stats()
    for table in ['subjects', 'modules', 'topics', 'skills', 'questions']:
        old_count = current_stats.get(table, 0)
        new_count = new_stats.get(table, 0)
        growth = new_count - old_count
        print(f"  {table}: {old_count} â†’ {new_count} (+{growth})")
    
    injector.conn.close()
    print(f"\nâœ… All operations completed successfully!")
    print(f"ğŸ’¾ Backup saved as: {backup_path}")

if __name__ == "__main__":
    main()


============================================================
DIRECTORY: src\react-app
============================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\App.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { BrowserRouter as Router, Routes, Route } from "react-router";
import { AuthProvider } from "@getmocha/users-service/react";
import HomePage from "@/react-app/pages/Home";
import AuthCallbackPage from "@/react-app/pages/AuthCallback";
import DashboardPage from "@/react-app/pages/Dashboard";
import SubjectsPage from "@/react-app/pages/Subjects";
import SubjectDetailPage from "@/react-app/pages/SubjectDetail";
import ModuleDetailPage from "@/react-app/pages/ModuleDetail";
import SkillPracticePage from "@/react-app/pages/SkillPractice";
import AnalyticsPage from "@/react-app/pages/Analytics";
import AchievementsPage from "@/react-app/pages/Achievements";
import LeaderboardPage from "@/react-app/pages/Leaderboard";
import DailyChallengesPage from "@/react-app/pages/DailyChallenges";
import AdminContentManager from "@/react-app/pages/AdminContentManager";
import JsonBulkImporter from "@/react-app/pages/JsonBulkImporter";


// Development wrapper component to bypass auth
const DevRouteWrapper = ({ children }: { children: React.ReactNode }) => {
  return <>{children}</>;
};

export default function App() {
  const devMode = true; // Set to true for development

  return (
    <AuthProvider>
      <Router>
        <Routes>
          <Route path="/" element={<HomePage />} />
          <Route path="/auth/callback" element={<AuthCallbackPage />} />
          
          {/* Wrap all authenticated routes with development bypass */}
          <Route path="/dashboard" element={
            devMode ? <DashboardPage /> : <DevRouteWrapper><DashboardPage /></DevRouteWrapper>
          } />
          <Route path="/subjects" element={
            devMode ? <SubjectsPage /> : <DevRouteWrapper><SubjectsPage /></DevRouteWrapper>
          } />
          <Route path="/subjects/:id" element={
            devMode ? <SubjectDetailPage /> : <DevRouteWrapper><SubjectDetailPage /></DevRouteWrapper>
          } />
          <Route path="/modules/:id" element={
            devMode ? <ModuleDetailPage /> : <DevRouteWrapper><ModuleDetailPage /></DevRouteWrapper>
          } />
          <Route path="/skills/:id/practice" element={
            devMode ? <SkillPracticePage /> : <DevRouteWrapper><SkillPracticePage /></DevRouteWrapper>
          } />
          <Route path="/analytics" element={
            devMode ? <AnalyticsPage /> : <DevRouteWrapper><AnalyticsPage /></DevRouteWrapper>
          } />
          <Route path="/achievements" element={
            devMode ? <AchievementsPage /> : <DevRouteWrapper><AchievementsPage /></DevRouteWrapper>
          } />
          <Route path="/leaderboard" element={
            devMode ? <LeaderboardPage /> : <DevRouteWrapper><LeaderboardPage /></DevRouteWrapper>
          } />
          <Route path="/daily-challenges" element={
            devMode ? <DailyChallengesPage /> : <DevRouteWrapper><DailyChallengesPage /></DevRouteWrapper>
          } />

          <Route path="/admin/content" element={
            devMode ? <AdminContentManager /> : <DevRouteWrapper><AdminContentManager /></DevRouteWrapper>
          } />

          <Route path="/admin/bulk-import" element={
            devMode ? <JsonBulkImporter /> : <DevRouteWrapper><JsonBulkImporter /></DevRouteWrapper>
          } />
       
        </Routes>
      </Router>
    </AuthProvider>
  );
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\index.css
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
}


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\main.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { StrictMode } from "react";
import { createRoot } from "react-dom/client";
import "@/react-app/index.css";
import App from "@/react-app/App.tsx";

createRoot(document.getElementById("root")!).render(
  <StrictMode>
    <App />
  </StrictMode>
);


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\router.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { createBrowserRouter } from "react-router-dom";
import ProtectedRoute from "./components/ProtectedRoute";
import GuestRoute from "./components/GuestRoute";

// Pages
import HomePage from "./pages/Home";
import Dashboard from "./pages/Dashboard";
import Subjects from "./pages/Subjects"; // Import Subjects
import SubjectDetail from "./pages/SubjectDetail"; // <<< New Import
import SkillPractice from "./pages/SkillPractice";
import Leaderboard from "./pages/Leaderboard";
import Achievements from "./pages/Achievements";
import DailyChallenges from "./pages/DailyChallenges"; // Import DailyChallenges
import Analytics from "./pages/Analytics"; // Import Analytics

export const router = createBrowserRouter([
  {
    path: "/",
    element: <GuestRoute element={<HomePage />} />,
  },
  {
    path: "/dashboard",
    element: <ProtectedRoute element={<Dashboard />} />,
  },
  // --- Core Learning Flow Routes ---
  {
    path: "/subjects",
    element: <ProtectedRoute element={<Subjects />} />, // Subjects List
  },
  {
    path: "/subjects/:id", // <<< New Route for Subject Detail
    element: <ProtectedRoute element={<SubjectDetail />} />,
  },
  {
    path: "/skills/:id/practice",
    element: <ProtectedRoute element={<SkillPractice />} />,
  },
  // --- Feature Routes ---
  {
    path: "/leaderboard",
    element: <ProtectedRoute element={<Leaderboard />} />,
  },
  {
    path: "/achievements",
    element: <ProtectedRoute element={<Achievements />} />,
  },
  {
    path: "/challenges",
    element: <ProtectedRoute element={<DailyChallenges />} />, // Daily Challenges Route
  },
  {
    path: "/analytics",
    element: <ProtectedRoute element={<Analytics />} />, // Analytics Route
  },
]);

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\vite-env.d.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/// <reference types="vite/client" />



============================================================
DIRECTORY: src\react-app\components
============================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\components\Navigation.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// src/react-app/components/Navigation.tsx
import { useNavigate, useLocation } from "react-router";
import { BookOpen, LayoutDashboard, Library, LogOut, User, Menu } from "lucide-react";
import { useState } from "react";
import type { MochaUser } from "@getmocha/users-service/shared";

interface NavigationProps {
  onLogout: () => void;
  user: MochaUser;
}

export default function Navigation({ onLogout, user }: NavigationProps) {
  const navigate = useNavigate();
  const location = useLocation();
  const [showMoreMenu, setShowMoreMenu] = useState(false);

  const navItems = [
    { path: "/dashboard", label: "Dashboard", icon: LayoutDashboard },
    { path: "/subjects", label: "Subjects", icon: Library },
  ];

  const moreItems = [
    { path: "/analytics", label: "Analytics" },
    { path: "/achievements", label: "Achievements" },
    { path: "/leaderboard", label: "Leaderboard" },
    { path: "/daily-challenges", label: "Daily Challenges" },
  ];

  const handleNavigation = (path: string) => {
    console.log("Navigating to:", path); // Debug log
    navigate(path);
  };

  return (
    <nav className="bg-white border-b border-gray-200 sticky top-0 z-50 backdrop-blur-sm bg-white/95">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex items-center justify-between h-16">
          {/* Logo */}
          <button
            onClick={() => handleNavigation("/dashboard")}
            className="flex items-center gap-3 hover:opacity-80 transition-opacity"
          >
            <div className="w-8 h-8 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center shadow-md">
              <BookOpen className="w-5 h-5 text-white" />
            </div>
            <span className="text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
              NateWise
            </span>
          </button>

          {/* Navigation Links */}
          <div className="hidden md:flex items-center gap-1">
            {navItems.map((item) => {
              const Icon = item.icon;
              const isActive = location.pathname === item.path;
              
              return (
                <button
                  key={item.path}
                  onClick={() => handleNavigation(item.path)}
                  className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all duration-200 ${
                    isActive
                      ? "bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-md"
                      : "text-gray-700 hover:bg-gray-100"
                  }`}
                >
                  <Icon className="w-4 h-4" />
                  {item.label}
                </button>
              );
            })}
            
            {/* More Menu */}
            <div className="relative">
              <button
                onClick={() => setShowMoreMenu(!showMoreMenu)}
                className="flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-gray-700 hover:bg-gray-100 transition-all duration-200"
              >
                <Menu className="w-4 h-4" />
                More
              </button>
              
              {showMoreMenu && (
                <>
                  <div 
                    className="fixed inset-0 z-10" 
                    onClick={() => setShowMoreMenu(false)}
                  ></div>
                  <div className="absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-xl border border-gray-200 py-2 z-20">
                    {moreItems.map((item) => {
                      const isActive = location.pathname === item.path;
                      return (
                        <button
                          key={item.path}
                          onClick={() => {
                            handleNavigation(item.path);
                            setShowMoreMenu(false);
                          }}
                          className={`w-full text-left px-4 py-2.5 font-medium transition-colors ${
                            isActive
                              ? "bg-indigo-50 text-indigo-600"
                              : "text-gray-700 hover:bg-gray-50"
                          }`}
                        >
                          {item.label}
                        </button>
                      );
                    })}
                  </div>
                </>
              )}
            </div>
          </div>

          {/* User Menu */}
          <div className="flex items-center gap-3">
            <div className="hidden sm:flex items-center gap-3 px-4 py-2 bg-gray-50 rounded-lg border border-gray-200">
              {user.google_user_data.picture ? (
                <img
                  src={user.google_user_data.picture}
                  alt={user.google_user_data.name || "User"}
                  className="w-8 h-8 rounded-full"
                />
              ) : (
                <div className="w-8 h-8 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-full flex items-center justify-center">
                  <User className="w-5 h-5 text-white" />
                </div>
              )}
              <span className="text-sm font-medium text-gray-900">
                {user.google_user_data.given_name || user.email}
              </span>
            </div>
            
            <button
              onClick={onLogout}
              className="flex items-center gap-2 px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors duration-200"
              title="Sign out"
            >
              <LogOut className="w-4 h-4" />
              <span className="hidden sm:inline">Sign Out</span>
            </button>
          </div>
        </div>

        {/* Mobile Navigation */}
        <div className="md:hidden flex items-center gap-1 pb-3 overflow-x-auto">
          {navItems.map((item) => {
            const Icon = item.icon;
            const isActive = location.pathname === item.path;
            
            return (
              <button
                key={item.path}
                onClick={() => handleNavigation(item.path)}
                className={`flex items-center gap-2 px-3 py-1.5 rounded-lg font-medium text-sm whitespace-nowrap transition-all duration-200 ${
                  isActive
                    ? "bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-md"
                    : "text-gray-700 hover:bg-gray-100"
                }`}
              >
                <Icon className="w-4 h-4" />
                {item.label}
              </button>
            );
          })}
        </div>
      </div>
    </nav>
  );
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\components\ProgressRing.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

interface ProgressRingProps {
  progress: number;
  size?: number;
  strokeWidth?: number;
  color?: string;
  label?: string;
}

export default function ProgressRing({ 
  progress, 
  size = 120, 
  strokeWidth = 8,
  color = '#6366f1',
  label 
}: ProgressRingProps) {
  const radius = (size - strokeWidth) / 2;
  const circumference = radius * 2 * Math.PI;
  const offset = circumference - (progress / 100) * circumference;

  return (
    <div className="relative inline-flex items-center justify-center">
      <svg width={size} height={size} className="transform -rotate-90">
        {/* Background circle */}
        <circle
          cx={size / 2}
          cy={size / 2}
          r={radius}
          stroke="#e5e7eb"
          strokeWidth={strokeWidth}
          fill="none"
        />
        {/* Progress circle */}
        <circle
          cx={size / 2}
          cy={size / 2}
          r={radius}
          stroke={color}
          strokeWidth={strokeWidth}
          fill="none"
          strokeDasharray={circumference}
          strokeDashoffset={offset}
          strokeLinecap="round"
          className="transition-all duration-500"
        />
      </svg>
      <div className="absolute inset-0 flex flex-col items-center justify-center">
        <span className="text-2xl font-bold text-gray-900">{Math.round(progress)}</span>
        {label && <span className="text-xs text-gray-500 mt-1">{label}</span>}
      </div>
    </div>
  );
}


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\components\QuestionRenderer.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// components/QuestionRenderer.tsx
import React, { useEffect, useRef } from 'react';
import { MathJaxContext, MathJax } from 'react-mathjax';
import mermaid from 'mermaid';

interface QuestionRendererProps {
  questionText: string;
  questionData: any;
}

const QuestionRenderer: React.FC<QuestionRendererProps> = ({ questionText, questionData }) => {
  const diagramRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    if (diagramRef.current && questionData?.diagram) {
      // Render Mermaid diagrams
      mermaid.initialize({ 
        startOnLoad: true,
        theme: 'default'
      });
      
      try {
        mermaid.render('diagram', questionData.diagram).then(({ svg }) => {
          if (diagramRef.current) {
            diagramRef.current.innerHTML = svg;
          }
        });
      } catch (error) {
        console.error('Mermaid rendering error:', error);
      }
    }
  }, [questionData]);

  return (
    <MathJaxContext>
      <div className="question-content">
        {/* Render question text with LaTeX */}
        <MathJax dynamic>
          <div>{questionText}</div>
        </MathJax>
        
        {/* Render diagram if present */}
        {questionData?.diagram && (
          <div ref={diagramRef} className="question-diagram mt-4"></div>
        )}
        
        {/* Render options */}
        {questionData?.options && (
          <div className="options mt-4 space-y-2">
            {questionData.options.map((option: string, index: number) => (
              <MathJax key={index} dynamic>
                <div className="option">{option}</div>
              </MathJax>
            ))}
          </div>
        )}
      </div>
    </MathJaxContext>
  );
};

export default QuestionRenderer;

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\components\QuestionVisualizer.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { useState, useEffect } from "react";

interface VisualizerProps {
  questionType: string;
  questionData: any;
  userAnswer?: string;
  correctAnswer?: string;
  showSolution?: boolean;
}

export function QuestionVisualizer({ questionType, questionData, userAnswer, correctAnswer, showSolution }: VisualizerProps) {
  if (questionType === 'graph_equation') {
    return <GraphVisualizer data={questionData} userAnswer={userAnswer} correctAnswer={correctAnswer} showSolution={showSolution} />;
  }
  
  if (questionType === 'force_diagram') {
    return <ForceDiagramVisualizer data={questionData} userAnswer={userAnswer} correctAnswer={correctAnswer} showSolution={showSolution} />;
  }
  
  return null;
}

function GraphVisualizer({ data, showSolution }: any) {
  const canvasRef = useState<HTMLCanvasElement | null>(null);

  useEffect(() => {
    if (canvasRef && canvasRef[0]) {
      const canvas = canvasRef[0];
      const ctx = canvas.getContext('2d');
      if (!ctx) return;

      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Draw axes
      ctx.strokeStyle = '#9ca3af';
      ctx.lineWidth = 2;
      
      // X-axis
      ctx.beginPath();
      ctx.moveTo(0, canvas.height / 2);
      ctx.lineTo(canvas.width, canvas.height / 2);
      ctx.stroke();
      
      // Y-axis
      ctx.beginPath();
      ctx.moveTo(canvas.width / 2, 0);
      ctx.lineTo(canvas.width / 2, canvas.height);
      ctx.stroke();
      
      // Draw grid
      ctx.strokeStyle = '#e5e7eb';
      ctx.lineWidth = 1;
      for (let i = 0; i < canvas.width; i += 40) {
        ctx.beginPath();
        ctx.moveTo(i, 0);
        ctx.lineTo(i, canvas.height);
        ctx.stroke();
      }
      for (let i = 0; i < canvas.height; i += 40) {
        ctx.beginPath();
        ctx.moveTo(0, i);
        ctx.lineTo(canvas.width, i);
        ctx.stroke();
      }
      
      // Draw function if available
      if (data.equation && showSolution) {
        ctx.strokeStyle = '#6366f1';
        ctx.lineWidth = 3;
        ctx.beginPath();
        
        for (let x = -canvas.width / 2; x < canvas.width / 2; x++) {
          const scaledX = x / 40;
          let y = 0;
          
          // Simple linear equation parser: y = mx + b
          if (data.equation && data.equation.includes('x')) {
            // Very basic evaluation - in production, use a proper math parser
            y = scaledX * 2; // Placeholder
          }
          
          const canvasX = canvas.width / 2 + x;
          const canvasY = canvas.height / 2 - (y * 40);
          
          if (x === -canvas.width / 2) {
            ctx.moveTo(canvasX, canvasY);
          } else {
            ctx.lineTo(canvasX, canvasY);
          }
        }
        ctx.stroke();
      }
    }
  }, [data, showSolution]);

  return (
    <div className="bg-white rounded-xl p-6 border-2 border-indigo-200 mb-6">
      <h3 className="text-lg font-semibold text-gray-900 mb-4">Graph Visualization</h3>
      <canvas 
        ref={(el) => canvasRef[1](el)}
        width={400} 
        height={400} 
        className="border border-gray-300 rounded-lg mx-auto"
      />
    </div>
  );
}

function ForceDiagramVisualizer({ data, showSolution }: any) {
  return (
    <div className="bg-white rounded-xl p-6 border-2 border-purple-200 mb-6">
      <h3 className="text-lg font-semibold text-gray-900 mb-4">Force Diagram</h3>
      <div className="relative w-full h-64 bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg border border-gray-300 flex items-center justify-center">
        {/* Simple object representation */}
        <div className="w-16 h-16 bg-gray-800 rounded-lg shadow-lg"></div>
        
        {/* Force vectors */}
        {showSolution && data.forces && (
          <>
            {data.forces.map((force: any, index: number) => (
              <ForceVector 
                key={index}
                force={force.magnitude}
                angle={force.angle}
                color={force.color || '#6366f1'}
                label={force.label}
              />
            ))}
          </>
        )}
      </div>
      {showSolution && data.resultant && (
        <div className="mt-4 p-4 bg-indigo-50 rounded-lg">
          <p className="text-sm font-semibold text-indigo-900">
            Resultant Force: {data.resultant} N
          </p>
        </div>
      )}
    </div>
  );
}

function ForceVector({ force, angle, color, label }: any) {
  const radians = (angle * Math.PI) / 180;
  const length = force * 2; // Scale factor
  const endX = Math.cos(radians) * length;
  const endY = -Math.sin(radians) * length;

  return (
    <div className="absolute" style={{ left: '50%', top: '50%', transform: 'translate(-50%, -50%)' }}>
      <svg width="200" height="200" className="absolute" style={{ left: '-100px', top: '-100px' }}>
        <defs>
          <marker
            id={`arrowhead-${label}`}
            markerWidth="10"
            markerHeight="10"
            refX="9"
            refY="3"
            orient="auto"
          >
            <polygon points="0 0, 10 3, 0 6" fill={color} />
          </marker>
        </defs>
        <line
          x1="100"
          y1="100"
          x2={100 + endX}
          y2={100 + endY}
          stroke={color}
          strokeWidth="3"
          markerEnd={`url(#arrowhead-${label})`}
        />
        <text x={100 + endX + 10} y={100 + endY} fill={color} fontSize="12" fontWeight="bold">
          {label}
        </text>
      </svg>
    </div>
  );
}


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\components\StreakTracker.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { Flame } from "lucide-react";

interface StreakTrackerProps {
  currentStreak: number;
  bestStreak: number;
}

export default function StreakTracker({ currentStreak, bestStreak }: StreakTrackerProps) {
  const days = ['M', 'T', 'W', 'T', 'F', 'S', 'S'];
  const today = new Date().getDay();
  
  return (
    <div className="bg-gradient-to-br from-orange-50 to-red-50 rounded-xl p-6 border border-orange-200">
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center gap-3">
          <div className="w-12 h-12 bg-gradient-to-r from-orange-500 to-red-500 rounded-lg flex items-center justify-center shadow-lg">
            <Flame className="w-6 h-6 text-white" />
          </div>
          <div>
            <p className="text-sm text-gray-600">Current Streak</p>
            <p className="text-2xl font-bold text-gray-900">{currentStreak} days</p>
          </div>
        </div>
        <div className="text-right">
          <p className="text-sm text-gray-600">Best Streak</p>
          <p className="text-xl font-bold text-orange-600">{bestStreak} days</p>
        </div>
      </div>

      {/* Week visualization */}
      <div className="flex gap-2 justify-between">
        {days.map((day, index) => {
          const isActive = index <= today && index >= today - currentStreak;
          return (
            <div
              key={index}
              className={`flex-1 h-12 rounded-lg flex items-center justify-center font-bold text-sm transition-all ${
                isActive
                  ? 'bg-gradient-to-r from-orange-500 to-red-500 text-white shadow-md'
                  : 'bg-white text-gray-400 border border-gray-200'
              }`}
            >
              {day}
            </div>
          );
        })}
      </div>
    </div>
  );
}



============================================================
DIRECTORY: src\react-app\pages
============================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\pages\Achievements.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { useEffect, useState } from "react";
import { useNavigate } from "react-router";
import { useAuth } from "@getmocha/users-service/react";
import { Award, Trophy, Star, Zap, Target, TrendingUp, Lock } from "lucide-react";
import Navigation from "@/react-app/components/Navigation";
import type { MochaUser } from "@getmocha/users-service/shared";



interface Achievement {
  id: number;
  name: string;
  description: string;
  badge_icon_url: string | null;
  achievement_type: string;
  points_value: number;
  is_earned: boolean;
  earned_at: string | null;
  progress?: number;
  total?: number;
}

interface UserLevel {
  current_level: number;
  current_xp: number;
  xp_for_next_level: number;
  total_achievements: number;
  earned_achievements: number;
}

// --- 1. MOCK USER ---
const MOCK_USER: MochaUser = {
  id: "dev-user",
  email: "sibusiso@example.com",
  google_sub: "dev-google-sub",
  last_signed_in_at: new Date().toISOString(),
  created_at: new Date().toISOString(),
  updated_at: new Date().toISOString(),
  google_user_data: {
    given_name: "Sibusiso King-Junior",
    name: "Sibusiso King-Junior Nkosi",
    picture: null,
    email: "sibusiso@example.com",
    email_verified: true,
    sub: "dev-google-sub"
  }
};

// --- 2. MOCK ACHIEVEMENT DATA ---
const MOCK_ACHIEVEMENTS: Achievement[] = [
  { id: 1, name: "First Steps", description: "Complete your first practice session", badge_icon_url: null, achievement_type: "first_question", points_value: 50, is_earned: true, earned_at: "2023-10-20" },
  { id: 2, name: "On Fire", description: "Reach a 7-day streak", badge_icon_url: null, achievement_type: "streak", points_value: 100, is_earned: true, earned_at: "2023-10-27" },
  { id: 3, name: "Math Whiz", description: "Master 5 Mathematics skills", badge_icon_url: null, achievement_type: "skills_mastered", points_value: 200, is_earned: false, progress: 3, total: 5 },
  { id: 4, name: "Sharp Shooter", description: "Answer 50 questions correctly", badge_icon_url: null, achievement_type: "correct_answers", points_value: 150, is_earned: false, progress: 35, total: 50 },
  { id: 5, name: "Level Up", description: "Reach Level 5", badge_icon_url: null, achievement_type: "level", points_value: 500, is_earned: false, progress: 3, total: 5 },
];

const MOCK_LEVEL: UserLevel = {
  current_level: 3,
  current_xp: 2350,
  xp_for_next_level: 3000,
  total_achievements: 5,
  earned_achievements: 2,
};

export default function Achievements() {
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  const [achievements] = useState<Achievement[]>(MOCK_ACHIEVEMENTS);
  const [levelInfo] = useState<UserLevel>(MOCK_LEVEL);

  const displayUser = user || MOCK_USER;

  // Disable redirect
  useEffect(() => {}, [user, navigate]);

  const handleLogout = async () => {
    await logout();
    navigate("/");
  };

  const earnedAchievements = achievements.filter((a) => a.is_earned);
  const lockedAchievements = achievements.filter((a) => !a.is_earned);

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
      <Navigation onLogout={handleLogout} user={displayUser} />

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-gray-900 mb-2">Achievements & Rewards</h1>
          <p className="text-gray-600">Track your accomplishments and unlock rewards</p>
        </div>

        {/* Level Progress */}
        <div className="bg-gradient-to-br from-indigo-600 to-purple-600 rounded-2xl shadow-xl p-8 mb-8 text-white">
          <div className="flex items-center justify-between mb-6">
            <div>
              <h2 className="text-3xl font-bold mb-2">Level {levelInfo.current_level}</h2>
              <p className="text-indigo-100">
                {levelInfo.current_xp} / {levelInfo.xp_for_next_level} XP to next level
              </p>
            </div>
            <div className="w-20 h-20 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center">
              <Trophy className="w-10 h-10 text-white" />
            </div>
          </div>
          
          {/* Progress Bar */}
          <div className="bg-white/20 rounded-full h-4 overflow-hidden mb-4">
            <div
              className="bg-gradient-to-r from-yellow-400 to-orange-500 h-full transition-all duration-500 rounded-full"
              style={{
                width: `${Math.min((levelInfo.current_xp / levelInfo.xp_for_next_level) * 100, 100)}%`,
              }}
            ></div>
          </div>

          <div className="grid grid-cols-2 gap-6 mt-6">
            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4">
              <div className="flex items-center gap-3 mb-1">
                <Star className="w-5 h-5 text-yellow-300" />
                <p className="text-sm text-indigo-100">Total XP</p>
              </div>
              <p className="text-2xl font-bold">{levelInfo.current_xp}</p>
            </div>
            <div className="bg-white/10 backdrop-blur-sm rounded-xl p-4">
              <div className="flex items-center gap-3 mb-1">
                <Award className="w-5 h-5 text-yellow-300" />
                <p className="text-sm text-indigo-100">Achievements</p>
              </div>
              <p className="text-2xl font-bold">
                {levelInfo.earned_achievements} / {levelInfo.total_achievements}
              </p>
            </div>
          </div>
        </div>

        {/* Earned Achievements */}
        {earnedAchievements.length > 0 && (
          <div className="mb-8">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">Unlocked Achievements</h2>
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              {earnedAchievements.map((achievement) => (
                <AchievementCard key={achievement.id} achievement={achievement} />
              ))}
            </div>
          </div>
        )}

        {/* Locked Achievements */}
        {lockedAchievements.length > 0 && (
          <div>
            <h2 className="text-2xl font-bold text-gray-900 mb-6">Locked Achievements</h2>
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              {lockedAchievements.map((achievement) => (
                <AchievementCard key={achievement.id} achievement={achievement} />
              ))}
            </div>
          </div>
        )}
      </main>
    </div>
  );
}

function AchievementCard({ achievement }: { achievement: Achievement }) {
  const isEarned = achievement.is_earned;
  const iconMap: Record<string, any> = {
    first_question: Target,
    correct_answers: Zap,
    streak: TrendingUp,
    daily_streak: Star,
    session_questions: Award,
    skills_mastered: Trophy,
    subject_mastery: Award,
    level: Star,
    daily_challenge: Target,
  };
  const Icon = iconMap[achievement.achievement_type] || Award;

  return (
    <div
      className={`relative rounded-xl p-6 border transition-all duration-300 ${
        isEarned
          ? "bg-gradient-to-br from-yellow-50 to-orange-50 border-yellow-200 shadow-lg hover:shadow-xl"
          : "bg-white border-gray-200 opacity-75"
      }`}
    >
      {!isEarned && (
        <div className="absolute top-4 right-4">
          <Lock className="w-5 h-5 text-gray-400" />
        </div>
      )}

      <div className="flex items-start gap-4 mb-4">
        <div
          className={`w-14 h-14 rounded-xl flex items-center justify-center shadow-md flex-shrink-0 ${
            isEarned
              ? "bg-gradient-to-r from-yellow-400 to-orange-500"
              : "bg-gray-200"
          }`}
        >
          <Icon className={`w-7 h-7 ${isEarned ? "text-white" : "text-gray-400"}`} />
        </div>
        <div className="flex-1 min-w-0">
          <h3 className={`font-bold text-lg mb-1 ${isEarned ? "text-gray-900" : "text-gray-600"}`}>
            {achievement.name}
          </h3>
          <p className={`text-sm ${isEarned ? "text-gray-700" : "text-gray-500"}`}>
            {achievement.description}
          </p>
        </div>
      </div>

      <div className="flex items-center justify-between">
        <div className="flex items-center gap-2">
          <Zap className={`w-4 h-4 ${isEarned ? "text-orange-500" : "text-gray-400"}`} />
          <span className={`text-sm font-semibold ${isEarned ? "text-orange-600" : "text-gray-500"}`}>
            {achievement.points_value} XP
          </span>
        </div>
        {isEarned && achievement.earned_at && (
          <span className="text-xs text-gray-500">
            {new Date(achievement.earned_at).toLocaleDateString()}
          </span>
        )}
      </div>

      {!isEarned && achievement.progress !== undefined && achievement.total !== undefined && (
        <div className="mt-4">
          <div className="flex items-center justify-between text-xs text-gray-600 mb-1">
            <span>Progress</span>
            <span>
              {achievement.progress} / {achievement.total}
            </span>
          </div>
          <div className="bg-gray-200 rounded-full h-2 overflow-hidden">
            <div
              className="bg-gradient-to-r from-indigo-600 to-purple-600 h-full transition-all duration-500"
              style={{
                width: `${Math.min((achievement.progress / achievement.total) * 100, 100)}%`,
              }}
            ></div>
          </div>
        </div>
      )}
    </div>
  );
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\pages\AdminContentManager.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { useEffect, useState } from "react";

interface Subject {
  id: number;
  name: string;
  code: string;
  nated_level: string;
  description: string;
  modules?: Module[];
}

interface Module {
  id: number;
  subject_id: number;
  name: string;
  description: string;
  topics?: Topic[];
}

interface Topic {
  id: number;
  module_id: number;
  name: string;
  description: string;
  skills?: Skill[];
}

interface Skill {
  id: number;
  topic_id: number;
  name: string;
  description: string;
  questions?: Question[];
}

interface Question {
  id: number;
  skill_id: number;
  question_text: string;
  question_data: string;
  correct_answer: string;
  explanation: string;
  difficulty_rating: number;
  points_value: number;
}

export default function AdminContentManager() {
  const [subjects, setSubjects] = useState<Subject[]>([]);
  const [expandedSubjects, setExpandedSubjects] = useState<number[]>([]);
  const [expandedModules, setExpandedModules] = useState<number[]>([]);
  const [expandedTopics, setExpandedTopics] = useState<number[]>([]);
  const [expandedSkills, setExpandedSkills] = useState<number[]>([]);
  const [editingItem, setEditingItem] = useState<any>(null);
  const [showModal, setShowModal] = useState(false);
  const [questionOptions, setQuestionOptions] = useState<string[]>(['', '', '', '']);
  const [correctAnswerIndex, setCorrectAnswerIndex] = useState<number>(0);
  const [difficultyRating, setDifficultyRating] = useState<number>(1);
  const [pointsValue, setPointsValue] = useState<number>(10);
  const [loading, setLoading] = useState(true);

  // Fetch all data with full hierarchy
  const fetchFullHierarchy = async () => {
    try {
      setLoading(true);
      console.log("Fetching full hierarchy...");
      
      // Fetch subjects
      const subjectsResponse = await fetch("/api/subjects");
      const subjectsData = await subjectsResponse.json();
      console.log("Subjects:", subjectsData);

      // For each subject, fetch modules, topics, skills, and questions
      const subjectsWithFullData = await Promise.all(
        subjectsData.map(async (subject: Subject) => {
          try {
            // Fetch modules for this subject
            const modulesResponse = await fetch(`/api/subjects/${subject.id}`);
            const subjectWithModules = await modulesResponse.json();
            
            // If modules exist, fetch topics for each module
            if (subjectWithModules.modules) {
              const modulesWithTopics = await Promise.all(
                subjectWithModules.modules.map(async (module: Module) => {
                  try {
                    // Fetch topics for this module
                    const topicsResponse = await fetch(`/api/modules/${module.id}`);
                    const moduleWithTopics = await topicsResponse.json();
                    
                    // If topics exist, fetch skills for each topic
                    if (moduleWithTopics.topics) {
                      const topicsWithSkills = await Promise.all(
                        moduleWithTopics.topics.map(async (topic: Topic) => {
                          try {
                            // Fetch skills for this topic
                            const skillsResponse = await fetch(`/api/topics/${topic.id}/skills`);
                            const skillsData = await skillsResponse.json();
                            
                            // If skills exist, fetch questions for each skill
                            if (skillsData && skillsData.length > 0) {
                              const skillsWithQuestions = await Promise.all(
                                skillsData.map(async (skill: Skill) => {
                                  try {
                                    // Fetch questions for this skill
                                    const questionsResponse = await fetch(`/api/skills/${skill.id}/questions`);
                                    const questionsData = await questionsResponse.json();
                                    return {
                                      ...skill,
                                      questions: questionsData || []
                                    };
                                  } catch (error) {
                                    console.error(`Error fetching questions for skill ${skill.id}:`, error);
                                    return { ...skill, questions: [] };
                                  }
                                })
                              );
                              return { ...topic, skills: skillsWithQuestions };
                            }
                            return { ...topic, skills: [] };
                          } catch (error) {
                            console.error(`Error fetching skills for topic ${topic.id}:`, error);
                            return { ...topic, skills: [] };
                          }
                        })
                      );
                      return { ...module, topics: topicsWithSkills };
                    }
                    return { ...module, topics: [] };
                  } catch (error) {
                    console.error(`Error fetching topics for module ${module.id}:`, error);
                    return { ...module, topics: [] };
                  }
                })
              );
              return { ...subject, modules: modulesWithTopics };
            }
            return { ...subject, modules: [] };
          } catch (error) {
            console.error(`Error fetching modules for subject ${subject.id}:`, error);
            return { ...subject, modules: [] };
          }
        })
      );

      console.log("Full hierarchy data:", subjectsWithFullData);
      setSubjects(subjectsWithFullData);
    } catch (error) {
      console.error("Failed to fetch full hierarchy:", error);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchFullHierarchy();
  }, []);

  // Refresh data after any operation
  const refreshData = () => {
    fetchFullHierarchy();
  };

  // Toggle expansion functions
  const toggleSubject = (subjectId: number) => {
    setExpandedSubjects(prev => 
      prev.includes(subjectId) 
        ? prev.filter(id => id !== subjectId)
        : [...prev, subjectId]
    );
  };

  const toggleModule = (moduleId: number) => {
    setExpandedModules(prev => 
      prev.includes(moduleId) 
        ? prev.filter(id => id !== moduleId)
        : [...prev, moduleId]
    );
  };

  const toggleTopic = (topicId: number) => {
    setExpandedTopics(prev => 
      prev.includes(topicId) 
        ? prev.filter(id => id !== topicId)
        : [...prev, topicId]
    );
  };

  const toggleSkill = (skillId: number) => {
    setExpandedSkills(prev => 
      prev.includes(skillId) 
        ? prev.filter(id => id !== skillId)
        : [...prev, skillId]
    );
  };

  // Create functions
  const createSubject = async (data: any) => {
    await fetch("/api/subjects", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    refreshData();
  };

  const createModule = async (subjectId: number, data: any) => {
    await fetch("/api/modules", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ...data, subject_id: subjectId })
    });
    refreshData();
  };

  const createTopic = async (moduleId: number, data: any) => {
    await fetch("/api/topics", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ...data, module_id: moduleId })
    });
    refreshData();
  };

  const createSkill = async (topicId: number, data: any) => {
    await fetch("/api/skills", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ...data, topic_id: topicId })
    });
    refreshData();
  };

  const createQuestion = async (skillId: number, data: any) => {
    try {
      console.log("Creating question for skill:", skillId, "with data:", data);
      
      const response = await fetch("/api/questions", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ 
          skill_id: skillId,
          question_text: data.question_text,
          question_data: data.question_data,
          correct_answer: data.correct_answer,
          explanation: data.explanation,
          question_type: "multiple_choice",
          difficulty_rating: data.difficulty_rating,
          points_value: data.points_value
        })
      });
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      await response.json();
      refreshData();
    } catch (error) {
      console.error("Failed to create question:", error);
      throw error;
    }
  };

  // Delete functions
  const deleteSubject = async (subjectId: number) => {
    if (confirm("Are you sure you want to delete this subject?")) {
      await fetch(`/api/subjects/${subjectId}`, { method: "DELETE" });
      refreshData();
    }
  };

  const deleteModule = async (moduleId: number) => {
    if (confirm("Are you sure you want to delete this module?")) {
      await fetch(`/api/modules/${moduleId}`, { method: "DELETE" });
      refreshData();
    }
  };

  const deleteTopic = async (topicId: number) => {
    if (confirm("Are you sure you want to delete this topic?")) {
      await fetch(`/api/topics/${topicId}`, { method: "DELETE" });
      refreshData();
    }
  };

  const deleteSkill = async (skillId: number) => {
    if (confirm("Are you sure you want to delete this skill?")) {
      await fetch(`/api/skills/${skillId}`, { method: "DELETE" });
      refreshData();
    }
  };

  const deleteQuestion = async (questionId: number) => {
    if (confirm("Are you sure you want to delete this question?")) {
      await fetch(`/api/questions/${questionId}`, { method: "DELETE" });
      refreshData();
    }
  };

  // Helper function to safely get string values from FormData
  const getFormStringValue = (formData: FormData, key: string): string => {
    const value = formData.get(key);
    return value ? value.toString() : '';
  };

  // Reset question form when opening modal
  const resetQuestionForm = () => {
    setQuestionOptions(['', '', '', '']);
    setCorrectAnswerIndex(0);
    setDifficultyRating(1);
    setPointsValue(10);
  };

  // Handle option change
  const handleOptionChange = (index: number, value: string) => {
    const newOptions = [...questionOptions];
    newOptions[index] = value;
    setQuestionOptions(newOptions);
  };

  // Parse question data safely
  const parseQuestionData = (questionData: string) => {
    try {
      return JSON.parse(questionData);
    } catch {
      return { options: [] };
    }
  };

  if (loading) {
    return (
      <div className="p-6 max-w-6xl mx-auto">
        <div className="text-center">Loading content hierarchy...</div>
      </div>
    );
  }

  return (
    <div className="p-6 max-w-6xl mx-auto">
      <h1 className="text-2xl font-bold mb-6">Content Manager</h1>
      
      <div className="flex gap-2 mb-4">
        <button 
          onClick={() => {
            setEditingItem({ type: "subject", data: null });
            setShowModal(true);
          }}
          className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
        >
          + Add Subject
        </button>
        <button 
          onClick={refreshData}
          className="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"
        >
          Refresh Data
        </button>
      </div>

      <div className="space-y-4">
        {subjects.length === 0 ? (
          <div className="text-center py-8 text-gray-500">
            No subjects found. Create your first subject to get started!
          </div>
        ) : (
          subjects.map(subject => (
            <div key={subject.id} className="border rounded-lg p-4 bg-white shadow">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-2">
                  <button 
                    onClick={() => toggleSubject(subject.id)}
                    className="w-6 h-6 flex items-center justify-center hover:bg-gray-100 rounded"
                  >
                    {expandedSubjects.includes(subject.id) ? "â–¼" : "â–¶"}
                  </button>
                  <h3 className="font-bold text-lg">{subject.name}</h3>
                  <span className="text-sm text-gray-500">({subject.code})</span>
                </div>
                <div className="flex gap-2">
                  <button 
                    onClick={() => {
                      setEditingItem({ type: "module", parentId: subject.id, data: null });
                      setShowModal(true);
                    }}
                    className="px-3 py-1 bg-green-500 text-white text-sm rounded hover:bg-green-600"
                  >
                    + Module
                  </button>
                  <button 
                    onClick={() => deleteSubject(subject.id)}
                    className="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600"
                  >
                    Delete
                  </button>
                </div>
              </div>

              {expandedSubjects.includes(subject.id) && (
                <div className="mt-4 ml-6 space-y-4">
                  {subject.modules && subject.modules.length > 0 ? (
                    subject.modules.map(module => (
                      <div key={module.id} className="border-l-2 border-blue-200 pl-4">
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-2">
                            <button 
                              onClick={() => toggleModule(module.id)}
                              className="w-5 h-5 flex items-center justify-center hover:bg-gray-100 rounded"
                            >
                              {expandedModules.includes(module.id) ? "â–¼" : "â–¶"}
                            </button>
                            <h4 className="font-semibold text-md">{module.name}</h4>
                          </div>
                          <div className="flex gap-2">
                            <button 
                              onClick={() => {
                                setEditingItem({ type: "topic", parentId: module.id, data: null });
                                setShowModal(true);
                              }}
                              className="px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600"
                            >
                              + Topic
                            </button>
                            <button 
                              onClick={() => deleteModule(module.id)}
                              className="px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600"
                            >
                              Delete
                            </button>
                          </div>
                        </div>

                        {expandedModules.includes(module.id) && (
                          <div className="mt-2 ml-4 space-y-2">
                            {module.topics && module.topics.length > 0 ? (
                              module.topics.map(topic => (
                                <div key={topic.id} className="border-l-2 border-green-200 pl-4">
                                  <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-2">
                                      <button 
                                        onClick={() => toggleTopic(topic.id)}
                                        className="w-4 h-4 flex items-center justify-center hover:bg-gray-100 rounded"
                                      >
                                        {expandedTopics.includes(topic.id) ? "â–¼" : "â–¶"}
                                      </button>
                                      <h5 className="font-medium text-sm">{topic.name}</h5>
                                    </div>
                                    <div className="flex gap-2">
                                      <button 
                                        onClick={() => {
                                          setEditingItem({ type: "skill", parentId: topic.id, data: null });
                                          setShowModal(true);
                                        }}
                                        className="px-2 py-1 bg-green-500 text-white text-xs rounded hover:bg-green-600"
                                      >
                                        + Skill
                                      </button>
                                      <button 
                                        onClick={() => deleteTopic(topic.id)}
                                        className="px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600"
                                      >
                                        Delete
                                      </button>
                                    </div>
                                  </div>

                                  {expandedTopics.includes(topic.id) && (
                                    <div className="mt-2 ml-4 space-y-2">
                                      {topic.skills && topic.skills.length > 0 ? (
                                        topic.skills.map(skill => (
                                          <div key={skill.id} className="border-l-2 border-purple-200 pl-4">
                                            <div className="flex items-center justify-between">
                                              <div className="flex items-center gap-2">
                                                <button 
                                                  onClick={() => toggleSkill(skill.id)}
                                                  className="w-4 h-4 flex items-center justify-center hover:bg-gray-100 rounded"
                                                >
                                                  {expandedSkills.includes(skill.id) ? "â–¼" : "â–¶"}
                                                </button>
                                                <h6 className="text-sm font-medium">{skill.name}</h6>
                                                <span className="text-xs text-gray-500">
                                                  ({skill.questions ? skill.questions.length : 0} questions)
                                                </span>
                                              </div>
                                              <div className="flex gap-2">
                                                <button 
                                                  onClick={() => {
                                                    resetQuestionForm();
                                                    setEditingItem({ type: "question", parentId: skill.id, data: null });
                                                    setShowModal(true);
                                                  }}
                                                  className="px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600"
                                                >
                                                  + Question
                                                </button>
                                                <button 
                                                  onClick={() => deleteSkill(skill.id)}
                                                  className="px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600"
                                                >
                                                  Delete
                                                </button>
                                              </div>
                                            </div>

                                            {expandedSkills.includes(skill.id) && (
                                              <div className="mt-2 ml-4 space-y-2">
                                                {skill.questions && skill.questions.length > 0 ? (
                                                  skill.questions.map(question => {
                                                    const questionData = parseQuestionData(question.question_data);
                                                    
                                                    return (
                                                      <div key={question.id} className="bg-gray-50 p-3 rounded border">
                                                        <div className="flex justify-between items-start mb-2">
                                                          <div className="font-medium text-sm flex-1">
                                                            {question.question_text}
                                                          </div>
                                                          <button 
                                                            onClick={() => deleteQuestion(question.id)}
                                                            className="ml-2 text-red-500 hover:text-red-700 text-xs"
                                                          >
                                                            Delete
                                                          </button>
                                                        </div>
                                                        <div className="text-xs text-gray-600 space-y-1 mb-2">
                                                          <div><strong>Options:</strong></div>
                                                          {questionData.options?.map((option: string, index: number) => (
                                                            <div key={index} className="flex items-center gap-2">
                                                              <span>{String.fromCharCode(65 + index)}.</span>
                                                              <span className={option === question.correct_answer ? "text-green-600 font-medium" : ""}>
                                                                {option}
                                                                {option === question.correct_answer && " âœ“"}
                                                              </span>
                                                            </div>
                                                          ))}
                                                        </div>
                                                        <div className="flex gap-4 text-xs text-gray-500">
                                                          <div><strong>Difficulty:</strong> {question.difficulty_rating}/5</div>
                                                          <div><strong>Points:</strong> {question.points_value}</div>
                                                        </div>
                                                        {question.explanation && (
                                                          <div className="text-xs text-gray-500 mt-2">
                                                            <strong>Explanation:</strong> {question.explanation}
                                                          </div>
                                                        )}
                                                      </div>
                                                    );
                                                  })
                                                ) : (
                                                  <div className="text-xs text-gray-400 italic">
                                                    No questions yet - click "+ Question" to add some!
                                                  </div>
                                                )}
                                              </div>
                                            )}
                                          </div>
                                        ))
                                      ) : (
                                        <div className="text-sm text-gray-400 italic">
                                          No skills yet
                                        </div>
                                      )}
                                    </div>
                                  )}
                                </div>
                              ))
                            ) : (
                              <div className="text-sm text-gray-400 italic">
                                No topics yet
                              </div>
                            )}
                          </div>
                        )}
                      </div>
                    ))
                  ) : (
                    <div className="text-sm text-gray-400 italic">
                      No modules yet
                    </div>
                  )}
                </div>
              )}
            </div>
          ))
        )}
      </div>

      {/* Modal for creating items */}
      {showModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white p-6 rounded-lg w-96 max-h-[90vh] overflow-y-auto">
            <h3 className="text-lg font-bold mb-4">
              {editingItem?.data ? "Edit" : "Create"} {editingItem?.type}
            </h3>
            
            <form onSubmit={async (e) => {
              e.preventDefault();
              const formData = new FormData(e.currentTarget);

              try {
                if (editingItem?.type === "subject") {
                  await createSubject({
                    name: getFormStringValue(formData, "name"),
                    code: getFormStringValue(formData, "code"),
                    nated_level: getFormStringValue(formData, "nated_level"),
                    description: getFormStringValue(formData, "description"),
                    color_hex: getFormStringValue(formData, "color_hex")
                  });
                } else if (editingItem?.type === "module") {
                  await createModule(editingItem.parentId, {
                    name: getFormStringValue(formData, "name"),
                    description: getFormStringValue(formData, "description")
                  });
                } else if (editingItem?.type === "topic") {
                  await createTopic(editingItem.parentId, {
                    name: getFormStringValue(formData, "name"),
                    description: getFormStringValue(formData, "description")
                  });
                } else if (editingItem?.type === "skill") {
                  await createSkill(editingItem.parentId, {
                    name: getFormStringValue(formData, "name"),
                    description: getFormStringValue(formData, "description")
                  });
                } else if (editingItem?.type === "question") {
                  // For questions, use the state-based options
                  const filteredOptions = questionOptions.filter(opt => opt.trim() !== "");
                  
                  if (filteredOptions.length < 2) {
                    alert("Please provide at least 2 options");
                    return;
                  }

                  if (correctAnswerIndex >= filteredOptions.length) {
                    alert("Please select a valid correct answer");
                    return;
                  }
                  
                  const correctAnswer = filteredOptions[correctAnswerIndex];
                  
                  await createQuestion(editingItem.parentId, {
                    question_text: getFormStringValue(formData, "question_text"),
                    question_data: { options: filteredOptions },
                    correct_answer: correctAnswer,
                    explanation: getFormStringValue(formData, "explanation"),
                    difficulty_rating: difficultyRating,
                    points_value: pointsValue
                  });
                }
                
                setShowModal(false);
                setEditingItem(null);
              } catch (error) {
                alert("Failed to create item: " + (error instanceof Error ? error.message : 'Unknown error'));
                console.error(error);
              }
            }}>
              {editingItem?.type === "subject" && (
                <>
                  <input name="name" placeholder="Subject Name" className="w-full border p-2 mb-2 rounded" required />
                  <input name="code" placeholder="Code (e.g., MAT-N4)" className="w-full border p-2 mb-2 rounded" required />
                  <input name="nated_level" placeholder="Level (e.g., N4)" className="w-full border p-2 mb-2 rounded" required />
                  <textarea name="description" placeholder="Description" className="w-full border p-2 mb-2 rounded" />
                  <input name="color_hex" placeholder="Color (#3B82F6)" className="w-full border p-2 mb-2 rounded" />
                </>
              )}

              {(editingItem?.type === "module" || editingItem?.type === "topic" || editingItem?.type === "skill") && (
                <>
                  <input name="name" placeholder={`${editingItem.type} Name`} className="w-full border p-2 mb-2 rounded" required />
                  <textarea name="description" placeholder="Description" className="w-full border p-2 mb-2 rounded" />
                </>
              )}

              {editingItem?.type === "question" && (
                <>
                  <textarea 
                    name="question_text" 
                    placeholder="Question Text" 
                    className="w-full border p-2 mb-2 rounded" 
                    required 
                  />
                  
                  <div className="space-y-2 mb-2">
                    <label className="block text-sm font-medium mb-2">Options:</label>
                    {questionOptions.map((option, index) => (
                      <div key={index} className="flex items-center gap-2">
                        <input
                          type="radio"
                          name="correct_answer"
                          checked={correctAnswerIndex === index}
                          onChange={() => setCorrectAnswerIndex(index)}
                          className="w-4 h-4"
                        />
                        <input
                          type="text"
                          value={option}
                          onChange={(e) => handleOptionChange(index, e.target.value)}
                          placeholder={`Option ${index + 1}`}
                          className="flex-1 border p-2 rounded"
                          required={index < 2} // First two options are required
                        />
                      </div>
                    ))}
                  </div>

                  <div className="grid grid-cols-2 gap-2 mb-2">
                    <div>
                      <label className="block text-sm font-medium mb-1">Difficulty (1-5)</label>
                      <select 
                        value={difficultyRating}
                        onChange={(e) => setDifficultyRating(Number(e.target.value))}
                        className="w-full border p-2 rounded"
                      >
                        {[1, 2, 3, 4, 5].map(num => (
                          <option key={num} value={num}>{num} {num === 1 ? 'â˜…' : 'â˜…'.repeat(num)}</option>
                        ))}
                      </select>
                    </div>
                    <div>
                      <label className="block text-sm font-medium mb-1">Points Value</label>
                      <input
                        type="number"
                        value={pointsValue}
                        onChange={(e) => setPointsValue(Number(e.target.value))}
                        className="w-full border p-2 rounded"
                        min="1"
                        max="100"
                      />
                    </div>
                  </div>
                  
                  <textarea 
                    name="explanation" 
                    placeholder="Explanation (optional)" 
                    className="w-full border p-2 mb-2 rounded" 
                  />
                </>
              )}

              <div className="flex gap-2 justify-end mt-4">
                <button type="button" onClick={() => setShowModal(false)} className="px-4 py-2 border rounded hover:bg-gray-50">
                  Cancel
                </button>
                <button type="submit" className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                  Save
                </button>
              </div>
            </form>
          </div>
        </div>
      )}
    </div>
  );
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\pages\Analytics.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { useEffect, useState } from "react";
import { useNavigate } from "react-router";
import { useAuth } from "@getmocha/users-service/react";
import { BarChart, Target, Clock, Zap, CheckCircle2, User } from "lucide-react";
import Navigation from "@/react-app/components/Navigation";
import type { MochaUser } from "@getmocha/users-service/shared";

// --- TYPES ---
interface OverallStats {
  average_smart_score: number;
  total_questions_answered: number;
  overall_accuracy: number;
  time_spent_hours: number;
}

interface SkillProgress {
  skill_id: number;
  skill_name: string;
  subject_name: string;
  smart_score: number;
  accuracy: number;
  questions_answered: number;
}

interface SubjectPerformance {
  subject_name: string;
  average_score: number;
  total_time_minutes: number;
}

// --- 1. MOCK USER ---
const MOCK_USER: MochaUser = {
  id: "dev-user",
  email: "sibusiso@example.com",
  google_sub: "dev-google-sub",
  last_signed_in_at: new Date().toISOString(),
  created_at: new Date().toISOString(),
  updated_at: new Date().toISOString(),
  google_user_data: {
    given_name: "Sibusiso King-Junior",
    name: "Sibusiso King-Junior Nkosi",
    picture: null,
    email: "sibusiso@example.com",
    email_verified: true,
    sub: "dev-google-sub"
  }
};

// --- 2. MOCK DATA (Offline Content) ---
const MOCK_OVERALL_STATS: OverallStats = {
  average_smart_score: 79,
  total_questions_answered: 540,
  overall_accuracy: 84.5,
  time_spent_hours: 15.2,
};

const MOCK_TOP_SKILLS: SkillProgress[] = [
  { skill_id: 102, skill_name: "Quadratic Equations", subject_name: "Engineering Mathematics N4", smart_score: 95, accuracy: 98, questions_answered: 50 },
  { skill_id: 201, skill_name: "Vector Addition", subject_name: "Engineering Science N4", smart_score: 92, accuracy: 90, questions_answered: 30 },
  { skill_id: 101, skill_name: "Solve one-variable equations", subject_name: "Engineering Mathematics N4", smart_score: 75, accuracy: 80, questions_answered: 100 },
];

const MOCK_SUBJECT_PERFORMANCE: SubjectPerformance[] = [
  { subject_name: "Engineering Mathematics N4", average_score: 78, total_time_minutes: 450 },
  { subject_name: "Engineering Science N4", average_score: 85, total_time_minutes: 320 },
  { subject_name: "Industrial Electronics N4", average_score: 65, total_time_minutes: 180 },
];


export default function Analytics() {
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  
  const displayUser = user || MOCK_USER;

  // Load mock data directly
  const [overallStats] = useState<OverallStats>(MOCK_OVERALL_STATS);
  const [topSkills] = useState<SkillProgress[]>(MOCK_TOP_SKILLS);
  const [subjectPerformance] = useState<SubjectPerformance[]>(MOCK_SUBJECT_PERFORMANCE);

  // Disable redirect
  useEffect(() => {}, [user, navigate]);

  const handleLogout = async () => {
    await logout();
    navigate("/");
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
      <Navigation onLogout={handleLogout} user={displayUser} />

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-gray-900 mb-2 flex items-center gap-3">
            <BarChart className="w-8 h-8 text-indigo-600" /> My Learning Analytics
          </h1>
          <p className="text-gray-600">Deep dive into your performance and progress.</p>
        </div>

        {/* Overall Stats */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
          <StatCard icon={Target} label="Avg SmartScore" value={`${overallStats.average_smart_score}%`} gradient="from-blue-500 to-cyan-500" />
          <StatCard icon={CheckCircle2} label="Overall Accuracy" value={`${overallStats.overall_accuracy.toFixed(1)}%`} gradient="from-green-500 to-emerald-500" />
          <StatCard icon={Zap} label="Questions Answered" value={overallStats.total_questions_answered.toLocaleString()} gradient="from-purple-500 to-pink-500" />
          <StatCard icon={Clock} label="Time Spent" value={`${overallStats.time_spent_hours.toFixed(1)} hrs`} gradient="from-orange-500 to-red-500" />
        </div>

        <div className="grid lg:grid-cols-3 gap-8">
          
          {/* Top/Weak Skills */}
          <div className="lg:col-span-2">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">Skill Breakdown</h2>
            <div className="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
              
              <h3 className="text-xl font-semibold text-gray-800 mb-4">Top Skills</h3>
              <div className="space-y-4 mb-8">
                {MOCK_TOP_SKILLS.filter(s => s.smart_score >= 85).map(skill => (
                  <SkillProgressCard key={skill.skill_id} skill={skill} isTop={true} navigate={navigate} />
                ))}
              </div>

              <h3 className="text-xl font-semibold text-gray-800 mb-4 border-t pt-4 border-gray-100">Areas for Improvement</h3>
              <div className="space-y-4">
                {MOCK_TOP_SKILLS.filter(s => s.smart_score < 85).map(skill => (
                  <SkillProgressCard key={skill.skill_id} skill={skill} isTop={false} navigate={navigate} />
                ))}
              </div>
            </div>
          </div>

          {/* Subject Performance */}
          <div className="lg:col-span-1">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">Subject Performance</h2>
            <div className="bg-white rounded-2xl shadow-xl p-6 border border-gray-100 space-y-4">
              {MOCK_SUBJECT_PERFORMANCE.map((subject, index) => (
                <SubjectPerformanceCard key={index} subject={subject} />
              ))}
            </div>
            
            <div className="mt-8">
                <h2 className="text-2xl font-bold text-gray-900 mb-6">Recommendations</h2>
                <div className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-6 border border-indigo-200">
                    <p className="text-gray-700">
                        Your score in **Industrial Electronics N4** is below average. Focus your next 3 practice sessions on those topics to boost your SmartScore!
                    </p>
                    <button
                        onClick={() => navigate("/subjects")}
                        className="mt-4 px-4 py-2 bg-indigo-600 text-white text-sm font-semibold rounded-lg hover:bg-indigo-700 transition-colors"
                    >
                        Browse Subjects
                    </button>
                </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  );
}

function StatCard({ icon: Icon, label, value, gradient }: { icon: any; label: string; value: string; gradient: string; }) {
  return (
    <div className="bg-white rounded-xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow duration-200">
      <div className="flex items-center gap-4">
        <div className={`w-12 h-12 bg-gradient-to-r ${gradient} rounded-lg flex items-center justify-center shadow-md`}>
          <Icon className="w-6 h-6 text-white" />
        </div>
        <div>
          <p className="text-sm text-gray-600 mb-1">{label}</p>
          <p className="text-2xl font-bold text-gray-900">{value}</p>
        </div>
      </div>
    </div>
  );
}

function SkillProgressCard({ skill, isTop, navigate }: { skill: SkillProgress; isTop: boolean; navigate: ReturnType<typeof useNavigate> }) {
    const color = isTop ? "text-green-600" : "text-red-600";
    const bgColor = isTop ? "bg-green-50" : "bg-red-50";

    return (
        <div className={`p-4 rounded-xl border-2 ${isTop ? "border-green-200" : "border-red-200"} ${bgColor}`}>
            <div className="flex justify-between items-start">
                <div className="flex-1 min-w-0 pr-4">
                    <h4 className="font-bold text-gray-900 truncate">{skill.skill_name}</h4>
                    <p className="text-xs text-gray-500 mb-2">{skill.subject_name}</p>
                    <div className="flex items-center gap-4 text-sm">
                        <div className="flex items-center gap-1 text-indigo-600">
                            <Target className="w-4 h-4" />
                            <span className="font-bold">{skill.smart_score}</span>
                            <span className="text-xs text-gray-500">Score</span>
                        </div>
                        <div className="flex items-center gap-1 text-gray-600">
                            <CheckCircle2 className="w-4 h-4" />
                            <span className="font-bold">{skill.accuracy}%</span>
                            <span className="text-xs text-gray-500">Acc.</span>
                        </div>
                    </div>
                </div>
                <button
                    onClick={() => navigate(`/skills/${skill.skill_id}/practice`)}
                    className={`flex-shrink-0 px-4 py-2 ${color} ${bgColor.replace('-50', '-100')} text-sm font-semibold rounded-lg hover:shadow-md transition-all duration-200`}
                >
                    Practice
                </button>
            </div>
        </div>
    );
}

function SubjectPerformanceCard({ subject }: { subject: SubjectPerformance }) {
    const isBelowAverage = subject.average_score < 75;
    const color = isBelowAverage ? "text-red-600" : "text-green-600";
    const timeHours = (subject.total_time_minutes / 60).toFixed(1);

    return (
        <div className="p-4 bg-gray-50 rounded-xl border border-gray-200">
            <h4 className="font-bold text-gray-900 mb-1">{subject.subject_name}</h4>
            <div className="flex justify-between items-center text-sm text-gray-700">
                <div className="flex items-center gap-2">
                    <Target className="w-4 h-4" />
                    <span>Average Score:</span>
                </div>
                <span className={`font-bold ${color}`}>{subject.average_score}%</span>
            </div>
            <div className="flex justify-between items-center text-sm text-gray-700 mt-1">
                <div className="flex items-center gap-2">
                    <Clock className="w-4 h-4" />
                    <span>Time Practiced:</span>
                </div>
                <span className="font-bold">{timeHours} hrs</span>
            </div>
        </div>
    );
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\pages\AuthCallback.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { useEffect } from "react";
import { useNavigate } from "react-router";
import { useAuth } from "@getmocha/users-service/react";
import { Loader2 } from "lucide-react";

export default function AuthCallback() {
  const { exchangeCodeForSessionToken } = useAuth();
  const navigate = useNavigate();

  useEffect(() => {
    const handleCallback = async () => {
      try {
        await exchangeCodeForSessionToken();
        navigate("/dashboard");
      } catch (error) {
        console.error("Authentication error:", error);
        navigate("/");
      }
    };

    handleCallback();
  }, [exchangeCodeForSessionToken, navigate]);

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 flex items-center justify-center">
      <div className="flex flex-col items-center gap-4">
        <div className="animate-spin">
          <Loader2 className="w-12 h-12 text-indigo-600" />
        </div>
        <p className="text-lg text-gray-600 font-medium">Completing sign in...</p>
      </div>
    </div>
  );
}


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\pages\DailyChallenges.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { useEffect, useState } from "react";
import { useNavigate } from "react-router";
import { useAuth } from "@getmocha/users-service/react";
import { Trophy, Zap, Clock, Calendar, CheckCircle2, XCircle, ArrowRight } from "lucide-react";
import Navigation from "@/react-app/components/Navigation";
import type { MochaUser } from "@getmocha/users-service/shared";

// --- TYPES ---
interface Challenge {
  id: number;
  skill_id: number;
  skill_name: string;
  subject_name: string;
  questions_required: number;
  accuracy_required: number;
  xp_reward: number;
  challenge_date: string; // YYYY-MM-DD
}

interface UserChallengeProgress {
  challenge_id: number;
  questions_completed: number;
  questions_correct: number;
  is_completed: boolean;
  completed_at: string | null;
}

interface UserStats {
  total_completed: number;
  current_streak: number;
}

// --- 1. MOCK USER ---
const MOCK_USER: MochaUser = {
  id: "dev-user",
  email: "sibusiso@example.com",
  google_sub: "dev-google-sub",
  last_signed_in_at: new Date().toISOString(),
  created_at: new Date().toISOString(),
  updated_at: new Date().toISOString(),
  google_user_data: {
    given_name: "Sibusiso King-Junior",
    name: "Sibusiso King-Junior Nkosi",
    picture: null,
    email: "sibusiso@example.com",
    email_verified: true,
    sub: "dev-google-sub"
  }
};

// --- 2. MOCK DATA (Offline Content) ---
const MOCK_CURRENT_CHALLENGE: Challenge & UserChallengeProgress = {
  id: 101,
  skill_id: 1,
  skill_name: "Solve one-variable equations",
  subject_name: "Engineering Mathematics N4",
  questions_required: 15,
  accuracy_required: 80,
  xp_reward: 150,
  challenge_date: new Date().toISOString().split('T')[0], // Today
  
  // User Progress (Mock)
  questions_completed: 7,
  questions_correct: 5,
  is_completed: false,
  completed_at: null,
};

const MOCK_RECENT_CHALLENGES: (Challenge & UserChallengeProgress)[] = [
  { 
    id: 100, skill_id: 2, skill_name: "Vector Addition", subject_name: "Engineering Science N4", questions_required: 10, accuracy_required: 70, xp_reward: 100, challenge_date: "2023-11-20", 
    questions_completed: 10, questions_correct: 8, is_completed: true, completed_at: "2023-11-20T18:00:00Z" 
  },
  { 
    id: 99, skill_id: 3, skill_name: "DC Circuits", subject_name: "Industrial Electronics N4", questions_required: 12, accuracy_required: 75, xp_reward: 120, challenge_date: "2023-11-19", 
    questions_completed: 5, questions_correct: 4, is_completed: false, completed_at: null 
  },
  { 
    id: 98, skill_id: 4, skill_name: "Heat Transfer", subject_name: "Thermodynamics N5", questions_required: 20, accuracy_required: 85, xp_reward: 200, challenge_date: "2023-11-18", 
    questions_completed: 20, questions_correct: 18, is_completed: true, completed_at: "2023-11-18T17:30:00Z" 
  },
];

const MOCK_USER_STATS: UserStats = {
  total_completed: 15,
  current_streak: 7,
};

export default function DailyChallenges() {
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  
  const displayUser = user || MOCK_USER;

  // Initializing state with MOCK data to prevent fetch errors
  const [currentChallenge] = useState<typeof MOCK_CURRENT_CHALLENGE>(MOCK_CURRENT_CHALLENGE);
  const [recentChallenges] = useState(MOCK_RECENT_CHALLENGES);
  const [userStats] = useState(MOCK_USER_STATS);

  // Disable redirect
  useEffect(() => {}, [user, navigate]);

  const handleLogout = async () => {
    await logout();
    navigate("/");
  };

  const accuracyRate = currentChallenge.questions_completed > 0 
    ? (currentChallenge.questions_correct / currentChallenge.questions_completed) * 100 
    : 0;

  const questionsRemaining = Math.max(0, currentChallenge.questions_required - currentChallenge.questions_completed);

  const isChallengeInProgress = currentChallenge.questions_completed > 0 && !currentChallenge.is_completed;
  
  let statusText = "Ready to start";
  if (currentChallenge.is_completed) {
    statusText = "Completed! Claim your XP.";
  } else if (isChallengeInProgress) {
    statusText = "In Progress";
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
      <Navigation onLogout={handleLogout} user={displayUser} />

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-gray-900 mb-2 flex items-center gap-3">
            <Trophy className="w-8 h-8 text-yellow-600" /> Daily Challenges
          </h1>
          <p className="text-gray-600">Challenge yourself daily for bonus XP and mastery!</p>
        </div>

        {/* User Stats Card */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
          <StatCard icon={Trophy} label="Total Completed" value={userStats.total_completed.toString()} gradient="from-yellow-500 to-orange-500" />
          <StatCard icon={Zap} label="Challenge Streak" value={`${userStats.current_streak} days`} gradient="from-indigo-500 to-purple-500" />
          <StatCard icon={CheckCircle2} label="Daily Goal" value={currentChallenge.is_completed ? "Completed" : "Active"} gradient={currentChallenge.is_completed ? "from-green-500 to-emerald-500" : "from-red-500 to-pink-500"} />
          <StatCard icon={Clock} label="Time Left" value="23:45:00" gradient="from-blue-500 to-cyan-500" />
        </div>

        <div className="grid lg:grid-cols-3 gap-8">
          {/* Current Challenge */}
          <div className="lg:col-span-2">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">Today's Challenge</h2>
            <div className="bg-white rounded-2xl shadow-xl p-8 border border-gray-100">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-3">
                  <div className="w-12 h-12 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-lg flex items-center justify-center shadow-md">
                    <Zap className="w-6 h-6 text-white" />
                  </div>
                  <div>
                    <p className="text-sm font-semibold text-gray-500 uppercase tracking-wider">
                      {currentChallenge.subject_name}
                    </p>
                    <h3 className="text-xl font-bold text-gray-900">
                      {currentChallenge.skill_name}
                    </h3>
                  </div>
                </div>
                <div className={`text-sm font-semibold px-3 py-1 rounded-full ${
                  currentChallenge.is_completed ? "bg-green-100 text-green-700" : "bg-yellow-100 text-yellow-700"
                }`}>
                  {statusText}
                </div>
              </div>

              <div className="grid grid-cols-3 gap-4 border-t border-b border-gray-200 py-4 mb-6">
                <ChallengeMetric label="Questions" value={`${currentChallenge.questions_completed}/${currentChallenge.questions_required}`} />
                <ChallengeMetric label="Accuracy Target" value={`${currentChallenge.accuracy_required}%`} />
                <ChallengeMetric label="Reward" value={`${currentChallenge.xp_reward} XP`} />
              </div>

              {/* Progress Bar and Status */}
              <div className="mb-6">
                <div className="flex justify-between items-center text-sm font-medium text-gray-700 mb-2">
                  <span>Questions Progress</span>
                  <span>{Math.round((currentChallenge.questions_completed / currentChallenge.questions_required) * 100)}%</span>
                </div>
                <div className="bg-gray-200 rounded-full h-3 overflow-hidden">
                  <div
                    className="bg-gradient-to-r from-indigo-500 to-purple-500 h-full transition-all duration-500 rounded-full"
                    style={{
                      width: `${Math.min((currentChallenge.questions_completed / currentChallenge.questions_required) * 100, 100)}%`,
                    }}
                  ></div>
                </div>
              </div>
              
              {/* Accuracy Status */}
              <div className="flex items-center justify-between p-3 bg-indigo-50 rounded-lg border border-indigo-200 mb-6">
                  <div className="text-sm font-medium text-indigo-700">
                      Current Accuracy: {accuracyRate.toFixed(1)}%
                  </div>
                  <div className={`text-sm font-bold ${accuracyRate >= currentChallenge.accuracy_required ? 'text-green-600' : 'text-red-600'}`}>
                      {accuracyRate >= currentChallenge.accuracy_required ? 'Target Met' : 'Target Not Met'}
                  </div>
              </div>

              {/* Action Button */}
              <div className="flex justify-end">
                {currentChallenge.is_completed ? (
                  <button
                    onClick={() => alert("XP claimed! Navigating back.")}
                    className="px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105 flex items-center gap-2 disabled:opacity-50"
                  >
                    <CheckCircle2 className="w-5 h-5" />
                    Claim Reward
                  </button>
                ) : (
                  <button
                    onClick={() => navigate(`/skills/${currentChallenge.skill_id}/practice`)}
                    className="px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105 flex items-center gap-2"
                  >
                    {isChallengeInProgress ? "Continue Practice" : "Start Challenge"}
                    <ArrowRight className="w-5 h-5" />
                  </button>
                )}
              </div>
            </div>
          </div>

          {/* Recent Challenges */}
          <div className="lg:col-span-1">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">Recent Challenges</h2>
            <div className="space-y-4">
              {recentChallenges.map((challenge) => (
                <RecentChallengeCard key={challenge.id} challenge={challenge} />
              ))}
            </div>
          </div>
        </div>
      </main>
    </div>
  );
}

function StatCard({ icon: Icon, label, value, gradient }: { icon: any; label: string; value: string; gradient: string; }) {
  return (
    <div className="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
      <div className="flex items-center gap-4">
        <div className={`w-12 h-12 bg-gradient-to-r ${gradient} rounded-lg flex items-center justify-center shadow-md`}>
          <Icon className="w-6 h-6 text-white" />
        </div>
        <div>
          <p className="text-sm text-gray-600 mb-1">{label}</p>
          <p className="text-2xl font-bold text-gray-900">{value}</p>
        </div>
      </div>
    </div>
  );
}

function ChallengeMetric({ label, value }: { label: string; value: string; }) {
  return (
    <div className="text-center">
      <p className="text-sm font-medium text-gray-500 mb-1">{label}</p>
      <p className="text-xl font-bold text-gray-900">{value}</p>
    </div>
  );
}

function RecentChallengeCard({ challenge }: { challenge: Challenge & UserChallengeProgress }) {
  const challengeAccuracy = challenge.questions_completed > 0 
    ? (challenge.questions_correct / challenge.questions_completed) * 100 
    : 0;
  
  const isTargetMet = challengeAccuracy >= challenge.accuracy_required;

  return (
    <div className={`bg-white rounded-xl shadow-md p-5 border ${challenge.is_completed && isTargetMet ? "border-green-200" : "border-gray-200"}`}>
      <div className="flex justify-between items-start mb-2">
        <div className="flex items-center gap-2">
          {challenge.is_completed && isTargetMet ? (
            <CheckCircle2 className="w-5 h-5 text-green-600" />
          ) : (
            <XCircle className="w-5 h-5 text-red-600" />
          )}
          <h4 className="font-semibold text-gray-900">{challenge.skill_name}</h4>
        </div>
        <div className="text-sm text-gray-500 flex items-center gap-1">
            <Calendar className="w-4 h-4" />
            {challenge.challenge_date}
        </div>
      </div>
      <p className="text-xs text-gray-500 mb-3">{challenge.subject_name}</p>
      
      <div className="flex justify-between items-center pt-2 border-t border-gray-100">
        <div className="flex items-center gap-1 text-orange-600">
          <Zap className="w-4 h-4" />
          <span className="text-sm font-bold">{challenge.xp_reward} XP</span>
        </div>
        <div className={`text-sm font-semibold ${challenge.is_completed && isTargetMet ? 'text-green-600' : 'text-red-600'}`}>
          {challenge.is_completed && isTargetMet ? "SUCCESS" : "FAILED"}
        </div>
      </div>
    </div>
  );
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\pages\Dashboard.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { useEffect, useState } from "react";
import { useNavigate } from "react-router";
import { useAuth } from "@getmocha/users-service/react";
import { BookOpen, Target, Award, TrendingUp, ChevronRight, Zap, Trophy, ArrowRight, Loader2 } from "lucide-react";
import Navigation from "@/react-app/components/Navigation";
import type { MochaUser } from "@getmocha/users-service/shared";

// --- MOCK USER (for development mode) ---
const MOCK_USER: MochaUser = {
  id: "dev-user",
  email: "sibusiso@example.com",
  google_sub: "dev-google-sub",
  last_signed_in_at: new Date().toISOString(),
  created_at: new Date().toISOString(),
  updated_at: new Date().toISOString(),
  google_user_data: {
    given_name: "Sibusiso King-Junior",
    name: "Sibusiso King-Junior Nkosi",
    picture: null,
    email: "sibusiso@example.com",
    email_verified: true,
    sub: "dev-google-sub"
  }
};

interface DashboardStats {
  skills_practicing: number;
  skills_mastered: number;
  current_streak: number;
  total_badges: number;
}

interface RecentSkill {
  id: number;
  name: string;
  smart_score: number;
  subject_name: string;
  subject_color: string;
  subject_id: number;
}

interface DailyChallenge {
  id: number;
  skill_id: number;
  skill_name: string;
  target_questions: number;
  target_accuracy: number;
  xp_reward: number;
  questions_completed: number;
  questions_correct: number;
}

export default function Dashboard() {
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  const displayUser = user || MOCK_USER;

  const [stats, setStats] = useState<DashboardStats | null>(null);
  const [recentSkills, setRecentSkills] = useState<RecentSkill[]>([]);
  const [dailyChallenge, setDailyChallenge] = useState<DailyChallenge | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchDashboardData = async () => {
      try {
        setLoading(true);
        setError(null);

        // Fetch dashboard stats
        const statsResponse = await fetch('/api/dashboard/stats');
        if (!statsResponse.ok) throw new Error('Failed to fetch stats');
        const statsData = await statsResponse.json();
        setStats(statsData);

        // Fetch recent skills
        const skillsResponse = await fetch('/api/dashboard/recent-skills');
        if (!skillsResponse.ok) throw new Error('Failed to fetch recent skills');
        const skillsData = await skillsResponse.json();
        setRecentSkills(skillsData);

        // Fetch daily challenge
        const challengeResponse = await fetch('/api/daily-challenges/today');
        if (!challengeResponse.ok) throw new Error('Failed to fetch daily challenge');
        const challengeData = await challengeResponse.json();
        setDailyChallenge(challengeData);

      } catch (err) {
        console.error('Dashboard fetch error:', err);
        setError(err instanceof Error ? err.message : 'Failed to load dashboard');
      } finally {
        setLoading(false);
      }
    };

    fetchDashboardData();
  }, []);

  const handleLogout = async () => {
    await logout();
    navigate("/");
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
        <Navigation onLogout={handleLogout} user={displayUser} />
        <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div className="flex items-center justify-center min-h-[60vh]">
            <div className="flex flex-col items-center gap-4">
              <Loader2 className="w-12 h-12 text-indigo-600 animate-spin" />
              <p className="text-gray-600 font-medium">Loading your dashboard...</p>
            </div>
          </div>
        </main>
      </div>
    );
  }

  if (error) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
        <Navigation onLogout={handleLogout} user={displayUser} />
        <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div className="bg-red-50 border border-red-200 rounded-xl p-6 text-center">
            <p className="text-red-800 font-medium mb-4">{error}</p>
            <button
              onClick={() => window.location.reload()}
              className="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
            >
              Retry
            </button>
          </div>
        </main>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
      <Navigation onLogout={handleLogout} user={displayUser} />

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Welcome Section */}
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-gray-900 mb-2">
            Welcome back, {displayUser?.google_user_data?.given_name || 'Student'}!
          </h1>
          <p className="text-gray-600">Ready to continue your learning journey?</p>
        </div>

        {/* Quick Stats */}
        {stats && (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
            <StatCard 
              icon={BookOpen} 
              label="Skills Practicing" 
              value={stats.skills_practicing.toString()} 
              gradient="from-blue-500 to-cyan-500" 
            />
            <StatCard 
              icon={Target} 
              label="Skills Mastered" 
              value={stats.skills_mastered.toString()} 
              gradient="from-purple-500 to-pink-500" 
            />
            <StatCard 
              icon={TrendingUp} 
              label="Current Streak" 
              value={`${stats.current_streak} days`} 
              gradient="from-orange-500 to-red-500" 
            />
            <StatCard 
              icon={Award} 
              label="Badges Earned" 
              value={stats.total_badges.toString()} 
              gradient="from-green-500 to-emerald-500" 
            />
          </div>
        )}

        {/* Daily Challenge Banner */}
        {dailyChallenge && (
          <div className="mb-8 bg-gradient-to-r from-yellow-400 via-orange-500 to-pink-500 rounded-2xl shadow-xl p-8 text-white">
            <div className="flex items-start justify-between">
              <div className="flex-1">
                <div className="flex items-center gap-2 mb-3">
                  <Trophy className="w-6 h-6" />
                  <h2 className="text-2xl font-bold">Daily Challenge</h2>
                </div>
                <h3 className="text-xl font-semibold mb-2">{dailyChallenge.skill_name}</h3>
                <p className="text-white/90 mb-4">
                  Complete {dailyChallenge.target_questions} questions with {dailyChallenge.target_accuracy}% accuracy
                </p>
                {dailyChallenge.questions_completed > 0 && (
                  <div className="mb-4">
                    <div className="flex justify-between text-sm mb-1">
                      <span>Progress</span>
                      <span>{dailyChallenge.questions_completed}/{dailyChallenge.target_questions} questions</span>
                    </div>
                    <div className="bg-white/20 rounded-full h-2 overflow-hidden">
                      <div
                        className="bg-white h-full transition-all duration-500 rounded-full"
                        style={{
                          width: `${Math.min((dailyChallenge.questions_completed / dailyChallenge.target_questions) * 100, 100)}%`,
                        }}
                      ></div>
                    </div>
                  </div>
                )}
                <button
                  onClick={() => navigate(`/skills/${dailyChallenge.skill_id}/practice`)}
                  className="px-6 py-3 bg-white text-orange-600 rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105 flex items-center gap-2"
                >
                  <span>Start Challenge</span>
                  <ChevronRight className="w-5 h-5" />
                </button>
              </div>
              <div className="ml-6">
                <div className="w-24 h-24 bg-white/20 backdrop-blur-sm rounded-full flex flex-col items-center justify-center">
                  <Zap className="w-10 h-10 mb-1" />
                  <span className="text-2xl font-bold">{dailyChallenge.xp_reward}</span>
                  <span className="text-xs">XP</span>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* Main Content */}
        <div className="grid lg:grid-cols-3 gap-8">
          {/* Continue Learning */}
          <div className="lg:col-span-2 bg-white rounded-2xl shadow-lg p-8 border border-gray-100">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">Continue Learning</h2>
            
            {recentSkills.length === 0 ? (
              <div className="text-center py-12">
                <div className="w-20 h-20 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <BookOpen className="w-10 h-10 text-indigo-600" />
                </div>
                <h3 className="text-xl font-semibold text-gray-900 mb-2">Start Your Learning Journey</h3>
                <p className="text-gray-600 mb-6">Browse subjects to begin practicing skills</p>
                <button
                  onClick={() => navigate("/subjects")}
                  className="px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105"
                >
                  Browse Subjects
                </button>
              </div>
            ) : (
              <div className="space-y-4">
                {recentSkills.map((skill) => (
                  <RecentSkillCard
                    key={skill.id}
                    skill={skill}
                    onPractice={() => navigate(`/skills/${skill.id}/practice`)}
                    onSubject={() => navigate(`/subjects/${skill.subject_id}`)}
                  />
                ))}
              </div>
            )}
          </div>

          {/* Quick Actions */}
          <div className="bg-white rounded-2xl shadow-lg p-8 border border-gray-100">
            <h2 className="text-xl font-bold text-gray-900 mb-6">Quick Actions</h2>
            <div className="space-y-3">
              <QuickActionButton
                label="Browse All Subjects"
                onClick={() => navigate("/subjects")}
                gradient="from-indigo-500 to-purple-500"
              />
              <QuickActionButton
                label="View Analytics"
                onClick={() => navigate("/analytics")}
                gradient="from-blue-500 to-cyan-500"
              />
              <QuickActionButton
                label="My Achievements"
                onClick={() => navigate("/achievements")}
                gradient="from-yellow-500 to-orange-500"
              />
              <QuickActionButton
                label="Leaderboard"
                onClick={() => navigate("/leaderboard")}
                gradient="from-green-500 to-emerald-500"
              />
            </div>
            
            <div className="mt-8 pt-8 border-t border-gray-200">
              <h3 className="text-sm font-semibold text-gray-700 mb-4">Learning Tip</h3>
              <div className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl p-4 border border-indigo-100">
                <p className="text-sm text-gray-700">
                  Practice consistently to build your streak and improve your SmartScore!
                  Aim for at least 10-15 minutes daily.
                </p>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  );
}

function StatCard({ icon: Icon, label, value, gradient }: { icon: any; label: string; value: string; gradient: string; }) {
  return (
    <div className="bg-white rounded-xl shadow-lg p-6 border border-gray-100 hover:shadow-xl transition-shadow duration-200">
      <div className="flex items-center gap-4">
        <div className={`w-12 h-12 bg-gradient-to-r ${gradient} rounded-lg flex items-center justify-center shadow-md`}>
          <Icon className="w-6 h-6 text-white" />
        </div>
        <div>
          <p className="text-sm text-gray-600 mb-1">{label}</p>
          <p className="text-2xl font-bold text-gray-900">{value}</p>
        </div>
      </div>
    </div>
  );
}

function RecentSkillCard({ skill, onPractice, onSubject }: { skill: RecentSkill; onPractice: () => void; onSubject: () => void; }) {
  return (
    <div className="group w-full bg-gradient-to-r from-gray-50 to-white rounded-xl shadow-sm hover:shadow-md transition-all duration-300 p-6 border border-gray-200">
      <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
        
        {/* Left Side: Icon + Text Info */}
        <div className="flex items-center gap-4 flex-1">
          <div className={`w-12 h-12 bg-gradient-to-r ${skill.subject_color} rounded-lg flex items-center justify-center shadow-md flex-shrink-0`}>
            <Target className="w-6 h-6 text-white" />
          </div>
          <div className="flex-1 min-w-0">
            {/* Subject Name (Prominent) */}
            <h3 className="text-lg font-bold text-gray-900 leading-tight">{skill.subject_name}</h3>
            {/* Skill Name (Smaller, below) */}
            <p className="text-sm text-gray-500 font-medium mt-1">{skill.name}</p>
          </div>
        </div>
        
        {/* Right Side: Score + Actions */}
        <div className="flex items-center gap-6 w-full sm:w-auto justify-between sm:justify-end">
          <div className="text-right">
            <div className="text-2xl font-bold text-gray-900">{skill.smart_score}</div>
            <div className="text-xs text-gray-500 uppercase tracking-wider font-semibold">SmartScore</div>
          </div>
          
          <div className="flex flex-col gap-2">
            {/* Practice Button */}
            <button 
              onClick={onPractice}
              className="flex items-center gap-1 px-3 py-1.5 bg-indigo-600 text-white text-xs font-bold rounded-md hover:bg-indigo-700 transition-colors shadow-sm"
            >
              Practice <ArrowRight className="w-3 h-3" />
            </button>

            {/* Go To Subject Button */}
            <button 
              onClick={onSubject}
              className="text-xs text-gray-500 hover:text-indigo-600 font-medium underline decoration-dotted underline-offset-2 transition-colors text-center"
            >
              Go to Subject
            </button>
          </div>
        </div>

      </div>
    </div>
  );
}

function QuickActionButton({ label, onClick, gradient }: { label: string; onClick: () => void; gradient: string; }) {
  return (
    <button
      onClick={onClick}
      className={`w-full bg-gradient-to-r ${gradient} text-white rounded-xl p-4 font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105 flex items-center justify-between group`}
    >
      <span>{label}</span>
      <ChevronRight className="w-5 h-5 group-hover:translate-x-1 transition-transform" />
    </button>
  );
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\pages\Home.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { useEffect } from "react";
import { useNavigate } from "react-router";
import { useAuth } from "@getmocha/users-service/react";
import { BookOpen, Target, Trophy, TrendingUp, Award, Zap } from "lucide-react";

export default function Home() {
  const { user, isPending, redirectToLogin } = useAuth();
  const navigate = useNavigate();
  const devMode = true; // Development mode enabled

  // Bypass authentication in development
  useEffect(() => {
    if (devMode) {
      console.log("Development mode: Authentication bypassed");
      return;
    }
    
    if (!isPending && user) {
      navigate("/dashboard");
    }
  }, [user, isPending, navigate, devMode]);

  // Development login handler
  const handleDevLogin = () => {
    console.log("Development login - navigating to dashboard");
    navigate("/dashboard");
  };

  if (isPending && !devMode) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 flex items-center justify-center">
        <div className="animate-pulse flex flex-col items-center gap-4">
          <div className="w-16 h-16 bg-indigo-200 rounded-full"></div>
          <div className="h-4 w-32 bg-indigo-200 rounded"></div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
      {/* Hero Section */}
      <div className="relative overflow-hidden">
        <div className="absolute inset-0 bg-gradient-to-r from-indigo-600/10 to-purple-600/10 backdrop-blur-3xl"></div>
        
        <nav className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                <BookOpen className="w-6 h-6 text-white" />
              </div>
              <span className="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                NateWise
              </span>
            </div>
            <button
              onClick={devMode ? handleDevLogin : redirectToLogin}
              className="px-6 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg font-medium shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105"
            >
              {devMode ? "Enter App (Dev)" : "Sign In"}
            </button>
          </div>
        </nav>

        <div className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 sm:py-28">
          <div className="text-center">
            <div className="inline-flex items-center gap-2 px-4 py-2 bg-indigo-100 rounded-full mb-6">
              <Zap className="w-4 h-4 text-indigo-600" />
              <span className="text-sm font-semibold text-indigo-900">Development Mode</span>
            </div>
            
            <h1 className="text-5xl sm:text-6xl lg:text-7xl font-bold tracking-tight mb-6">
              <span className="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent">
                Master NATED Courses
              </span>
              <br />
              <span className="text-gray-900">With Confidence</span>
            </h1>
            
            <p className="text-xl sm:text-2xl text-gray-600 max-w-3xl mx-auto mb-12">
              Development Preview - Authentication is disabled for testing
            </p>
            
            <div className="flex flex-col sm:flex-row gap-4 justify-center mb-12">
              <button
                onClick={handleDevLogin}
                className="px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold text-lg shadow-2xl hover:shadow-indigo-500/50 transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2"
              >
                <span>Enter Development Mode</span>
                <Target className="w-5 h-5" />
              </button>
            </div>

            {/* Development Info */}
            <div className="max-w-2xl mx-auto mt-8 p-6 bg-yellow-50 border border-yellow-200 rounded-xl">
              <p className="text-yellow-800 font-medium">
                ğŸš§ Development Mode Active ğŸš§
              </p>
              <p className="text-yellow-700 text-sm mt-2">
                Authentication is disabled. Click "Enter Development Mode" to explore the app.
                Some features may not work without backend services.
              </p>
            </div>

            {/* Stats */}
            <div className="grid grid-cols-3 gap-6 max-w-2xl mx-auto mt-16">
              <StatItem number="9+" label="Subjects" />
              <StatItem number="1000+" label="Questions" />
              <StatItem number="100%" label="Free" />
            </div>
          </div>
        </div>
      </div>

      {/* Features Section */}
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24">
        <div className="text-center mb-16">
          <h2 className="text-4xl font-bold text-gray-900 mb-4">
            Everything You Need to <span className="bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">Excel</span>
          </h2>
          <p className="text-xl text-gray-600 max-w-2xl mx-auto">
            Built specifically for NATED students with features that make learning effective and engaging
          </p>
        </div>

        <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-8">
          <FeatureCard
            icon={Target}
            title="Adaptive Questions"
            description="Questions adjust to your skill level in real-time for optimal learning"
            gradient="from-blue-500 to-cyan-500"
          />
          <FeatureCard
            icon={Trophy}
            title="SmartScore System"
            description="Track your mastery with our intelligent scoring algorithm (0-100)"
            gradient="from-purple-500 to-pink-500"
          />
          <FeatureCard
            icon={TrendingUp}
            title="Progress Tracking"
            description="Detailed insights into your learning journey with streaks and stats"
            gradient="from-orange-500 to-red-500"
          />
          <FeatureCard
            icon={BookOpen}
            title="NATED Aligned"
            description="Curriculum perfectly aligned with N4-N6 course requirements"
            gradient="from-green-500 to-emerald-500"
          />
        </div>
      </div>

      {/* How It Works */}
      <div className="bg-white/50 backdrop-blur-sm py-24">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="text-center mb-16">
            <h2 className="text-4xl font-bold text-gray-900 mb-4">How NateWise Works</h2>
            <p className="text-xl text-gray-600">Simple, effective, and designed for your success</p>
          </div>

          <div className="grid md:grid-cols-3 gap-12">
            <Step
              number={1}
              title="Choose Your Subject"
              description="Select from N4-N6 subjects including Engineering Mathematics, Science, Electronics, and more"
              icon={BookOpen}
            />
            <Step
              number={2}
              title="Practice Skills"
              description="Work through adaptive questions that match your current skill level and help you improve"
              icon={Target}
            />
            <Step
              number={3}
              title="Track Progress"
              description="Watch your SmartScore grow as you master each skill and build your knowledge"
              icon={Award}
            />
          </div>
        </div>
      </div>

      {/* Subjects Preview */}
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24">
        <div className="text-center mb-16">
          <h2 className="text-4xl font-bold text-gray-900 mb-4">Available Subjects</h2>
          <p className="text-xl text-gray-600">Comprehensive coverage of NATED N4-N6 curriculum</p>
        </div>

        <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
          <SubjectCard name="Engineering Mathematics" level="N4-N6" color="from-blue-500 to-indigo-500" />
          <SubjectCard name="Engineering Science" level="N4-N5" color="from-purple-500 to-pink-500" />
          <SubjectCard name="Industrial Electronics" level="N4-N6" color="from-green-500 to-emerald-500" />
          <SubjectCard name="Mechanotechnology" level="N4" color="from-orange-500 to-amber-500" />
          <SubjectCard name="Electrotechnology" level="N4" color="from-yellow-500 to-orange-500" />
          <SubjectCard name="Engineering Drawing" level="N4" color="from-teal-500 to-cyan-500" />
        </div>
      </div>

      {/* CTA Section */}
      <div className="bg-gradient-to-r from-indigo-600 to-purple-600 py-20">
        <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
          <h2 className="text-4xl font-bold text-white mb-6">
            Ready to Master Your NATED Courses?
          </h2>
          <p className="text-xl text-indigo-100 mb-8">
            Development Preview - Explore the platform features
          </p>
          <button
            onClick={handleDevLogin}
            className="px-10 py-4 bg-white text-indigo-600 rounded-xl font-semibold text-lg shadow-2xl hover:shadow-white/30 transition-all duration-200 hover:scale-105"
          >
            Explore Development Mode
          </button>
        </div>
      </div>

      {/* Footer */}
      <footer className="border-t border-gray-200 bg-white/50 backdrop-blur-sm">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
          <div className="flex flex-col items-center gap-4">
            <div className="flex items-center gap-3">
              <div className="w-8 h-8 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-lg flex items-center justify-center">
                <BookOpen className="w-5 h-5 text-white" />
              </div>
              <span className="text-xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                NateWise
              </span>
            </div>
            <p className="text-gray-600 text-center">
              Development Preview - Empowering South African students to excel in NATED courses
            </p>
            <p className="text-sm text-gray-500">
              Â© 2025 NateWise. Development Mode Active.
            </p>
          </div>
        </div>
      </footer>
    </div>
  );
}

function StatItem({ number, label }: { number: string; label: string }) {
  return (
    <div className="text-center">
      <div className="text-3xl sm:text-4xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-1">
        {number}
      </div>
      <div className="text-sm text-gray-600 font-medium">{label}</div>
    </div>
  );
}

function FeatureCard({ 
  icon: Icon, 
  title, 
  description, 
  gradient 
}: { 
  icon: any; 
  title: string; 
  description: string; 
  gradient: string;
}) {
  return (
    <div className="relative group">
      <div className={`absolute inset-0 bg-gradient-to-r ${gradient} opacity-0 group-hover:opacity-100 blur-xl transition-opacity duration-500`}></div>
      <div className="relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all duration-300 border border-gray-100 group-hover:border-transparent">
        <div className={`w-14 h-14 bg-gradient-to-r ${gradient} rounded-xl flex items-center justify-center mb-5 shadow-lg`}>
          <Icon className="w-7 h-7 text-white" />
        </div>
        <h3 className="text-xl font-bold text-gray-900 mb-3">{title}</h3>
        <p className="text-gray-600 leading-relaxed">{description}</p>
      </div>
    </div>
  );
}

function Step({ 
  number, 
  title, 
  description, 
  icon: Icon 
}: { 
  number: number; 
  title: string; 
  description: string;
  icon: any;
}) {
  return (
    <div className="relative text-center">
      <div className="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-full text-white text-2xl font-bold mb-6 shadow-xl">
        {number}
      </div>
      <div className="mb-4">
        <Icon className="w-12 h-12 text-indigo-600 mx-auto mb-3" />
        <h3 className="text-xl font-bold text-gray-900 mb-2">{title}</h3>
      </div>
      <p className="text-gray-600">{description}</p>
    </div>
  );
}

function SubjectCard({ 
  name, 
  level, 
  color 
}: { 
  name: string; 
  level: string; 
  color: string;
}) {
  return (
    <div className="bg-white rounded-xl p-6 shadow-lg border border-gray-100 hover:shadow-xl transition-all duration-200 hover:scale-105">
      <div className={`w-12 h-12 bg-gradient-to-r ${color} rounded-lg flex items-center justify-center mb-4 shadow-md`}>
        <BookOpen className="w-6 h-6 text-white" />
      </div>
      <h3 className="text-lg font-bold text-gray-900 mb-1">{name}</h3>
      <p className="text-sm text-gray-600">Level: {level}</p>
    </div>
  );
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\pages\JsonBulkImporter.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { useState } from "react";

interface JsonContent {
  subjects: Array<{
    name: string;
    code: string;
    nated_level: string;
    description: string;
    color_hex: string;
    modules: Array<{
      name: string;
      description: string;
      topics: Array<{
        name: string;
        description: string;
        skills: Array<{
          name: string;
          description: string;
          difficulty_level?: number;
          mastery_threshold?: number;
          questions: Array<{
            question_text: string;
            question_data: {
              options: string[];
              diagram?: string;
            };
            correct_answer: string;
            explanation: string;
            difficulty_rating?: number;
            points_value?: number;
          }>;
        }>;
      }>;
    }>;
  }>;
}

export default function JsonBulkImporter() {
  const [jsonContent, setJsonContent] = useState<string>("");
  const [parsedData, setParsedData] = useState<JsonContent | null>(null);
  const [importProgress, setImportProgress] = useState<string[]>([]);
  const [isImporting, setIsImporting] = useState(false);

  const addProgress = (message: string) => {
    setImportProgress(prev => [...prev, `${new Date().toLocaleTimeString()}: ${message}`]);
  };

  const validateJson = (): boolean => {
    try {
      if (!jsonContent.trim()) {
        addProgress("âŒ No JSON content provided");
        return false;
      }

      const data = JSON.parse(jsonContent) as JsonContent;
      
      if (!data.subjects || !Array.isArray(data.subjects)) {
        addProgress("âŒ Invalid JSON structure: Missing 'subjects' array");
        return false;
      }

      // Validate structure
      for (const subject of data.subjects) {
        if (!subject.name || !subject.code) {
          addProgress(`âŒ Invalid subject: Missing name or code`);
          return false;
        }

        for (const module of subject.modules || []) {
          if (!module.name) {
            addProgress(`âŒ Invalid module in ${subject.name}: Missing name`);
            return false;
          }

          for (const topic of module.topics || []) {
            if (!topic.name) {
              addProgress(`âŒ Invalid topic in ${module.name}: Missing name`);
              return false;
            }

            for (const skill of topic.skills || []) {
              if (!skill.name) {
                addProgress(`âŒ Invalid skill in ${topic.name}: Missing name`);
                return false;
              }

              for (const question of skill.questions || []) {
                if (!question.question_text || !question.correct_answer) {
                  addProgress(`âŒ Invalid question in ${skill.name}: Missing text or correct answer`);
                  return false;
                }
                if (!question.question_data?.options || question.question_data.options.length < 2) {
                  addProgress(`âŒ Invalid question in ${skill.name}: Need at least 2 options`);
                  return false;
                }
              }
            }
          }
        }
      }

      setParsedData(data);
      addProgress(`âœ… Validated: ${data.subjects.length} subjects, ${data.subjects.flatMap(s => s.modules).length} modules`);
      return true;
    } catch (error) {
      addProgress(`âŒ JSON parsing error: ${error instanceof Error ? error.message : 'Unknown error'}`);
      return false;
    }
  };

  const createSubject = async (subjectData: any): Promise<number> => {
    const response = await fetch("/api/subjects", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(subjectData)
    });
    
    if (!response.ok) throw new Error(`Failed to create subject: ${response.statusText}`);
    
    const result = await response.json();
    return result.id;
  };

  const createModule = async (subjectId: number, moduleData: any): Promise<number> => {
    const response = await fetch("/api/modules", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ...moduleData, subject_id: subjectId })
    });
    
    if (!response.ok) throw new Error(`Failed to create module: ${response.statusText}`);
    
    const result = await response.json();
    return result.id;
  };

  const createTopic = async (moduleId: number, topicData: any): Promise<number> => {
    const response = await fetch("/api/topics", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ...topicData, module_id: moduleId })
    });
    
    if (!response.ok) throw new Error(`Failed to create topic: ${response.statusText}`);
    
    const result = await response.json();
    return result.id;
  };

  const createSkill = async (topicId: number, skillData: any): Promise<number> => {
    const response = await fetch("/api/skills", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ 
        ...skillData, 
        topic_id: topicId,
        difficulty_level: skillData.difficulty_level || 1,
        mastery_threshold: skillData.mastery_threshold || 80
      })
    });
    
    if (!response.ok) throw new Error(`Failed to create skill: ${response.statusText}`);
    
    const result = await response.json();
    return result.id;
  };

  const createQuestion = async (skillId: number, questionData: any): Promise<number> => {
    const response = await fetch("/api/questions", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        skill_id: skillId,
        question_text: questionData.question_text,
        question_data: questionData.question_data,
        correct_answer: questionData.correct_answer,
        explanation: questionData.explanation || "",
        question_type: "multiple_choice",
        difficulty_rating: questionData.difficulty_rating || 1,
        points_value: questionData.points_value || 10
      })
    });
    
    if (!response.ok) throw new Error(`Failed to create question: ${response.statusText}`);
    
    const result = await response.json();
    return result.id;
  };

  const importContent = async () => {
    if (!parsedData || !validateJson()) return;

    setIsImporting(true);
    setImportProgress([]);
    
    try {
      addProgress("ğŸš€ Starting bulk import...");

      let totalSubjects = 0;
      let totalModules = 0;
      let totalTopics = 0;
      let totalSkills = 0;
      let totalQuestions = 0;

      for (const subject of parsedData.subjects) {
        addProgress(`ğŸ“š Creating subject: ${subject.name}`);
        
        const subjectId = await createSubject(subject);
        totalSubjects++;
        addProgress(`  âœ… Created subject: ${subject.name} (ID: ${subjectId})`);

        for (const module of subject.modules || []) {
          addProgress(`  ğŸ“– Creating module: ${module.name}`);
          
          const moduleId = await createModule(subjectId, module);
          totalModules++;
          addProgress(`    âœ… Created module: ${module.name} (ID: ${moduleId})`);

          for (const topic of module.topics || []) {
            addProgress(`    ğŸ“ Creating topic: ${topic.name}`);
            
            const topicId = await createTopic(moduleId, topic);
            totalTopics++;
            addProgress(`      âœ… Created topic: ${topic.name} (ID: ${topicId})`);

            for (const skill of topic.skills || []) {
              addProgress(`      ğŸ¯ Creating skill: ${skill.name}`);
              
              const skillId = await createSkill(topicId, skill);
              totalSkills++;
              addProgress(`        âœ… Created skill: ${skill.name} (ID: ${skillId})`);

              for (const question of skill.questions || []) {
                addProgress(`        â“ Creating question for: ${skill.name}`);
                
                await createQuestion(skillId, question);
                totalQuestions++;
              }
              addProgress(`        âœ… Created ${skill.questions?.length || 0} questions for ${skill.name}`);
            }
          }
        }
      }

      addProgress("ğŸ‰ Bulk import completed successfully!");
      addProgress(`ğŸ“Š Summary: ${totalSubjects} subjects, ${totalModules} modules, ${totalTopics} topics, ${totalSkills} skills, ${totalQuestions} questions`);
      
      // Clear form after successful import
      setJsonContent("");
      setParsedData(null);

    } catch (error) {
      addProgress(`âŒ Import failed: ${error instanceof Error ? error.message : 'Unknown error'}`);
    } finally {
      setIsImporting(false);
    }
  };

  const loadSampleJson = () => {
    const sample = {
      subjects: [
        {
          name: "Engineering Science N3",
          code: "ENG-SCI-N3",
          nated_level: "N3",
          description: "Comprehensive engineering science principles",
          color_hex: "#EF4444",
          modules: [
            {
              name: "Statics and Dynamics",
              description: "Analysis of forces and motion",
              topics: [
                {
                  name: "Force Systems",
                  description: "Analysis of force systems",
                  skills: [
                    {
                      name: "Resolve Forces",
                      description: "Break down forces into components",
                      difficulty_level: 2,
                      mastery_threshold: 85,
                      questions: [
                        {
                          question_text: "A force of 100 N acts at 30Â° to the horizontal. What is the horizontal component?",
                          question_data: {
                            options: ["86.6 N", "50.0 N", "100 N", "70.7 N"],
                            diagram: "Force diagram showing components"
                          },
                          correct_answer: "86.6 N",
                          explanation: "Horizontal component = F Ã— cos(30Â°) = 100 Ã— 0.866 = 86.6 N",
                          difficulty_rating: 2,
                          points_value: 15
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    };

    setJsonContent(JSON.stringify(sample, null, 2));
    addProgress("ğŸ“ Sample JSON loaded. Click 'Validate JSON' to check structure.");
  };

  return (
    <div className="p-6 max-w-6xl mx-auto">
      <h1 className="text-2xl font-bold mb-6">JSON Bulk Content Importer</h1>
      
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Left side - JSON Input */}
        <div className="space-y-4">
          <div className="flex gap-2 mb-4">
            <button 
              onClick={loadSampleJson}
              className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
              disabled={isImporting}
            >
              Load Sample JSON
            </button>
            <button 
              onClick={validateJson}
              className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600"
              disabled={isImporting}
            >
              Validate JSON
            </button>
            <button 
              onClick={importContent}
              className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 disabled:bg-gray-400"
              disabled={isImporting || !parsedData}
            >
              {isImporting ? "Importing..." : "Start Import"}
            </button>
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">
              JSON Content (Subject â†’ Module â†’ Topic â†’ Skill â†’ Question hierarchy)
            </label>
            <textarea
              value={jsonContent}
              onChange={(e) => setJsonContent(e.target.value)}
              placeholder={`Paste your JSON content here...\n\nFormat:\n{\n  "subjects": [\n    {\n      "name": "Subject Name",\n      "code": "SUB-CODE",\n      "modules": [\n        {\n          "name": "Module Name",\n          "topics": [\n            {\n              "name": "Topic Name", \n              "skills": [\n                {\n                  "name": "Skill Name",\n                  "questions": [\n                    {\n                      "question_text": "Question?",\n                      "question_data": {\n                        "options": ["A", "B", "C", "D"]\n                      },\n                      "correct_answer": "A"\n                    }\n                  ]\n                }\n              ]\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}`}
              className="w-full h-96 font-mono text-sm p-4 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              disabled={isImporting}
            />
          </div>
        </div>

        {/* Right side - Progress Log */}
        <div>
          <h3 className="text-lg font-semibold mb-3">Import Progress</h3>
          <div className="bg-gray-900 text-green-400 font-mono text-sm p-4 rounded-lg h-96 overflow-y-auto">
            {importProgress.length === 0 ? (
              <div className="text-gray-400">
                Import progress will appear here...
                <br />
                <br />
                <strong>Expected JSON Structure:</strong>
                <br />
                â€¢ subjects[] â†’ modules[] â†’ topics[] â†’ skills[] â†’ questions[]
                <br />
                â€¢ Each question needs: question_text, question_data.options[], correct_answer
                <br />
                â€¢ Use Load Sample JSON to see a working example
              </div>
            ) : (
              importProgress.map((message, index) => (
                <div key={index} className="mb-1">
                  {message}
                </div>
              ))
            )}
          </div>

          {parsedData && (
            <div className="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
              <h4 className="font-semibold text-green-800 mb-2">âœ… JSON Validated Successfully!</h4>
              <div className="text-sm text-green-700">
                <div>Subjects: {parsedData.subjects.length}</div>
                <div>Total Modules: {parsedData.subjects.flatMap(s => s.modules).length}</div>
                <div>Total Topics: {parsedData.subjects.flatMap(s => s.modules.flatMap(m => m.topics)).length}</div>
                <div>Total Skills: {parsedData.subjects.flatMap(s => s.modules.flatMap(m => m.topics.flatMap(t => t.skills))).length}</div>
                <div>Total Questions: {parsedData.subjects.flatMap(s => s.modules.flatMap(m => m.topics.flatMap(t => t.skills.flatMap(sk => sk.questions)))).length}</div>
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\pages\Leaderboard.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { useEffect, useState } from "react";
import { useNavigate } from "react-router";
import { useAuth } from "@getmocha/users-service/react";
import { Zap, Medal, Crown } from "lucide-react";
import Navigation from "@/react-app/components/Navigation";
import type { MochaUser } from "@getmocha/users-service/shared";

interface LeaderboardEntry {
  rank: number;
  user_id: string;
  display_name: string;
  avatar_url: string | null;
  score: number;
  is_current_user: boolean;
}

interface LeaderboardData {
  weekly: LeaderboardEntry[];
  monthly: LeaderboardEntry[];
  allTime: LeaderboardEntry[];
}

// --- 1. MOCK USER ---
const MOCK_USER: MochaUser = {
  id: "dev-user",
  email: "sibusiso@example.com",
  google_sub: "dev-google-sub",
  last_signed_in_at: new Date().toISOString(),
  created_at: new Date().toISOString(),
  updated_at: new Date().toISOString(),
  google_user_data: {
    given_name: "Sibusiso King-Junior",
    name: "Sibusiso King-Junior Nkosi",
    picture: null,
    email: "sibusiso@example.com",
    email_verified: true,
    sub: "dev-google-sub"
  }
};

// --- 2. MOCK LEADERBOARD DATA ---
const MOCK_LEADERBOARD: LeaderboardData = {
  weekly: [
    { rank: 1, user_id: "u1", display_name: "Thabo M.", avatar_url: null, score: 2500, is_current_user: false },
    { rank: 2, user_id: "u2", display_name: "Lerato K.", avatar_url: null, score: 2350, is_current_user: false },
    { rank: 3, user_id: "u3", display_name: "Sibusiso Nkosi", avatar_url: null, score: 2100, is_current_user: true }, // Current User
    { rank: 4, user_id: "u4", display_name: "Kevin D.", avatar_url: null, score: 1800, is_current_user: false },
    { rank: 5, user_id: "u5", display_name: "Sarah L.", avatar_url: null, score: 1500, is_current_user: false },
  ],
  monthly: [
    { rank: 1, user_id: "u2", display_name: "Lerato K.", avatar_url: null, score: 8500, is_current_user: false },
    { rank: 2, user_id: "u1", display_name: "Thabo M.", avatar_url: null, score: 8100, is_current_user: false },
    { rank: 3, user_id: "u4", display_name: "Kevin D.", avatar_url: null, score: 7200, is_current_user: false },
    { rank: 12, user_id: "u3", display_name: "Sibusiso Nkosi", avatar_url: null, score: 4500, is_current_user: true },
  ],
  allTime: [
    { rank: 1, user_id: "u5", display_name: "Sarah L.", avatar_url: null, score: 50000, is_current_user: false },
    { rank: 2, user_id: "u1", display_name: "Thabo M.", avatar_url: null, score: 48000, is_current_user: false },
    { rank: 3, user_id: "u2", display_name: "Lerato K.", avatar_url: null, score: 46500, is_current_user: false },
    { rank: 45, user_id: "u3", display_name: "Sibusiso Nkosi", avatar_url: null, score: 12000, is_current_user: true },
  ]
};

export default function Leaderboard() {
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  const [data] = useState<LeaderboardData>(MOCK_LEADERBOARD); // Load mock data directly
  const [activeTab, setActiveTab] = useState<"weekly" | "monthly" | "allTime">("weekly");

  const displayUser = user || MOCK_USER;

  // Disable redirect
  useEffect(() => {}, [user, navigate]);

  const handleLogout = async () => {
    await logout();
    navigate("/");
  };

  const currentData = data?.[activeTab] || [];

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
      <Navigation onLogout={handleLogout} user={displayUser} />

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-gray-900 mb-2">Leaderboard</h1>
          <p className="text-gray-600">See how you stack up against other students</p>
        </div>

        {/* Tabs */}
        <div className="flex gap-2 mb-8">
          {[
            { key: "weekly" as const, label: "This Week" },
            { key: "monthly" as const, label: "This Month" },
            { key: "allTime" as const, label: "All Time" },
          ].map((tab) => (
            <button
              key={tab.key}
              onClick={() => setActiveTab(tab.key)}
              className={`px-6 py-3 rounded-lg font-medium transition-all duration-200 ${
                activeTab === tab.key
                  ? "bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-md"
                  : "bg-white text-gray-700 hover:bg-gray-100 border border-gray-200"
              }`}
            >
              {tab.label}
            </button>
          ))}
        </div>

        {/* Top 3 Podium */}
        {currentData.length >= 3 && (
          <div className="mb-8">
            <div className="flex items-end justify-center gap-4 mb-8">
              {/* 2nd Place */}
              <PodiumCard entry={currentData[1]} position={2} />
              {/* 1st Place */}
              <PodiumCard entry={currentData[0]} position={1} />
              {/* 3rd Place */}
              <PodiumCard entry={currentData[2]} position={3} />
            </div>
          </div>
        )}

        {/* Rest of Leaderboard */}
        <div className="space-y-3">
          {currentData.slice(3).map((entry) => (
            <LeaderboardRow key={entry.user_id} entry={entry} />
          ))}
        </div>
      </main>
    </div>
  );
}

function PodiumCard({ entry, position }: { entry: LeaderboardEntry; position: number }) {
  const heights = { 1: "h-56", 2: "h-48", 3: "h-40" };
  const icons = {
    1: { icon: Crown, color: "from-yellow-400 to-amber-500", text: "text-yellow-600" },
    2: { icon: Medal, color: "from-gray-300 to-gray-400", text: "text-gray-600" },
    3: { icon: Medal, color: "from-orange-400 to-amber-600", text: "text-orange-600" },
  };
  const config = icons[position as keyof typeof icons];
  const Icon = config.icon;

  return (
    <div className="flex flex-col items-center">
      <div className="mb-4 relative">
        {entry.avatar_url ? (
          <img
            src={entry.avatar_url}
            alt={entry.display_name}
            className={`w-20 h-20 rounded-full border-4 ${
              entry.is_current_user ? "border-indigo-500" : "border-white"
            } shadow-xl`}
          />
        ) : (
          <div className={`w-20 h-20 rounded-full border-4 ${
            entry.is_current_user ? "border-indigo-500" : "border-white"
          } bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center shadow-xl`}>
            <span className="text-2xl font-bold text-white">
              {entry.display_name.charAt(0)}
            </span>
          </div>
        )}
        <div className={`absolute -top-2 -right-2 w-10 h-10 bg-gradient-to-r ${config.color} rounded-full flex items-center justify-center shadow-lg`}>
          <Icon className="w-6 h-6 text-white" />
        </div>
      </div>

      <div className={`${heights[position as keyof typeof heights]} w-48 bg-gradient-to-br from-white to-gray-50 rounded-t-2xl shadow-xl border-t-4 border-x-4 ${
        entry.is_current_user ? "border-indigo-500" : "border-gray-200"
      } p-6 flex flex-col items-center justify-between`}>
        <div className="text-center">
          <p className={`text-4xl font-bold mb-2 ${config.text}`}>#{position}</p>
          <p className="font-bold text-gray-900 mb-1 truncate max-w-full">{entry.display_name}</p>
          <div className="flex items-center justify-center gap-2 text-indigo-600">
            <Zap className="w-4 h-4" />
            <span className="font-semibold">{entry.score.toLocaleString()} XP</span>
          </div>
        </div>
      </div>
    </div>
  );
}

function LeaderboardRow({ entry }: { entry: LeaderboardEntry }) {
  return (
    <div
      className={`bg-white rounded-xl shadow-md hover:shadow-lg transition-all duration-200 p-6 border-2 ${
        entry.is_current_user
          ? "border-indigo-500 bg-gradient-to-r from-indigo-50 to-purple-50"
          : "border-gray-100"
      }`}
    >
      <div className="flex items-center gap-4">
        <div className="w-12 h-12 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center font-bold text-gray-700 flex-shrink-0">
          #{entry.rank}
        </div>
        
        {entry.avatar_url ? (
          <img
            src={entry.avatar_url}
            alt={entry.display_name}
            className="w-12 h-12 rounded-full shadow-md"
          />
        ) : (
          <div className="w-12 h-12 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center shadow-md">
            <span className="text-lg font-bold text-white">
              {entry.display_name.charAt(0)}
            </span>
          </div>
        )}

        <div className="flex-1">
          <p className="font-bold text-gray-900 mb-1">
            {entry.display_name}
            {entry.is_current_user && (
              <span className="ml-2 text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full font-semibold">
                You
              </span>
            )}
          </p>
        </div>

        <div className="flex items-center gap-2 text-indigo-600">
          <Zap className="w-5 h-5" />
          <span className="font-bold text-lg">{entry.score.toLocaleString()}</span>
          <span className="text-sm text-gray-600">XP</span>
        </div>
      </div>
    </div>
  );
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\pages\ModuleDetail.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { useEffect, useState } from "react";
import { useNavigate, useParams } from "react-router";
import { useAuth } from "@getmocha/users-service/react";
import { BookOpen, ChevronRight, Target } from "lucide-react";
import Navigation from "@/react-app/components/Navigation";
import ProgressRing from "@/react-app/components/ProgressRing";
import type { Module, Topic } from "@/shared/types";

interface ModuleWithTopics extends Module {
  topics: Topic[];
  subject?: {
    id: number;
    name: string;
    code: string;
    color_hex: string | null;
  };
}

export default function ModuleDetail() {
  const { user, isPending, logout } = useAuth();
  const navigate = useNavigate();
  const { id } = useParams();
  const [module, setModule] = useState<ModuleWithTopics | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    //if (!isPending && !user) {
   //   navigate("/");
   // }
  }, [user, isPending, navigate]);

  useEffect(() => {
    const fetchModule = async () => {
      try {
        const response = await fetch(`/api/modules/${id}`);
        if (!response.ok) {
          throw new Error("Module not found");
        }
        const data = await response.json();
        setModule(data);
      } catch (error) {
        console.error("Failed to fetch module:", error);
        navigate("/subjects");
      } finally {
        setLoading(false);
      }
    };

    if (user && id) {
      fetchModule();
    }
  }, [user, id, navigate]);

  if (isPending || !user) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50 flex items-center justify-center">
        <div className="animate-pulse flex flex-col items-center gap-4">
          <div className="w-16 h-16 bg-indigo-200 rounded-full"></div>
          <div className="h-4 w-32 bg-indigo-200 rounded"></div>
        </div>
      </div>
    );
  }

  const handleLogout = async () => {
    await logout();
    navigate("/");
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
        <Navigation onLogout={handleLogout} user={user} />
        <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div className="animate-pulse">
            <div className="h-10 bg-gray-200 rounded w-1/3 mb-4"></div>
            <div className="h-6 bg-gray-200 rounded w-1/2 mb-8"></div>
            <div className="grid gap-6">
              {[1, 2, 3].map((i) => (
                <div key={i} className="bg-white rounded-xl p-6 border border-gray-100">
                  <div className="h-6 bg-gray-200 rounded w-1/4 mb-4"></div>
                  <div className="h-4 bg-gray-200 rounded w-3/4"></div>
                </div>
              ))}
            </div>
          </div>
        </main>
      </div>
    );
  }

  if (!module) {
    return null;
  }

  const colorClass = module.subject?.color_hex || "from-indigo-500 to-purple-500";

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
      <Navigation onLogout={handleLogout} user={user} />

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Module Header */}
        <div className="mb-8">
          <button
            onClick={() => navigate(`/subjects/${module.subject_id}`)}
            className="text-indigo-600 hover:text-indigo-700 font-medium mb-4 flex items-center gap-1"
          >
            â† Back to {module.subject?.name || "Subject"}
          </button>
          <div className="flex items-center gap-4 mb-4">
            <div className={`w-16 h-16 bg-gradient-to-r ${colorClass} rounded-xl flex items-center justify-center shadow-lg`}>
              <BookOpen className="w-8 h-8 text-white" />
            </div>
            <div>
              <h1 className="text-3xl font-bold text-gray-900">{module.name}</h1>
              {module.subject && (
                <p className="text-gray-600">{module.subject.name}</p>
              )}
            </div>
          </div>
          {module.description && (
            <p className="text-gray-700 text-lg">{module.description}</p>
          )}
        </div>

        {/* Topics */}
        {module.topics.length === 0 ? (
          <div className="bg-white rounded-2xl shadow-lg p-12 text-center border border-gray-100">
            <div className="w-20 h-20 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <BookOpen className="w-10 h-10 text-indigo-600" />
            </div>
            <h3 className="text-xl font-semibold text-gray-900 mb-2">No topics available yet</h3>
            <p className="text-gray-600">Topics will appear here once they're added to this module.</p>
          </div>
        ) : (
          <div className="space-y-8">
            {module.topics.map((topic) => (
              <TopicSection
                key={topic.id}
                topic={topic}
                colorClass={colorClass}
                onSkillClick={(skillId) => navigate(`/skills/${skillId}/practice`)}
              />
            ))}
          </div>
        )}
      </main>
    </div>
  );
}

function TopicSection({ 
  topic, 
  colorClass,
  onSkillClick 
}: { 
  topic: Topic; 
  colorClass: string;
  onSkillClick: (skillId: number) => void;
}) {
  return (
    <div className="bg-white rounded-2xl shadow-lg p-8 border border-gray-100">
      <div className="mb-6">
        <h2 className="text-2xl font-bold text-gray-900 mb-2">{topic.name}</h2>
        {topic.description && (
          <p className="text-gray-600">{topic.description}</p>
        )}
      </div>

      {!topic.skills || topic.skills.length === 0 ? (
        <div className="text-center py-8">
          <div className="w-16 h-16 bg-gradient-to-br from-purple-100 to-pink-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <Target className="w-8 h-8 text-purple-600" />
          </div>
          <p className="text-gray-600">No skills available yet</p>
        </div>
      ) : (
        <div className="grid gap-4">
          {topic.skills.map((skill) => (
            <SkillCard
              key={skill.id}
              skill={skill}
              colorClass={colorClass}
              onClick={() => onSkillClick(skill.id)}
            />
          ))}
        </div>
      )}
    </div>
  );
}

function SkillCard({ 
  skill, 
  colorClass,
  onClick 
}: { 
  skill: any; 
  colorClass: string;
  onClick: () => void;
}) {
  const difficultyStars = "â˜…".repeat(skill.difficulty_level) + "â˜†".repeat(5 - skill.difficulty_level);

  return (
    <button
      onClick={onClick}
      className="group bg-gradient-to-r from-gray-50 to-white rounded-xl shadow hover:shadow-xl transition-all duration-300 p-6 border border-gray-200 hover:border-transparent text-left hover:scale-[1.02] relative overflow-hidden"
    >
      <div className={`absolute inset-0 bg-gradient-to-r ${colorClass} opacity-0 group-hover:opacity-5 transition-opacity`}></div>
      
      <div className="relative flex items-start justify-between gap-4">
        <div className="flex-1">
          <div className="flex items-center gap-3 mb-2">
            <div className={`w-10 h-10 bg-gradient-to-r ${colorClass} rounded-lg flex items-center justify-center shadow-md`}>
              <Target className="w-5 h-5 text-white" />
            </div>
            <div>
              <h3 className="text-lg font-bold text-gray-900">{skill.name}</h3>
              <p className="text-sm text-yellow-600">{difficultyStars}</p>
            </div>
          </div>
          {skill.description && (
            <p className="text-gray-600 text-sm mb-3 ml-13">{skill.description}</p>
          )}
          <div className="flex items-center gap-2 text-indigo-600 font-medium group-hover:gap-3 transition-all ml-13">
            <span className="text-sm">Start Practicing</span>
            <ChevronRight className="w-4 h-4" />
          </div>
        </div>
        
        {/* Progress indicator */}
        <div className="flex-shrink-0">
          <ProgressRing 
            progress={skill.smart_score || 0} 
            size={80}
            strokeWidth={6}
            color={skill.smart_score >= 90 ? '#10b981' : skill.smart_score >= 70 ? '#f59e0b' : '#6366f1'}
          />
        </div>
      </div>
    </button>
  );
}


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\pages\SkillPractice.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { useEffect, useState } from "react";
import { useNavigate, useParams } from "react-router";
import { useAuth } from "@getmocha/users-service/react";
import { CheckCircle2, XCircle, ArrowRight, Award, Target, TrendingUp, Lightbulb, Zap, BookOpen, Home, Clock } from "lucide-react";
import Navigation from "@/react-app/components/Navigation";
import type { MochaUser } from "@getmocha/users-service/shared";

// --- TYPES ---
interface Question {
  id: number;
  skill_id: number;
  question_type: string;
  question_text: string;
  question_data: string;
  correct_answer: string;
  explanation: string;
  difficulty_rating: number;
  points_value: number;
}

interface Skill {
  id: number;
  topic_id: number;
  name: string;
  description: string | null;
  difficulty_level: number;
  mastery_threshold: number;
}

interface Progress {
  smart_score: number;
  questions_attempted: number;
  questions_correct: number;
  current_streak: number;
  is_mastered: boolean;
}

// --- MOCK USER (fallback only for auth) ---
const MOCK_USER: MochaUser = {
  id: "dev-user",
  email: "sibusiso@example.com",
  google_sub: "dev-google-sub",
  last_signed_in_at: new Date().toISOString(),
  created_at: new Date().toISOString(),
  updated_at: new Date().toISOString(),
  google_user_data: {
    given_name: "Sibusiso King-Junior",
    name: "Sibusiso King-Junior Nkosi",
    picture: null,
    email: "sibusiso@example.com",
    email_verified: true,
    sub: "dev-google-sub"
  }
};

export default function SkillPractice() {
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  const { id } = useParams();
  
  const displayUser = user || MOCK_USER;
  const skillId = parseInt(id || '0');

  // State for real data
  const [skill, setSkill] = useState<Skill | null>(null);
  const [questions, setQuestions] = useState<Question[]>([]);
  const [progress, setProgress] = useState<Progress | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // Session state
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [selectedAnswer, setSelectedAnswer] = useState<string | null>(null);
  const [showFeedback, setShowFeedback] = useState(false);
  const [isCorrect, setIsCorrect] = useState(false);
  const [sessionStats, setSessionStats] = useState({
    attempted: 0,
    correct: 0,
    startTime: Date.now(),
  });
  const [showHint, setShowHint] = useState(false);
  const [comboStreak, setComboStreak] = useState(0);
  const [sessionCompleted, setSessionCompleted] = useState(false);

  // Fetch ALL skill data from API
  useEffect(() => {
    const fetchSkillData = async () => {
      try {
        setLoading(true);
        setError(null);
        
        console.log(`Fetching data for skill ID: ${skillId}`);
        
        // Fetch skill details
        const skillResponse = await fetch(`/api/skills/${skillId}`);
        if (!skillResponse.ok) {
          const errorText = await skillResponse.text();
          throw new Error(`Failed to fetch skill: ${skillResponse.status} ${skillResponse.statusText}. ${errorText}`);
        }
        const skillData = await skillResponse.json();
        console.log('Skill data:', skillData);

        // Fetch questions for this skill
        const questionsResponse = await fetch(`/api/skills/${skillId}/questions`);
        if (!questionsResponse.ok) {
          const errorText = await questionsResponse.text();
          throw new Error(`Failed to fetch questions: ${questionsResponse.status} ${questionsResponse.statusText}. ${errorText}`);
        }
        const questionsData = await questionsResponse.json();
        console.log('Questions data:', questionsData);

        // Fetch progress for this skill
        const progressResponse = await fetch(`/api/skills/${skillId}/progress`);
        let progressData = null;
        if (progressResponse.ok) {
          progressData = await progressResponse.json();
          console.log('Progress data:', progressData);
        } else {
          // Initialize default progress if none exists
          progressData = {
            smart_score: 0,
            questions_attempted: 0,
            questions_correct: 0,
            current_streak: 0,
            is_mastered: false,
          };
        }

        setSkill(skillData);
        setQuestions(questionsData);
        setProgress(progressData);
        
      } catch (err) {
        console.error("Error fetching skill data:", err);
        setError(err instanceof Error ? err.message : "Failed to load practice session");
      } finally {
        setLoading(false);
      }
    };

    if (skillId) {
      fetchSkillData();
    } else {
      setError("No skill ID provided");
      setLoading(false);
    }
  }, [skillId]);

  const handleLogout = async () => {
    await logout();
    navigate("/");
  };

  const handleAnswerSelect = (answer: string) => {
    if (showFeedback) return;
    setSelectedAnswer(answer);
  };

  const handleSubmit = async () => {
    if (!selectedAnswer || showFeedback || !skill) return;
    
    const currentQuestion = questions[currentQuestionIndex];
    const correct = selectedAnswer === currentQuestion.correct_answer;
    
    setIsCorrect(correct);
    setShowFeedback(true);

    // Update combo streak
    if (correct) {
      setComboStreak(comboStreak + 1);
    } else {
      setComboStreak(0);
    }

    // Update session stats
    const newStats = {
      attempted: sessionStats.attempted + 1,
      correct: sessionStats.correct + (correct ? 1 : 0),
      startTime: sessionStats.startTime,
    };
    setSessionStats(newStats);

    // Update progress state
    if (correct) {
      setProgress(prev => prev ? {
        ...prev,
        smart_score: Math.min(prev.smart_score + 5, 100),
        current_streak: prev.current_streak + 1,
        questions_correct: prev.questions_correct + 1,
        questions_attempted: prev.questions_attempted + 1,
        is_mastered: prev.smart_score + 5 >= (skill.mastery_threshold || 90)
      } : {
        smart_score: 5,
        current_streak: 1,
        questions_correct: 1,
        questions_attempted: 1,
        is_mastered: false
      });
    } else {
      setProgress(prev => prev ? {
        ...prev,
        smart_score: Math.max(prev.smart_score - 2, 0),
        current_streak: 0,
        questions_attempted: prev.questions_attempted + 1
      } : {
        smart_score: 0,
        current_streak: 0,
        questions_correct: 0,
        questions_attempted: 1,
        is_mastered: false
      });
    }
  };

  const handleNext = () => {
    if (currentQuestionIndex < questions.length - 1) {
      setCurrentQuestionIndex(currentQuestionIndex + 1);
      setSelectedAnswer(null);
      setShowFeedback(false);
      setIsCorrect(false);
      setShowHint(false);
    } else {
      // End session
      setSessionCompleted(true);
    }
  };

  const handleFinishSession = () => {
    navigate(-1);
  };

  const handleNewSession = () => {
    setCurrentQuestionIndex(0);
    setSelectedAnswer(null);
    setShowFeedback(false);
    setIsCorrect(false);
    setShowHint(false);
    setSessionCompleted(false);
    setComboStreak(0);
    setSessionStats({
      attempted: 0,
      correct: 0,
      startTime: Date.now(),
    });
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
        <Navigation onLogout={handleLogout} user={displayUser} />
        <main className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div className="bg-white rounded-2xl shadow-lg p-12 text-center border border-gray-100">
            <div className="animate-pulse space-y-4">
              <div className="h-8 bg-gray-200 rounded w-1/3 mx-auto"></div>
              <div className="h-4 bg-gray-200 rounded w-1/2 mx-auto"></div>
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
                {[...Array(4)].map((_, i) => (
                  <div key={i} className="h-20 bg-gray-200 rounded-xl"></div>
                ))}
              </div>
            </div>
          </div>
        </main>
      </div>
    );
  }

  if (error) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
        <Navigation onLogout={handleLogout} user={displayUser} />
        <main className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div className="bg-white rounded-2xl shadow-lg p-12 text-center border border-gray-100">
            <div className="w-20 h-20 bg-gradient-to-br from-orange-100 to-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <Target className="w-10 h-10 text-orange-600" />
            </div>
            <h2 className="text-2xl font-bold text-gray-900 mb-2">Practice Session Error</h2>
            <p className="text-gray-600 mb-4">{error}</p>
            <p className="text-sm text-gray-500 mb-6">Skill ID: {skillId}</p>
            <div className="flex gap-4 justify-center">
              <button
                onClick={() => navigate("/subjects")}
                className="px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105"
              >
                Back to Subjects
              </button>
              <button
                onClick={() => window.location.reload()}
                className="px-6 py-3 bg-gray-500 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105"
              >
                Try Again
              </button>
            </div>
          </div>
        </main>
      </div>
    );
  }

  if (!skill || questions.length === 0) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
        <Navigation onLogout={handleLogout} user={displayUser} />
        <main className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div className="bg-white rounded-2xl shadow-lg p-12 text-center border border-gray-100">
            <div className="w-20 h-20 bg-gradient-to-br from-orange-100 to-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <Target className="w-10 h-10 text-orange-600" />
            </div>
            <h2 className="text-2xl font-bold text-gray-900 mb-2">
              {!skill ? "Skill Not Found" : "No Questions Available"}
            </h2>
            <p className="text-gray-600 mb-6">
              {!skill 
                ? "The requested skill could not be found." 
                : "This skill doesn't have any practice questions yet."}
            </p>
            <p className="text-sm text-gray-500 mb-6">Skill ID: {skillId}</p>
            <button
              onClick={() => navigate("/subjects")}
              className="px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105"
            >
              Back to Subjects
            </button>
          </div>
        </main>
      </div>
    );
  }

  // Session completed view
  if (sessionCompleted) {
    const accuracy = sessionStats.attempted > 0 ? Math.round((sessionStats.correct / sessionStats.attempted) * 100) : 0;
    const timeSpent = Math.round((Date.now() - sessionStats.startTime) / 1000 / 60); // minutes
    
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
        <Navigation onLogout={handleLogout} user={displayUser} />
        <main className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          {/* Header */}
          <div className="mb-6">
            <button
              onClick={() => navigate(-1)}
              className="text-indigo-600 hover:text-indigo-700 font-medium mb-4"
            >
              â† Back to Learning
            </button>
            <h1 className="text-2xl font-bold text-gray-900">Practice Session Complete!</h1>
          </div>

          {/* Results Card */}
          <div className="bg-white rounded-2xl shadow-xl p-8 border border-gray-100 mb-6">
            <div className="text-center mb-8">
              <div className="w-20 h-20 bg-gradient-to-br from-green-100 to-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <Award className="w-10 h-10 text-green-600" />
              </div>
              <h2 className="text-3xl font-bold text-gray-900 mb-2">Great Job!</h2>
              <p className="text-gray-600">You completed the practice session for</p>
              <p className="text-lg font-semibold text-indigo-600">{skill.name}</p>
            </div>

            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
              <StatBox
                icon={Target}
                label="Session Accuracy"
                value={`${accuracy}%`}
                gradient="from-green-500 to-emerald-500"
              />
              <StatBox
                icon={CheckCircle2}
                label="Questions Correct"
                value={`${sessionStats.correct}/${sessionStats.attempted}`}
                gradient="from-blue-500 to-cyan-500"
              />
              <StatBox
                icon={Zap}
                label="Best Streak"
                value={comboStreak}
                gradient="from-orange-500 to-red-500"
              />
              <StatBox
                icon={Clock}
                label="Time Spent"
                value={`${timeSpent}m`}
                gradient="from-purple-500 to-pink-500"
              />
            </div>

            {/* Progress Update */}
            {progress && (
              <div className="bg-gray-50 rounded-xl p-6 mb-6">
                <h3 className="font-semibold text-gray-900 mb-3">Progress Update</h3>
                <div className="space-y-3">
                  <div className="flex justify-between items-center">
                    <span className="text-sm text-gray-600">SmartScore</span>
                    <span className="font-semibold text-indigo-600">{progress.smart_score}/100</span>
                  </div>
                  <div className="w-full bg-gray-200 rounded-full h-2">
                    <div 
                      className="bg-gradient-to-r from-indigo-500 to-purple-600 h-2 rounded-full transition-all duration-1000"
                      style={{ width: `${progress.smart_score}%` }}
                    ></div>
                  </div>
                  {progress.is_mastered && (
                    <div className="flex items-center gap-2 text-green-600 font-semibold">
                      <Award className="w-4 h-4" />
                      <span>Skill Mastered! ğŸ‰</span>
                    </div>
                  )}
                </div>
              </div>
            )}

            {/* Action Buttons */}
            <div className="flex gap-4 justify-center">
              <button
                onClick={handleNewSession}
                className="px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105 flex items-center gap-2"
              >
                <Zap className="w-5 h-5" />
                Practice Again
              </button>
              <button
                onClick={handleFinishSession}
                className="px-8 py-3 bg-gray-500 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105 flex items-center gap-2"
              >
                <Home className="w-5 h-5" />
                Finish Practice
              </button>
            </div>
          </div>
        </main>
      </div>
    );
  }

  const currentQuestion = questions[currentQuestionIndex];
  const questionData = currentQuestion.question_data ? JSON.parse(currentQuestion.question_data) : null;
  const options = questionData?.options || [];

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
      <Navigation onLogout={handleLogout} user={displayUser} />

      <main className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Header */}
        <div className="mb-6">
          <button
            onClick={() => navigate(-1)}
            className="text-indigo-600 hover:text-indigo-700 font-medium mb-4 flex items-center gap-2"
          >
            <ArrowRight className="w-4 h-4 rotate-180" />
            Exit Practice
          </button>
          
          {/* Skill Info */}
          <div className="flex items-start gap-4 mb-4">
            <div className="w-12 h-12 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0 bg-indigo-500">
              <BookOpen className="w-6 h-6 text-white" />
            </div>
            <div className="flex-1">
              <h1 className="text-2xl font-bold text-gray-900">{skill.name}</h1>
              {skill.description && (
                <p className="text-gray-500 text-sm mt-1">{skill.description}</p>
              )}
              <div className="flex items-center gap-4 mt-2 text-sm text-gray-600">
                <span>Difficulty: {"â˜…".repeat(skill.difficulty_level)}{"â˜†".repeat(5 - skill.difficulty_level)}</span>
                <span>Mastery: {skill.mastery_threshold}%</span>
              </div>
            </div>
          </div>
        </div>

        {/* Combo Streak Banner */}
        {comboStreak >= 3 && (
          <div className="mb-6 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-xl p-4 text-white shadow-lg animate-pulse">
            <div className="flex items-center justify-center gap-3">
              <Zap className="w-6 h-6" />
              <span className="text-lg font-bold">ğŸ”¥ {comboStreak}x Combo Streak!</span>
              <Zap className="w-6 h-6" />
            </div>
          </div>
        )}

        {/* Progress Stats */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
          <StatBox
            icon={Target}
            label="SmartScore"
            value={progress?.smart_score || 0}
            gradient="from-blue-500 to-cyan-500"
          />
          <StatBox
            icon={CheckCircle2}
            label="Session Accuracy"
            value={sessionStats.attempted > 0 ? `${Math.round((sessionStats.correct / sessionStats.attempted) * 100)}%` : "0%"}
            gradient="from-green-500 to-emerald-500"
          />
          <StatBox
            icon={TrendingUp}
            label="Streak"
            value={progress?.current_streak || 0}
            gradient="from-orange-500 to-red-500"
          />
          <StatBox
            icon={Award}
            label="Progress"
            value={`${currentQuestionIndex + 1}/${questions.length}`}
            gradient="from-purple-500 to-pink-500"
          />
        </div>

        {/* Question Card */}
        <div className="bg-white rounded-2xl shadow-xl p-8 border border-gray-100 mb-6">
          <div className="mb-6">
            <div className="flex items-center justify-between mb-4">
              <span className="text-sm font-medium text-gray-600">
                Question {currentQuestionIndex + 1} of {questions.length}
              </span>
              <div className="flex items-center gap-2">
                <span className="text-sm font-medium text-yellow-600">
                  {"â˜…".repeat(currentQuestion.difficulty_rating)}{"â˜†".repeat(5 - currentQuestion.difficulty_rating)}
                </span>
                <span className="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full">
                  {currentQuestion.points_value} XP
                </span>
              </div>
            </div>
            <h2 className="text-xl font-semibold text-gray-900 mb-6 leading-relaxed">
              {currentQuestion.question_text}
            </h2>
          </div>

          {/* Answer Options */}
          <div className="space-y-3 mb-6">
            {options.map((option: string, index: number) => {
              const isSelected = selectedAnswer === option;
              const isCorrectAnswer = option === currentQuestion.correct_answer;
              
              let buttonStyle = "bg-gray-50 hover:bg-gray-100 border-gray-200";
              if (showFeedback) {
                if (isCorrectAnswer) {
                  buttonStyle = "bg-green-50 border-green-500 ring-2 ring-green-200";
                } else if (isSelected && !isCorrect) {
                  buttonStyle = "bg-red-50 border-red-500 ring-2 ring-red-200";
                } else {
                  buttonStyle = "bg-gray-50 border-gray-200 opacity-50";
                }
              } else if (isSelected) {
                buttonStyle = "bg-indigo-50 border-indigo-500 ring-2 ring-indigo-200";
              }

              return (
                <button
                  key={index}
                  onClick={() => handleAnswerSelect(option)}
                  disabled={showFeedback}
                  className={`w-full p-4 rounded-xl border-2 text-left font-medium transition-all duration-200 ${buttonStyle} ${showFeedback ? "cursor-default" : "cursor-pointer hover:scale-[1.01]"}`}
                >
                  <div className="flex items-center gap-3">
                    <span className="flex-shrink-0 w-8 h-8 rounded-full bg-white border-2 border-gray-300 flex items-center justify-center text-sm font-bold">
                      {String.fromCharCode(65 + index)}
                    </span>
                    <span className="flex-1">{option}</span>
                    {showFeedback && isCorrectAnswer && (
                      <CheckCircle2 className="w-6 h-6 text-green-600" />
                    )}
                    {showFeedback && isSelected && !isCorrect && (
                      <XCircle className="w-6 h-6 text-red-600" />
                    )}
                  </div>
                </button>
              );
            })}
          </div>

          {/* Hint Button */}
          {!showFeedback && !showHint && (
            <button
              onClick={() => setShowHint(true)}
              className="mb-6 flex items-center gap-2 px-4 py-2 bg-indigo-50 text-indigo-700 rounded-lg hover:bg-indigo-100 transition-colors"
            >
              <Lightbulb className="w-4 h-4" />
              <span className="text-sm font-medium">Show Hint</span>
            </button>
          )}

          {/* Hint Display */}
          {showHint && !showFeedback && (
            <div className="p-4 rounded-xl mb-6 bg-blue-50 border border-blue-200">
              <div className="flex items-start gap-3">
                <Lightbulb className="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" />
                <div>
                  <p className="font-semibold mb-1 text-blue-900">Hint</p>
                  <p className="text-blue-800 text-sm">
                    Think about the key concepts related to this topic.
                    Eliminate obviously wrong answers first.
                  </p>
                </div>
              </div>
            </div>
          )}

          {/* Feedback */}
          {showFeedback && (
            <div className={`p-4 rounded-xl mb-6 ${isCorrect ? "bg-green-50 border border-green-200" : "bg-red-50 border border-red-200"}`}>
              <div className="flex items-start gap-3">
                {isCorrect ? (
                  <CheckCircle2 className="w-6 h-6 text-green-600 flex-shrink-0 mt-0.5" />
                ) : (
                  <XCircle className="w-6 h-6 text-red-600 flex-shrink-0 mt-0.5" />
                )}
                <div className="flex-1">
                  <p className={`font-semibold mb-2 ${isCorrect ? "text-green-900" : "text-red-900"}`}>
                    {isCorrect ? "Correct! ğŸ‰" : "Not quite right"}
                    {isCorrect && comboStreak >= 2 && ` â€¢ ${comboStreak}x streak!`}
                  </p>
                  <p className="text-gray-700 text-sm">{currentQuestion.explanation}</p>
                </div>
                {isCorrect && (
                  <div className="text-right">
                    <div className="flex items-center gap-1 text-orange-600">
                      <Zap className="w-4 h-4" />
                      <span className="font-bold">+{currentQuestion.points_value} XP</span>
                    </div>
                  </div>
                )}
              </div>
            </div>
          )}

          {/* Action Button */}
          <div className="flex justify-end">
            {!showFeedback ? (
              <button
                onClick={handleSubmit}
                disabled={!selectedAnswer}
                className="px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center gap-2"
              >
                Submit Answer
                <ArrowRight className="w-5 h-5" />
              </button>
            ) : (
              <button
                onClick={handleNext}
                className="px-8 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105 flex items-center gap-2"
              >
                {currentQuestionIndex < questions.length - 1 ? "Next Question" : "Finish Practice"}
                <ArrowRight className="w-5 h-5" />
              </button>
            )}
          </div>
        </div>
      </main>
    </div>
  );
}

function StatBox({
  icon: Icon,
  label,
  value,
  gradient,
}: {
  icon: any;
  label: string;
  value: string | number;
  gradient: string;
}) {
  return (
    <div className="bg-white rounded-xl shadow-lg p-4 border border-gray-100">
      <div className="flex items-center gap-3">
        <div className={`w-10 h-10 bg-gradient-to-r ${gradient} rounded-lg flex items-center justify-center shadow-md flex-shrink-0`}>
          <Icon className="w-5 h-5 text-white" />
        </div>
        <div className="min-w-0">
          <p className="text-xs text-gray-600 mb-0.5 truncate">{label}</p>
          <p className="text-lg font-bold text-gray-900 truncate">{value}</p>
        </div>
      </div>
    </div>
  );
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\pages\SubjectDetail.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { useEffect, useState } from "react";
import { useNavigate, useParams } from "react-router";
import { useAuth } from "@getmocha/users-service/react";
import { BookOpen, Target, ChevronRight, Puzzle, Zap, TrendingUp, Clock, Award, Play } from "lucide-react";
import Navigation from "@/react-app/components/Navigation";
import type { MochaUser } from "@getmocha/users-service/shared";

// --- TYPES ---
interface Subject {
  id: number;
  name: string;
  code: string;
  nated_level: string;
  description: string;
  color_hex: string;
  modules?: Module[];
}

interface Module {
  id: number;
  subject_id: number;
  name: string;
  description: string;
  display_order: number;
  topics?: Topic[];
}

interface Topic {
  id: number;
  module_id: number;
  name: string;
  description: string;
  display_order: number;
  skills?: Skill[];
}

interface Skill {
  id: number;
  topic_id: number;
  name: string;
  description: string;
  difficulty_level: number;
  display_order: number;
  mastery_threshold: number;
  smart_score?: number;
  is_mastered?: boolean;
  questions_attempted?: number;
  questions_correct?: number;
}

// --- MOCK USER (fallback) ---
const MOCK_USER: MochaUser = {
  id: "dev-user",
  email: "sibusiso@example.com",
  google_sub: "dev-google-sub",
  last_signed_in_at: new Date().toISOString(),
  created_at: new Date().toISOString(),
  updated_at: new Date().toISOString(),
  google_user_data: {
    given_name: "Sibusiso King-Junior",
    name: "Sibusiso King-Junior Nkosi",
    picture: null,
    email: "sibusiso@example.com",
    email_verified: true,
    sub: "dev-google-sub"
  }
};

export default function SubjectDetail() {
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  const { id } = useParams();
  
  const displayUser = user || MOCK_USER;
  const subjectId = parseInt(id || '0');

  const [subject, setSubject] = useState<Subject | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // Fetch subject data from API
  useEffect(() => {
    const fetchSubjectData = async () => {
      try {
        setLoading(true);
        const response = await fetch(`/api/subjects/${subjectId}`);
        
        if (!response.ok) {
          throw new Error(`Failed to fetch subject: ${response.statusText}`);
        }
        
        const subjectData = await response.json();
        setSubject(subjectData);
      } catch (err) {
        console.error("Error fetching subject:", err);
        setError(err instanceof Error ? err.message : "Failed to load subject");
      } finally {
        setLoading(false);
      }
    };

    if (subjectId) {
      fetchSubjectData();
    }
  }, [subjectId]);

  // Calculate overall stats
  const calculateStats = () => {
    if (!subject?.modules) return { totalTopics: 0, totalSkills: 0, overallSmartScore: 0, masteredSkills: 0, totalPracticeTime: 0 };

    let totalTopics = 0;
    let totalSkills = 0;
    let totalSmartScore = 0;
    let skillsWithProgress = 0;
    let masteredSkills = 0;
    let totalPracticeTime = 0;

    subject.modules.forEach(module => {
      module.topics?.forEach(topic => {
        totalTopics++;
        topic.skills?.forEach(skill => {
          totalSkills++;
          if (skill.smart_score !== undefined) {
            totalSmartScore += skill.smart_score;
            skillsWithProgress++;
            if (skill.is_mastered) {
              masteredSkills++;
            }
            // Estimate practice time (2 minutes per question attempted)
            totalPracticeTime += (skill.questions_attempted || 0) * 2;
          }
        });
      });
    });

    const overallSmartScore = skillsWithProgress > 0 ? Math.round(totalSmartScore / skillsWithProgress) : 0;

    return {
      totalTopics,
      totalSkills,
      overallSmartScore,
      masteredSkills,
      totalPracticeTime: Math.round(totalPracticeTime / 60) // Convert to minutes
    };
  };

  const stats = calculateStats();

  const handleLogout = async () => {
    await logout();
    navigate("/");
  };

  // Function to handle skill practice navigation
  const handlePracticeSkill = (skillId: number, skillName: string) => {
    navigate(`/skills/${skillId}/practice`, { 
      state: { skillName, subjectName: subject?.name }
    });
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
        <Navigation onLogout={handleLogout} user={displayUser} />
        <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div className="bg-white rounded-2xl shadow-lg p-12 text-center border border-gray-100">
            <div className="animate-pulse space-y-4">
              <div className="h-8 bg-gray-200 rounded w-1/3 mx-auto"></div>
              <div className="h-4 bg-gray-200 rounded w-1/2 mx-auto"></div>
              <div className="h-4 bg-gray-200 rounded w-2/3 mx-auto"></div>
            </div>
          </div>
        </main>
      </div>
    );
  }

  if (error || !subject) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
        <Navigation onLogout={handleLogout} user={displayUser} />
        <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div className="bg-white rounded-2xl shadow-lg p-12 text-center border border-gray-100">
            <h2 className="text-2xl font-bold text-gray-900 mb-2">
              {error ? "Error Loading Subject" : "Subject Not Found"}
            </h2>
            <p className="text-gray-600 mb-6">
              {error || "The requested subject could not be loaded."}
            </p>
            <button
              onClick={() => navigate("/subjects")}
              className="px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105"
            >
              Go to Subjects List
            </button>
          </div>
        </main>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
      <Navigation onLogout={handleLogout} user={displayUser} />

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Header */}
        <div className="mb-8 p-6 rounded-2xl shadow-xl bg-white border border-gray-100">
          <button
            onClick={() => navigate("/subjects")}
            className="text-indigo-600 hover:text-indigo-700 font-medium mb-4 flex items-center gap-2 transition-colors duration-200"
          >
            <ChevronRight className="w-5 h-5 rotate-180" /> Back to Subjects
          </button>
          <div className="flex items-start justify-between">
            <div className="flex-1">
              <h1 className="text-3xl font-bold text-gray-900 mb-2">{subject.name}</h1>
              <p className="text-lg font-medium text-indigo-600 mb-4">
                {subject.code} â€¢ Level {subject.nated_level}
              </p>
              <p className="text-gray-700 max-w-3xl leading-relaxed">{subject.description}</p>
            </div>
            <div 
              className="w-20 h-20 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0 ml-6"
              style={{ 
                backgroundColor: subject.color_hex || '#3B82F6'
              }}
            >
              <BookOpen className="w-10 h-10 text-white" />
            </div>
          </div>
        </div>

        {/* Main Content */}
        <div className="grid lg:grid-cols-3 gap-8">
          {/* Modules Section */}
          <div className="lg:col-span-2">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-2xl font-bold text-gray-900">
                Curriculum Modules ({subject.modules?.length || 0})
              </h2>
              <div className="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                {stats.totalSkills} skills across {stats.totalTopics} topics
              </div>
            </div>
            
            <div className="space-y-6">
              {subject.modules?.map(module => (
                <ModuleCard 
                  key={module.id} 
                  module={module} 
                  onPracticeSkill={handlePracticeSkill}
                />
              ))}
            </div>
            
            {(!subject.modules || subject.modules.length === 0) && (
              <div className="p-8 bg-white rounded-xl text-center shadow-lg border border-gray-100">
                <BookOpen className="w-12 h-12 text-gray-400 mx-auto mb-4" />
                <p className="text-gray-600">No modules are currently available for this subject.</p>
                <p className="text-sm text-gray-500 mt-2">Check back later for updates</p>
              </div>
            )}
          </div>

          {/* Sidebar / Subject Stats */}
          <div className="lg:col-span-1">
            <h2 className="text-2xl font-bold text-gray-900 mb-6">Learning Progress</h2>
            <div className="bg-white rounded-2xl shadow-lg p-6 border border-gray-100 space-y-4 sticky top-8">
              <StatItem 
                icon={Puzzle} 
                label="Total Modules" 
                value={subject.modules?.length || 0} 
                color="text-indigo-600" 
              />
              <StatItem 
                icon={Target} 
                label="Learning Topics" 
                value={stats.totalTopics} 
                color="text-cyan-600" 
              />
              <StatItem 
                icon={TrendingUp} 
                label="Practice Skills" 
                value={stats.totalSkills} 
                color="text-orange-600" 
              />
              <StatItem 
                icon={Award} 
                label="Mastered Skills" 
                value={stats.masteredSkills} 
                suffix={`/ ${stats.totalSkills}`}
                color="text-green-600" 
              />
              <StatItem 
                icon={Zap} 
                label="Overall SmartScore" 
                value={stats.overallSmartScore} 
                suffix="/100" 
                color="text-purple-600" 
              />
              <StatItem 
                icon={Clock} 
                label="Practice Time" 
                value={stats.totalPracticeTime} 
                suffix="minutes" 
                color="text-blue-600" 
              />
              
              {/* Progress Overview */}
              <div className="pt-4 border-t border-gray-100">
                <div className="flex justify-between text-sm text-gray-600 mb-2">
                  <span>Overall Progress</span>
                  <span>{Math.round((stats.masteredSkills / stats.totalSkills) * 100) || 0}%</span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div 
                    className="bg-gradient-to-r from-green-500 to-emerald-600 h-2 rounded-full transition-all duration-500"
                    style={{ width: `${(stats.masteredSkills / stats.totalSkills) * 100 || 0}%` }}
                  ></div>
                </div>
              </div>

              {/* Quick Practice Button */}
              {stats.totalSkills > 0 && (
                <button
                  onClick={() => {
                    // Find first available skill to practice
                    const firstSkill = subject.modules
                      ?.flatMap(m => m.topics || [])
                      .flatMap(t => t.skills || [])
                      .find(s => s.id);
                    
                    if (firstSkill) {
                      handlePracticeSkill(firstSkill.id, firstSkill.name);
                    }
                  }}
                  className="w-full mt-4 px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105 flex items-center justify-center gap-2"
                >
                  <Play className="w-5 h-5" />
                  Start Quick Practice
                </button>
              )}
            </div>
          </div>
        </div>
      </main>
    </div>
  );
}

function ModuleCard({ module, onPracticeSkill }: { module: Module; onPracticeSkill: (skillId: number, skillName: string) => void }) {
  const allSkills = module.topics?.flatMap(topic => topic.skills || []) || [];
  const masteredSkills = allSkills.filter(skill => skill.is_mastered).length;
  const avgSmartScore = allSkills.length > 0 
    ? Math.round(allSkills.reduce((sum, skill) => sum + (skill.smart_score || 0), 0) / allSkills.length)
    : 0;

  return (
    <div className="bg-white rounded-xl shadow-lg p-6 border border-gray-100 transition-all duration-300 hover:shadow-xl">
      <div className="flex justify-between items-start mb-6">
        <div className="flex-1">
          <div className="flex items-center gap-3 mb-2">
            <h3 className="text-xl font-bold text-gray-900">{module.name}</h3>
            <span className="text-xs font-medium bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full">
              Module {module.display_order}
            </span>
          </div>
          <p className="text-gray-600 leading-relaxed">{module.description}</p>
        </div>
        <div className="text-right ml-4">
          <div className="text-2xl font-bold text-indigo-600">{avgSmartScore}</div>
          <div className="text-xs text-gray-500 uppercase tracking-wider">Avg Score</div>
          <div className="text-sm text-green-600 font-medium mt-1">
            {masteredSkills}/{allSkills.length} mastered
          </div>
        </div>
      </div>

      <div className="border-t border-gray-100 pt-6">
        <div className="mb-4">
          <h4 className="text-sm font-semibold text-gray-700 uppercase tracking-wide mb-3">
            Learning Topics ({module.topics?.length || 0})
          </h4>
        </div>
        
        <div className="space-y-4">
          {module.topics?.map(topic => (
            <TopicSection 
              key={topic.id} 
              topic={topic} 
              onPracticeSkill={onPracticeSkill}
            />
          ))}
        </div>
        
        {(!module.topics || module.topics.length === 0) && (
          <div className="text-center py-6">
            <div className="text-gray-400 text-sm">
              No topics available for this module yet
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

function TopicSection({ topic, onPracticeSkill }: { topic: Topic; onPracticeSkill: (skillId: number, skillName: string) => void }) {
  const skills = topic.skills || [];
  const topicAvgScore = skills.length > 0 
    ? Math.round(skills.reduce((sum, skill) => sum + (skill.smart_score || 0), 0) / skills.length)
    : 0;
  const masteredSkills = skills.filter(skill => skill.is_mastered).length;

  return (
    <div className="bg-gray-50 rounded-lg p-4 border border-gray-200 transition-all duration-200 hover:border-gray-300">
      <div className="flex justify-between items-start mb-3">
        <div className="flex-1">
          <h4 className="font-semibold text-gray-900 text-lg mb-1">{topic.name}</h4>
          <p className="text-xs text-gray-600">{topic.description}</p>
        </div>
        <div className="text-right ml-4">
          <div className="text-lg font-bold text-indigo-600">{topicAvgScore}</div>
          <div className="text-xs text-gray-500">Avg Score</div>
          <div className="text-xs text-green-600 font-medium mt-1">
            {masteredSkills}/{skills.length} mastered
          </div>
        </div>
      </div>

      <div className="space-y-2 mb-4">
        {skills.map(skill => (
          <div 
            key={skill.id} 
            className={`flex items-center justify-between text-sm p-3 rounded-md border transition-all duration-200 cursor-pointer hover:shadow-sm ${
              skill.is_mastered 
                ? 'bg-green-50 border-green-200' 
                : 'bg-white border-gray-200'
            }`}
            onClick={() => onPracticeSkill(skill.id, skill.name)}
          >
            <div className="flex items-center gap-3 flex-1">
              <div className={`p-2 rounded-lg ${skill.is_mastered ? 'bg-green-100' : 'bg-indigo-100'}`}>
                <Play className={`w-3 h-3 ${skill.is_mastered ? 'text-green-600' : 'text-indigo-600'}`} />
              </div>
              <div className="flex-1">
                <span className="font-medium text-gray-800">{skill.name}</span>
                {skill.description && (
                  <p className="text-xs text-gray-600 mt-1">{skill.description}</p>
                )}
              </div>
              {skill.is_mastered && (
                <Award className="w-4 h-4 text-green-500" />
              )}
            </div>
            <div className="flex items-center gap-3 ml-4">
              <span className="text-xs text-yellow-600">
                {"â˜…".repeat(skill.difficulty_level)}{"â˜†".repeat(5 - skill.difficulty_level)}
              </span>
              <span className={`font-bold text-sm ${
                skill.smart_score && skill.smart_score >= 80 ? 'text-green-600' : 
                skill.smart_score && skill.smart_score >= 60 ? 'text-yellow-600' : 'text-red-600'
              }`}>
                {skill.smart_score || 0}
              </span>
            </div>
          </div>
        ))}
      </div>

      {skills.length === 0 && (
        <div className="text-center py-4">
          <div className="text-gray-400 text-sm">
            No skills available for this topic
          </div>
        </div>
      )}

      {/* Practice All Button */}
      {skills.length > 0 && (
        <button
          onClick={() => {
            const firstSkill = skills[0];
            if (firstSkill) {
              onPracticeSkill(firstSkill.id, `${topic.name} - ${firstSkill.name}`);
            }
          }}
          className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white text-sm font-semibold rounded-lg shadow-md hover:shadow-lg transition-all duration-200 hover:scale-[1.02]"
        >
          <Play className="w-4 h-4" /> 
          Practice {topic.name}
        </button>
      )}
    </div>
  );
}

function StatItem({ icon: Icon, label, value, suffix, color }: { 
  icon: any; 
  label: string; 
  value: string | number; 
  suffix?: string; 
  color: string; 
}) {
  return (
    <div className="flex items-center justify-between p-4 border border-gray-100 rounded-lg bg-white transition-all duration-200 hover:shadow-sm">
      <div className="flex items-center gap-3">
        <div className={`p-2 rounded-lg ${color.replace('text', 'bg')} bg-opacity-10`}>
          <Icon className={`w-5 h-5 ${color}`} />
        </div>
        <span className="text-sm font-medium text-gray-700">{label}</span>
      </div>
      <span className="text-lg font-bold text-gray-900">
        {value}
        {suffix && <span className="text-sm font-normal text-gray-500 ml-1">{suffix}</span>}
      </span>
    </div>
  );
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\react-app\pages\Subjects.tsx
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { useEffect, useState } from "react";
import { useNavigate } from "react-router";
import { useAuth } from "@getmocha/users-service/react";
import { BookOpen, ChevronRight, Search, Loader2, AlertCircle } from "lucide-react";
import Navigation from "@/react-app/components/Navigation";
import type { Subject } from "@/shared/types";
import type { MochaUser } from "@getmocha/users-service/shared";

const MOCK_USER: MochaUser = {
  id: "dev-user",
  email: "dev@example.com",
  google_sub: "dev-google-sub",
  last_signed_in_at: new Date().toISOString(),
  created_at: new Date().toISOString(),
  updated_at: new Date().toISOString(),
  google_user_data: {
    given_name: "Developer",
    name: "Developer User",
    picture: null,
    email: "dev@example.com",
    email_verified: true,
    sub: "dev-google-sub"
  }
};

export default function Subjects() {
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  const displayUser = user || MOCK_USER;

  const [subjects, setSubjects] = useState<Subject[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState("");
  const [selectedLevel, setSelectedLevel] = useState<string>("");
  const [error, setError] = useState<string | null>(null);

  // Fetch subjects from API
  useEffect(() => {
    const fetchSubjects = async () => {
      try {
        setError(null);
        setLoading(true);
        
        const params = new URLSearchParams();
        if (searchQuery) params.append("search", searchQuery);
        if (selectedLevel) params.append("level", selectedLevel);
        
        const response = await fetch(`/api/subjects?${params.toString()}`);
        
        if (!response.ok) {
          throw new Error(`Failed to fetch subjects: ${response.status}`);
        }
        
        const data = await response.json();
        setSubjects(data);
      } catch (error) {
        console.error("Failed to fetch subjects:", error);
        setError(error instanceof Error ? error.message : "Failed to load subjects");
        setSubjects([]);
      } finally {
        setLoading(false);
      }
    };

    const timeoutId = setTimeout(fetchSubjects, 300);
    return () => clearTimeout(timeoutId);
  }, [searchQuery, selectedLevel]);

  const handleLogout = async () => {
    await logout();
    navigate("/");
  };

  // Group subjects by level
  const subjectsByLevel = subjects.reduce((acc, subject) => {
    const level = subject.nated_level;
    if (!acc[level]) {
      acc[level] = [];
    }
    acc[level].push(subject);
    return acc;
  }, {} as Record<string, Subject[]>);

  const levels = ["N3", "N4", "N5", "N6"];

  if (loading) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
        <Navigation onLogout={handleLogout} user={displayUser} />
        <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
          <div className="flex items-center justify-center min-h-[60vh]">
            <div className="flex flex-col items-center gap-4">
              <Loader2 className="w-12 h-12 text-indigo-600 animate-spin" />
              <p className="text-gray-600 font-medium">Loading subjects...</p>
            </div>
          </div>
        </main>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50">
      <Navigation onLogout={handleLogout} user={displayUser} />

      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-gray-900 mb-2">Browse Subjects</h1>
          <p className="text-gray-600">Select a subject to start learning</p>
        </div>

        {/* Error Message */}
        {error && (
          <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-xl flex items-start gap-3">
            <AlertCircle className="w-5 h-5 text-red-600 flex-shrink-0 mt-0.5" />
            <div className="flex-1">
              <p className="text-red-800 font-medium">{error}</p>
              <button
                onClick={() => window.location.reload()}
                className="mt-2 text-sm text-red-600 hover:text-red-700 underline"
              >
                Try again
              </button>
            </div>
          </div>
        )}

        {/* Search and Filter Controls */}
        <div className="mb-8 space-y-4">
          {/* Search Bar */}
          <div className="relative">
            <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
              <Search className="w-5 h-5 text-gray-400" />
            </div>
            <input
              type="text"
              placeholder="Search subjects..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent shadow-sm"
            />
          </div>

          {/* Level Filters */}
          <div className="flex flex-wrap gap-2">
            <button
              onClick={() => setSelectedLevel("")}
              className={`px-4 py-2 rounded-lg font-medium transition-all duration-200 ${
                selectedLevel === ""
                  ? "bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-md"
                  : "bg-white text-gray-700 hover:bg-gray-100 border border-gray-200"
              }`}
            >
              All Levels
            </button>
            {levels.map((level) => (
              <button
                key={level}
                onClick={() => setSelectedLevel(level)}
                className={`px-4 py-2 rounded-lg font-medium transition-all duration-200 ${
                  selectedLevel === level
                    ? "bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-md"
                    : "bg-white text-gray-700 hover:bg-gray-100 border border-gray-200"
                }`}
              >
                {level}
              </button>
            ))}
          </div>
        </div>

        {subjects.length === 0 ? (
          <div className="bg-white rounded-2xl shadow-lg p-12 text-center border border-gray-100">
            <div className="w-20 h-20 bg-gradient-to-br from-indigo-100 to-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <BookOpen className="w-10 h-10 text-indigo-600" />
            </div>
            <h3 className="text-xl font-semibold text-gray-900 mb-2">No subjects found</h3>
            <p className="text-gray-600 mb-4">
              {searchQuery || selectedLevel
                ? "Try adjusting your search or filters"
                : "No subjects available in the database yet"}
            </p>
            {(searchQuery || selectedLevel) && (
              <button
                onClick={() => {
                  setSearchQuery("");
                  setSelectedLevel("");
                }}
                className="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"
              >
                Clear Filters
              </button>
            )}
          </div>
        ) : selectedLevel ? (
          // Filtered view - show as grid
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {subjects.map((subject) => (
              <SubjectCard 
                key={subject.id} 
                subject={subject} 
                onClick={() => navigate(`/subjects/${subject.id}`)} 
              />
            ))}
          </div>
        ) : (
          // Grouped by level view
          <div className="space-y-12">
            {levels.map((level) => {
              const levelSubjects = subjectsByLevel[level] || [];
              if (levelSubjects.length === 0) return null;

              return (
                <div key={level}>
                  <div className="flex items-center gap-3 mb-6">
                    <div className="flex items-center justify-center w-12 h-12 bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl shadow-lg">
                      <span className="text-white font-bold text-lg">{level}</span>
                    </div>
                    <div>
                      <h2 className="text-2xl font-bold text-gray-900">Level {level}</h2>
                      <p className="text-gray-600">{levelSubjects.length} {levelSubjects.length === 1 ? 'subject' : 'subjects'}</p>
                    </div>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {levelSubjects.map((subject) => (
                      <SubjectCard 
                        key={subject.id} 
                        subject={subject} 
                        onClick={() => navigate(`/subjects/${subject.id}`)} 
                      />
                    ))}
                  </div>
                </div>
              );
            })}
          </div>
        )}
      </main>
    </div>
  );
}

function SubjectCard({ subject, onClick }: { subject: Subject; onClick: () => void }) {
  const colorClass = subject.color_hex || "from-indigo-500 to-purple-500";
  
  return (
    <button
      onClick={onClick}
      className="group bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 p-8 border border-gray-100 text-left hover:scale-105"
    >
      <div className={`w-16 h-16 bg-gradient-to-r ${colorClass} rounded-xl flex items-center justify-center mb-4 shadow-lg group-hover:shadow-xl transition-shadow`}>
        <BookOpen className="w-8 h-8 text-white" />
      </div>
      <h3 className="text-xl font-bold text-gray-900 mb-2">{subject.name}</h3>
      <p className="text-sm text-gray-600 mb-1">{subject.code}</p>
      <p className="text-sm font-medium text-indigo-600 mb-4">Level: {subject.nated_level}</p>
      {subject.description && (
        <p className="text-gray-600 text-sm mb-4 line-clamp-2">{subject.description}</p>
      )}
      <div className="flex items-center gap-2 text-indigo-600 font-medium group-hover:gap-3 transition-all">
        <span>Explore</span>
        <ChevronRight className="w-5 h-5" />
      </div>
    </button>
  );
}


============================================================
DIRECTORY: src\shared
============================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\shared\types.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import type { MochaUser } from "@getmocha/users-service/shared";

// Extended user type with profile
export interface ExtendedUser extends MochaUser {
  profile: UserProfile;
}

export interface UserProfile {
  id: number;
  user_id: string;
  role: "student" | "teacher" | "admin" | "institution_admin";
  institution_id: number | null;
  grade_level: string | null;
  created_at: string;
  updated_at: string;
}

export interface Subject {
  id: number;
  name: string;
  code: string;
  nated_level: string;
  description: string | null;
  icon_url: string | null;
  color_hex: string | null;
  display_order: number;
  is_active: number;
  created_at: string;
  updated_at: string;
}

export interface Module {
  id: number;
  subject_id: number;
  name: string;
  description: string | null;
  display_order: number;
  is_active: number;
  created_at: string;
  updated_at: string;
}

export interface Topic {
  id: number;
  module_id: number;
  name: string;
  description: string | null;
  display_order: number;
  is_active: number;
  created_at: string;
  updated_at: string;
  skills?: Skill[];
}

export interface Skill {
  id: number;
  topic_id: number;
  name: string;
  description: string | null;
  difficulty_level: number;
  display_order: number;
  mastery_threshold: number;
  is_active: number;
  created_at: string;
  updated_at: string;
}

export interface SkillProgress {
  id: number;
  user_id: string;
  skill_id: number;
  smart_score: number;
  questions_attempted: number;
  questions_correct: number;
  current_streak: number;
  best_streak: number;
  time_spent_seconds: number;
  is_mastered: number;
  mastered_at: string | null;
  last_practiced_at: string | null;
  created_at: string;
  updated_at: string;
}



============================================================
DIRECTORY: src\worker
============================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\worker\env.d.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export interface Env {
  DB: D1Database;
  R2_BUCKET: R2Bucket;
  MOCHA_USERS_SERVICE_API_URL: string;
  MOCHA_USERS_SERVICE_API_KEY: string;
}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\worker\index.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

import { Hono } from "hono";
import { cors } from "hono/cors";
import {
  exchangeCodeForSessionToken,
  getOAuthRedirectUrl,
  authMiddleware,
  deleteSession,
  MOCHA_SESSION_TOKEN_COOKIE_NAME,
} from "@getmocha/users-service/backend";
import { getCookie, setCookie } from "hono/cookie";

const app = new Hono<{ Bindings: Env }>();

// Add CORS for local development
app.use("/*", cors());

// ============================================================
// AUTHENTICATION ENDPOINTS
// ============================================================

app.get("/api/oauth/google/redirect_url", async (c) => {
  const redirectUrl = await getOAuthRedirectUrl("google", {
    apiUrl: c.env.MOCHA_USERS_SERVICE_API_URL,
    apiKey: c.env.MOCHA_USERS_SERVICE_API_KEY,
  });
  return c.json({ redirectUrl }, 200);
});

app.post("/api/sessions", async (c) => {
  const body = await c.req.json();
  if (!body.code) {
    return c.json({ error: "No authorization code provided" }, 400);
  }

  const sessionToken = await exchangeCodeForSessionToken(body.code, {
    apiUrl: c.env.MOCHA_USERS_SERVICE_API_URL,
    apiKey: c.env.MOCHA_USERS_SERVICE_API_KEY,
  });

  setCookie(c, MOCHA_SESSION_TOKEN_COOKIE_NAME, sessionToken, {
    httpOnly: true,
    path: "/",
    sameSite: "none",
    secure: true,
    maxAge: 60 * 24 * 60 * 60,
  });

  return c.json({ success: true }, 200);
});

app.get("/api/users/me", authMiddleware, async (c) => {
  const user = c.get("user");
  if (!user) {
    return c.json({ error: "Unauthorized" }, 401);
  }

  try {
    const profile = await c.env.DB.prepare(
      "SELECT * FROM user_profiles WHERE user_id = ?"
    ).bind(user.id).first();

    if (!profile) {
      await c.env.DB.prepare(
        "INSERT INTO user_profiles (user_id, role) VALUES (?, ?)"
      ).bind(user.id, "student").run();

      const newProfile = await c.env.DB.prepare(
        "SELECT * FROM user_profiles WHERE user_id = ?"
      ).bind(user.id).first();

      return c.json({ ...user, profile: newProfile });
    }

    return c.json({ ...user, profile });
  } catch (error) {
    console.error("Error fetching user:", error);
    return c.json({ error: "Failed to fetch user" }, 500);
  }
});

app.get("/api/logout", async (c) => {
  const sessionToken = getCookie(c, MOCHA_SESSION_TOKEN_COOKIE_NAME);

  if (typeof sessionToken === "string") {
    await deleteSession(sessionToken, {
      apiUrl: c.env.MOCHA_USERS_SERVICE_API_URL,
      apiKey: c.env.MOCHA_USERS_SERVICE_API_KEY,
    });
  }

  setCookie(c, MOCHA_SESSION_TOKEN_COOKIE_NAME, "", {
    httpOnly: true,
    path: "/",
    sameSite: "none",
    secure: true,
    maxAge: 0,
  });

  return c.json({ success: true }, 200);
});

// ============================================================
// DASHBOARD ENDPOINTS (NO AUTH FOR DEV)
// ============================================================

app.get("/api/dashboard/stats", async (c) => {
  try {
    const userId = "dev-user"; // Hardcoded for development

    // Count skills with any progress (not mastered)
    const skillsPracticingResult = await c.env.DB.prepare(
      "SELECT COUNT(*) as count FROM skill_progress WHERE user_id = ? AND is_mastered = 0"
    ).bind(userId).first();

    const skillsPracticing = (skillsPracticingResult as any)?.count || 0;

    // Count mastered skills
    const skillsMasteredResult = await c.env.DB.prepare(
      "SELECT COUNT(*) as count FROM skill_progress WHERE user_id = ? AND is_mastered = 1"
    ).bind(userId).first();

    const skillsMastered = (skillsMasteredResult as any)?.count || 0;

    // Get max current streak
    const streakResult = await c.env.DB.prepare(
      "SELECT COALESCE(MAX(current_streak), 0) as max_streak FROM skill_progress WHERE user_id = ?"
    ).bind(userId).first();

    const currentStreak = (streakResult as any)?.max_streak || 0;

    // Count achievements
    const badgesResult = await c.env.DB.prepare(
      "SELECT COUNT(*) as count FROM user_achievements WHERE user_id = ?"
    ).bind(userId).first();

    const totalBadges = (badgesResult as any)?.count || 0;

    return c.json({
      skills_practicing: skillsPracticing,
      skills_mastered: skillsMastered,
      current_streak: currentStreak,
      total_badges: totalBadges,
    });

  } catch (error) {
    console.error("Dashboard stats error:", error);
    return c.json({ 
      error: "Failed to fetch dashboard stats",
      details: error instanceof Error ? error.message : String(error)
    }, 500);
  }
});

app.get("/api/dashboard/recent-skills", async (c) => {
  try {
    const userId = "dev-user"; // Hardcoded for development

    const { results } = await c.env.DB.prepare(
      `SELECT 
        sp.skill_id as id,
        s.name,
        sp.smart_score,
        sp.last_practiced_at,
        sub.name as subject_name,
        COALESCE(sub.color_hex, 'from-indigo-500 to-purple-500') as subject_color,
        sub.id as subject_id
       FROM skill_progress sp
       JOIN skills s ON sp.skill_id = s.id
       JOIN topics t ON s.topic_id = t.id
       JOIN modules m ON t.module_id = m.id
       JOIN subjects sub ON m.subject_id = sub.id
       WHERE sp.user_id = ?
       ORDER BY sp.last_practiced_at DESC
       LIMIT 5`
    ).bind(userId).all();

    return c.json(results || []);

  } catch (error) {
    console.error("Recent skills error:", error);
    return c.json({ 
      error: "Failed to fetch recent skills",
      details: error instanceof Error ? error.message : String(error)
    }, 500);
  }
});

// ============================================================
// DAILY CHALLENGES
// ============================================================

app.get("/api/daily-challenges/today", async (c) => {
  try {
    const userId = "dev-user"; // Hardcoded for development
    const today = new Date().toISOString().split('T')[0];
    
    const challenge = await c.env.DB.prepare(
      `SELECT 
        dc.id,
        dc.skill_id,
        s.name as skill_name,
        dc.target_questions,
        dc.target_accuracy,
        dc.xp_reward,
        COALESCE(udc.questions_completed, 0) as questions_completed,
        COALESCE(udc.questions_correct, 0) as questions_correct,
        COALESCE(udc.is_completed, 0) as is_completed,
        udc.completed_at
       FROM daily_challenges dc
       JOIN skills s ON dc.skill_id = s.id
       LEFT JOIN user_daily_challenges udc ON dc.id = udc.challenge_id AND udc.user_id = ?
       WHERE dc.challenge_date = ?`
    ).bind(userId, today).first();

    return c.json(challenge || null);

  } catch (error) {
    console.error("Daily challenge error:", error);
    return c.json({ 
      error: "Failed to fetch daily challenge",
      details: error instanceof Error ? error.message : String(error)
    }, 500);
  }
});

// ============================================================
// SUBJECTS ENDPOINTS
// ============================================================

app.get("/api/subjects", async (c) => {
  try {
    const search = c.req.query("search") || "";
    const level = c.req.query("level") || "";

    let query = "SELECT * FROM subjects WHERE is_active = 1";
    const params: any[] = [];

    if (search) {
      query += " AND (name LIKE ? OR code LIKE ? OR description LIKE ?)";
      const searchParam = `%${search}%`;
      params.push(searchParam, searchParam, searchParam);
    }

    if (level) {
      query += " AND nated_level = ?";
      params.push(level);
    }

    query += " ORDER BY nated_level, display_order, name";

    const { results } = await c.env.DB.prepare(query).bind(...params).all();

    return c.json(results || []);

  } catch (error) {
    console.error("Subjects fetch error:", error);
    return c.json({ 
      error: "Failed to fetch subjects",
      details: error instanceof Error ? error.message : String(error)
    }, 500);
  }
});

app.get("/api/subjects/:id", async (c) => {
  try {
    const id = c.req.param("id");
    console.log(`Fetching subject ${id}...`);
    
    const subject = await c.env.DB.prepare(
      "SELECT * FROM subjects WHERE id = ? AND is_active = 1"
    ).bind(id).first();

    if (!subject) {
      console.log('Subject not found');
      return c.json({ error: "Subject not found" }, 404);
    }

    console.log('Found subject:', subject.name);

    // Get modules with their topics and skills
    const { results: modules } = await c.env.DB.prepare(
      "SELECT * FROM modules WHERE subject_id = ? AND is_active = 1 ORDER BY display_order, name"
    ).bind(id).all();

    console.log(`Found ${modules?.length || 0} modules`);

    // For each module, get topics and their skills with progress
    const modulesWithContent = await Promise.all(
      (modules || []).map(async (module: any) => {
        console.log(`Processing module: ${module.name} (ID: ${module.id})`);
        
        // Get topics for this module
        const { results: topics } = await c.env.DB.prepare(
          "SELECT * FROM topics WHERE module_id = ? AND is_active = 1 ORDER BY display_order, name"
        ).bind(module.id).all();

        console.log(`Found ${topics?.length || 0} topics for module ${module.id}`);

        // For each topic, get skills with progress
        const topicsWithSkills = await Promise.all(
          (topics || []).map(async (topic: any) => {
            console.log(`Processing topic: ${topic.name} (ID: ${topic.id})`);
            
            const { results: skills } = await c.env.DB.prepare(
              `SELECT 
                s.*, 
                COALESCE(sp.smart_score, 0) as smart_score,
                COALESCE(sp.is_mastered, 0) as is_mastered,
                COALESCE(sp.questions_attempted, 0) as questions_attempted,
                COALESCE(sp.questions_correct, 0) as questions_correct
               FROM skills s 
               LEFT JOIN skill_progress sp ON s.id = sp.skill_id AND sp.user_id = ?
               WHERE s.topic_id = ? AND s.is_active = 1 
               ORDER BY s.display_order, s.name`
            ).bind('dev-user', topic.id).all();

            console.log(`Found ${skills?.length || 0} skills for topic ${topic.id}`);
            
            return { 
              ...topic, 
              skills: skills || [],
              skillCount: skills?.length || 0,
              masteredCount: skills?.filter((s: any) => s.is_mastered).length || 0
            };
          })
        );

        // Calculate module stats
        const allSkills = topicsWithSkills.flatMap((topic: any) => topic.skills);
        const skillCount = allSkills.length;
        const masteredCount = allSkills.filter((skill: any) => skill.is_mastered).length;
        
        return { 
          ...module, 
          topics: topicsWithSkills,
          skillCount,
          masteredCount
        };
      })
    );

    // Calculate subject-wide stats
    const allSkills = modulesWithContent.flatMap((module: any) => 
      module.topics.flatMap((topic: any) => topic.skills)
    );
    const totalSkills = allSkills.length;
    const masteredSkills = allSkills.filter((skill: any) => skill.is_mastered).length;
    const overallSmartScore = totalSkills > 0 
      ? Math.round(allSkills.reduce((sum: number, skill: any) => sum + (skill.smart_score || 0), 0) / totalSkills)
      : 0;

    console.log(`Final result: ${totalSkills} total skills, ${masteredSkills} mastered`);

    return c.json({ 
      ...subject, 
      modules: modulesWithContent,
      totalSkills,
      masteredSkills,
      overallSmartScore
    });

  } catch (error) {
    console.error("Subject detail error:", error);
    return c.json({ 
      error: "Failed to fetch subject",
      details: error instanceof Error ? error.message : String(error)
    }, 500);
  }
});

// ============================================================
// MODULES ENDPOINTS
// ============================================================

app.get("/api/modules/:id", async (c) => {
  try {
    const id = c.req.param("id");
    
    const module = await c.env.DB.prepare(
      "SELECT * FROM modules WHERE id = ? AND is_active = 1"
    ).bind(id).first();

    if (!module) {
      return c.json({ error: "Module not found" }, 404);
    }

    // Get subject info
    const subject = await c.env.DB.prepare(
      "SELECT id, name, code, color_hex FROM subjects WHERE id = ?"
    ).bind((module as any).subject_id).first();

    const { results: topics } = await c.env.DB.prepare(
      "SELECT * FROM topics WHERE module_id = ? AND is_active = 1 ORDER BY display_order, name"
    ).bind(id).all();

    // Get skills for each topic
    const topicsWithSkills = await Promise.all(
      (topics || []).map(async (topic: any) => {
        const { results: skills } = await c.env.DB.prepare(
          "SELECT * FROM skills WHERE topic_id = ? AND is_active = 1 ORDER BY display_order, name"
        ).bind(topic.id).all();
        
        return { ...topic, skills: skills || [] };
      })
    );

    return c.json({ ...module, subject, topics: topicsWithSkills });

  } catch (error) {
    console.error("Module detail error:", error);
    return c.json({ 
      error: "Failed to fetch module",
      details: error instanceof Error ? error.message : String(error)
    }, 500);
  }
});

// ============================================================
// SKILLS ENDPOINTS
// ============================================================

app.get("/api/skills/:id", async (c) => {
  try {
    const id = c.req.param("id");
    
    const skill = await c.env.DB.prepare(
      "SELECT * FROM skills WHERE id = ? AND is_active = 1"
    ).bind(id).first();

    if (!skill) {
      return c.json({ error: "Skill not found" }, 404);
    }

    return c.json(skill);

  } catch (error) {
    console.error("Skill fetch error:", error);
    return c.json({ 
      error: "Failed to fetch skill",
      details: error instanceof Error ? error.message : String(error)
    }, 500);
  }
});

app.get("/api/skills/:id/questions", async (c) => {
  try {
    const id = c.req.param("id");
    
    const { results } = await c.env.DB.prepare(
      "SELECT * FROM questions WHERE skill_id = ? AND is_active = 1 ORDER BY RANDOM() LIMIT 10"
    ).bind(id).all();

    return c.json(results || []);

  } catch (error) {
    console.error("Questions fetch error:", error);
    return c.json({ 
      error: "Failed to fetch questions",
      details: error instanceof Error ? error.message : String(error)
    }, 500);
  }
});

app.get("/api/skills/:id/progress", async (c) => {
  try {
    const userId = "dev-user"; // Hardcoded for development
    const skillId = c.req.param("id");

    const progress = await c.env.DB.prepare(
      "SELECT * FROM skill_progress WHERE user_id = ? AND skill_id = ?"
    ).bind(userId, skillId).first();

    if (!progress) {
      // Return default progress if none exists
      return c.json({
        smart_score: 0,
        questions_attempted: 0,
        questions_correct: 0,
        current_streak: 0,
        is_mastered: false,
      });
    }

    return c.json(progress);

  } catch (error) {
    console.error("Skill progress error:", error);
    return c.json({ 
      error: "Failed to fetch skill progress",
      details: error instanceof Error ? error.message : String(error)
    }, 500);
  }
});

// ============================================================
// HEALTH CHECK
// ============================================================

app.get("/api/health", async (c) => {
  try {
    // Test database connection
    const result = await c.env.DB.prepare("SELECT 1 as test").first();
    
    return c.json({ 
      status: "healthy",
      database: result ? "connected" : "error",
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    return c.json({ 
      status: "unhealthy",
      error: error instanceof Error ? error.message : String(error),
      timestamp: new Date().toISOString()
    }, 500);
  }
});

// ============================================================
// ERROR HANDLER
// ============================================================

app.onError((err, c) => {
  console.error("Application error:", err);
  return c.json({ 
    error: "Internal server error",
    message: err.message,
    timestamp: new Date().toISOString()
  }, 500);
});

// Add these routes to your index.ts after the existing routes

// POST /api/subjects - Create new subject
app.post("/api/subjects", async (c) => {
  try {
    const body = await c.req.json();
    const { name, code, nated_level, description, color_hex, display_order } = body;
    
    const result = await c.env.DB.prepare(
      `INSERT INTO subjects (name, code, nated_level, description, color_hex, display_order) 
       VALUES (?, ?, ?, ?, ?, ?)`
    ).bind(name, code, nated_level, description, color_hex, display_order || 0).run();
    
    return c.json({ id: result.meta.last_row_id, success: true }, 201);
  } catch (error) {
    console.error("Create subject error:", error);
    return c.json({ error: "Failed to create subject" }, 500);
  }
});

// PATCH /api/subjects/:id - Update subject
app.patch("/api/subjects/:id", async (c) => {
  try {
    const id = c.req.param("id");
    const body = await c.req.json();
    
    const updates = [];
    const params = [];
    
    if (body.name !== undefined) { updates.push("name = ?"); params.push(body.name); }
    if (body.code !== undefined) { updates.push("code = ?"); params.push(body.code); }
    if (body.nated_level !== undefined) { updates.push("nated_level = ?"); params.push(body.nated_level); }
    if (body.description !== undefined) { updates.push("description = ?"); params.push(body.description); }
    if (body.color_hex !== undefined) { updates.push("color_hex = ?"); params.push(body.color_hex); }
    if (body.display_order !== undefined) { updates.push("display_order = ?"); params.push(body.display_order); }
    if (body.is_active !== undefined) { updates.push("is_active = ?"); params.push(body.is_active); }
    
    if (updates.length === 0) {
      return c.json({ error: "No fields to update" }, 400);
    }
    
    updates.push("updated_at = CURRENT_TIMESTAMP");
    params.push(id);
    
    const query = `UPDATE subjects SET ${updates.join(", ")} WHERE id = ?`;
    await c.env.DB.prepare(query).bind(...params).run();
    
    return c.json({ success: true });
  } catch (error) {
    console.error("Update subject error:", error);
    return c.json({ error: "Failed to update subject" }, 500);
  }
});

// DELETE /api/subjects/:id - Soft delete subject
app.delete("/api/subjects/:id", async (c) => {
  try {
    const id = c.req.param("id");
    await c.env.DB.prepare("UPDATE subjects SET is_active = 0 WHERE id = ?").bind(id).run();
    return c.json({ success: true });
  } catch (error) {
    console.error("Delete subject error:", error);
    return c.json({ error: "Failed to delete subject" }, 500);
  }
});
// ============================================================
// ADMIN CONTENT MANAGEMENT ENDPOINTS
// ============================================================

// POST /api/modules - Create module
app.post("/api/modules", async (c) => {
  try {
    const body = await c.req.json();
    const { subject_id, name, description, display_order } = body;
    
    const result = await c.env.DB.prepare(
      "INSERT INTO modules (subject_id, name, description, display_order) VALUES (?, ?, ?, ?)"
    ).bind(subject_id, name, description, display_order || 0).run();
    
    return c.json({ id: result.meta.last_row_id, success: true }, 201);
  } catch (error) {
    console.error("Create module error:", error);
    return c.json({ error: "Failed to create module" }, 500);
  }
});

// PATCH /api/modules/:id - Update module
app.patch("/api/modules/:id", async (c) => {
  try {
    const id = c.req.param("id");
    const body = await c.req.json();
    
    const updates = [];
    const params = [];
    
    if (body.name !== undefined) { updates.push("name = ?"); params.push(body.name); }
    if (body.description !== undefined) { updates.push("description = ?"); params.push(body.description); }
    if (body.display_order !== undefined) { updates.push("display_order = ?"); params.push(body.display_order); }
    if (body.is_active !== undefined) { updates.push("is_active = ?"); params.push(body.is_active); }
    
    if (updates.length === 0) {
      return c.json({ error: "No fields to update" }, 400);
    }
    
    updates.push("updated_at = CURRENT_TIMESTAMP");
    params.push(id);
    
    const query = `UPDATE modules SET ${updates.join(", ")} WHERE id = ?`;
    await c.env.DB.prepare(query).bind(...params).run();
    
    return c.json({ success: true });
  } catch (error) {
    console.error("Update module error:", error);
    return c.json({ error: "Failed to update module" }, 500);
  }
});

// DELETE /api/modules/:id - Soft delete module
app.delete("/api/modules/:id", async (c) => {
  try {
    const id = c.req.param("id");
    await c.env.DB.prepare("UPDATE modules SET is_active = 0 WHERE id = ?").bind(id).run();
    return c.json({ success: true });
  } catch (error) {
    console.error("Delete module error:", error);
    return c.json({ error: "Failed to delete module" }, 500);
  }
});

// POST /api/topics - Create topic
app.post("/api/topics", async (c) => {
  try {
    const body = await c.req.json();
    const { module_id, name, description, display_order } = body;
    
    const result = await c.env.DB.prepare(
      "INSERT INTO topics (module_id, name, description, display_order) VALUES (?, ?, ?, ?)"
    ).bind(module_id, name, description, display_order || 0).run();
    
    return c.json({ id: result.meta.last_row_id, success: true }, 201);
  } catch (error) {
    console.error("Create topic error:", error);
    return c.json({ error: "Failed to create topic" }, 500);
  }
});

// PATCH /api/topics/:id - Update topic
app.patch("/api/topics/:id", async (c) => {
  try {
    const id = c.req.param("id");
    const body = await c.req.json();
    
    const updates = [];
    const params = [];
    
    if (body.name !== undefined) { updates.push("name = ?"); params.push(body.name); }
    if (body.description !== undefined) { updates.push("description = ?"); params.push(body.description); }
    if (body.display_order !== undefined) { updates.push("display_order = ?"); params.push(body.display_order); }
    if (body.is_active !== undefined) { updates.push("is_active = ?"); params.push(body.is_active); }
    
    if (updates.length === 0) {
      return c.json({ error: "No fields to update" }, 400);
    }
    
    updates.push("updated_at = CURRENT_TIMESTAMP");
    params.push(id);
    
    const query = `UPDATE topics SET ${updates.join(", ")} WHERE id = ?`;
    await c.env.DB.prepare(query).bind(...params).run();
    
    return c.json({ success: true });
  } catch (error) {
    console.error("Update topic error:", error);
    return c.json({ error: "Failed to update topic" }, 500);
  }
});

// POST /api/skills - Create skill
app.post("/api/skills", async (c) => {
  try {
    const body = await c.req.json();
    const { topic_id, name, description, difficulty_level, mastery_threshold, display_order } = body;
    
    const result = await c.env.DB.prepare(
      "INSERT INTO skills (topic_id, name, description, difficulty_level, mastery_threshold, display_order) VALUES (?, ?, ?, ?, ?, ?)"
    ).bind(topic_id, name, description, difficulty_level || 1, mastery_threshold || 80, display_order || 0).run();
    
    return c.json({ id: result.meta.last_row_id, success: true }, 201);
  } catch (error) {
    console.error("Create skill error:", error);
    return c.json({ error: "Failed to create skill" }, 500);
  }
});

// PATCH /api/skills/:id - Update skill
app.patch("/api/skills/:id", async (c) => {
  try {
    const id = c.req.param("id");
    const body = await c.req.json();
    
    const updates = [];
    const params = [];
    
    if (body.name !== undefined) { updates.push("name = ?"); params.push(body.name); }
    if (body.description !== undefined) { updates.push("description = ?"); params.push(body.description); }
    if (body.difficulty_level !== undefined) { updates.push("difficulty_level = ?"); params.push(body.difficulty_level); }
    if (body.mastery_threshold !== undefined) { updates.push("mastery_threshold = ?"); params.push(body.mastery_threshold); }
    if (body.display_order !== undefined) { updates.push("display_order = ?"); params.push(body.display_order); }
    if (body.is_active !== undefined) { updates.push("is_active = ?"); params.push(body.is_active); }
    
    if (updates.length === 0) {
      return c.json({ error: "No fields to update" }, 400);
    }
    
    updates.push("updated_at = CURRENT_TIMESTAMP");
    params.push(id);
    
    const query = `UPDATE skills SET ${updates.join(", ")} WHERE id = ?`;
    await c.env.DB.prepare(query).bind(...params).run();
    
    return c.json({ success: true });
  } catch (error) {
    console.error("Update skill error:", error);
    return c.json({ error: "Failed to update skill" }, 500);
  }
});

// POST /api/questions - Create question
app.post("/api/questions", async (c) => {
  try {
    const body = await c.req.json();
    console.log("Creating question with data:", body);
    
    const result = await c.env.DB.prepare(
      `INSERT INTO questions 
       (skill_id, question_type, question_text, question_data, correct_answer, explanation, difficulty_rating, points_value) 
       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`
    ).bind(
      body.skill_id, 
      body.question_type || 'multiple_choice',
      body.question_text, 
      typeof body.question_data === 'string' ? body.question_data : JSON.stringify(body.question_data),
      body.correct_answer, 
      body.explanation || '',
      body.difficulty_rating || 1, 
      body.points_value || 10
    ).run();
    
    console.log("Question created with ID:", result.meta.last_row_id);
    return c.json({ id: result.meta.last_row_id, success: true }, 201);
  } catch (error) {
    console.error("Create question error:", error);
    return c.json({ error: "Failed to create question" }, 500);
  }
});

// PATCH /api/questions/:id - Update question
app.patch("/api/questions/:id", async (c) => {
  try {
    const id = c.req.param("id");
    const body = await c.req.json();
    
    const updates = [];
    const params = [];
    
    if (body.question_text !== undefined) { updates.push("question_text = ?"); params.push(body.question_text); }
    if (body.question_data !== undefined) { 
      updates.push("question_data = ?"); 
      params.push(typeof body.question_data === 'string' ? body.question_data : JSON.stringify(body.question_data)); 
    }
    if (body.correct_answer !== undefined) { updates.push("correct_answer = ?"); params.push(body.correct_answer); }
    if (body.explanation !== undefined) { updates.push("explanation = ?"); params.push(body.explanation); }
    if (body.difficulty_rating !== undefined) { updates.push("difficulty_rating = ?"); params.push(body.difficulty_rating); }
    if (body.points_value !== undefined) { updates.push("points_value = ?"); params.push(body.points_value); }
    if (body.is_active !== undefined) { updates.push("is_active = ?"); params.push(body.is_active); }
    
    if (updates.length === 0) {
      return c.json({ error: "No fields to update" }, 400);
    }
    
    updates.push("updated_at = CURRENT_TIMESTAMP");
    params.push(id);
    
    const query = `UPDATE questions SET ${updates.join(", ")} WHERE id = ?`;
    await c.env.DB.prepare(query).bind(...params).run();
    
    return c.json({ success: true });
  } catch (error) {
    console.error("Update question error:", error);
    return c.json({ error: "Failed to update question" }, 500);
  }
});

// GET /api/modules/:id/topics - Get topics for a module
app.get("/api/modules/:id/topics", async (c) => {
  try {
    const id = c.req.param("id");
    
    const { results } = await c.env.DB.prepare(
      "SELECT * FROM topics WHERE module_id = ? AND is_active = 1 ORDER BY display_order, name"
    ).bind(id).all();

    return c.json(results || []);
  } catch (error) {
    console.error("Topics fetch error:", error);
    return c.json({ error: "Failed to fetch topics" }, 500);
  }
});

// GET /api/topics/:id/skills - Get skills for a topic
app.get("/api/topics/:id/skills", async (c) => {
  try {
    const id = c.req.param("id");
    
    const { results } = await c.env.DB.prepare(
      "SELECT * FROM skills WHERE topic_id = ? AND is_active = 1 ORDER BY display_order, name"
    ).bind(id).all();

    return c.json(results || []);
  } catch (error) {
    console.error("Skills fetch error:", error);
    return c.json({ error: "Failed to fetch skills" }, 500);
  }
});

// GET /api/skills/:id/questions - Get questions for a skill (already exists, but ensure it returns all questions)
app.get("/api/skills/:id/questions", async (c) => {
  try {
    const id = c.req.param("id");
    
    const { results } = await c.env.DB.prepare(
      "SELECT * FROM questions WHERE skill_id = ? AND is_active = 1 ORDER BY id"
    ).bind(id).all();

    return c.json(results || []);
  } catch (error) {
    console.error("Questions fetch error:", error);
    return c.json({ error: "Failed to fetch questions" }, 500);
  }
});

// Add these DELETE endpoints to your index.ts

// DELETE /api/modules/:id
app.delete("/api/modules/:id", async (c) => {
  try {
    const id = c.req.param("id");
    await c.env.DB.prepare("UPDATE modules SET is_active = 0 WHERE id = ?").bind(id).run();
    return c.json({ success: true });
  } catch (error) {
    return c.json({ error: "Failed to delete module" }, 500);
  }
});

// DELETE /api/topics/:id
app.delete("/api/topics/:id", async (c) => {
  try {
    const id = c.req.param("id");
    await c.env.DB.prepare("UPDATE topics SET is_active = 0 WHERE id = ?").bind(id).run();
    return c.json({ success: true });
  } catch (error) {
    return c.json({ error: "Failed to delete topic" }, 500);
  }
});

// DELETE /api/skills/:id
app.delete("/api/skills/:id", async (c) => {
  try {
    const id = c.req.param("id");
    await c.env.DB.prepare("UPDATE skills SET is_active = 0 WHERE id = ?").bind(id).run();
    return c.json({ success: true });
  } catch (error) {
    return c.json({ error: "Failed to delete skill" }, 500);
  }
});

// DELETE /api/questions/:id
app.delete("/api/questions/:id", async (c) => {
  try {
    const id = c.req.param("id");
    await c.env.DB.prepare("UPDATE questions SET is_active = 0 WHERE id = ?").bind(id).run();
    return c.json({ success: true });
  } catch (error) {
    return c.json({ error: "Failed to delete question" }, 500);
  }
});


export default app;

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FILE: src\worker\worker-configuration.d.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Generated by Wrangler
interface Env {
  DB: D1Database;
  R2_BUCKET: R2Bucket;
  MOCHA_USERS_SERVICE_API_URL: string;
  MOCHA_USERS_SERVICE_API_KEY: string;
}

